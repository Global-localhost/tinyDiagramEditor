// jQuery v1.11.0
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k="".trim,l={},m="1.11.0",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return n.each(this,a,b)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(n.isPlainObject(c)||(b=n.isArray(c)))?(b?(b=!1,f=a&&n.isArray(a)?a:[]):f=a&&n.isPlainObject(a)?a:{},g[d]=n.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray||function(a){return"array"===n.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return a-parseFloat(a)>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==n.type(a)||a.nodeType||n.isWindow(a))return!1;try{if(a.constructor&&!j.call(a,"constructor")&&!j.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(l.ownLast)for(b in a)return j.call(a,b);for(b in a);return void 0===b||j.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(b){b&&n.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=s(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:k&&!k.call("\ufeff\xa0")?function(a){return null==a?"":k.call(a)}:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(g)return g.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=s(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(f=a[b],b=a,a=f),n.isFunction(a)?(c=d.call(arguments,2),e=function(){return a.apply(b||this,c.concat(d.call(arguments)))},e.guid=a.guid=a.guid||n.guid++,e):void 0},now:function(){return+new Date},support:l}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s="sizzle"+-new Date,t=a.document,u=0,v=0,w=eb(),x=eb(),y=eb(),z=function(a,b){return a===b&&(j=!0),0},A="undefined",B=1<<31,C={}.hasOwnProperty,D=[],E=D.pop,F=D.push,G=D.push,H=D.slice,I=D.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},J="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",K="[\\x20\\t\\r\\n\\f]",L="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",M=L.replace("w","w#"),N="\\["+K+"*("+L+")"+K+"*(?:([*^$|!~]?=)"+K+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+M+")|)|)"+K+"*\\]",O=":("+L+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+N.replace(3,8)+")*)|.*)\\)|)",P=new RegExp("^"+K+"+|((?:^|[^\\\\])(?:\\\\.)*)"+K+"+$","g"),Q=new RegExp("^"+K+"*,"+K+"*"),R=new RegExp("^"+K+"*([>+~]|"+K+")"+K+"*"),S=new RegExp("="+K+"*([^\\]'\"]*?)"+K+"*\\]","g"),T=new RegExp(O),U=new RegExp("^"+M+"$"),V={ID:new RegExp("^#("+L+")"),CLASS:new RegExp("^\\.("+L+")"),TAG:new RegExp("^("+L.replace("w","w*")+")"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+K+"*(even|odd|(([+-]|)(\\d*)n|)"+K+"*(?:([+-]|)"+K+"*(\\d+)|))"+K+"*\\)|)","i"),bool:new RegExp("^(?:"+J+")$","i"),needsContext:new RegExp("^"+K+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+K+"*((?:-\\d)?\\d*)"+K+"*\\)|)(?=[^-]|$)","i")},W=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,_=/'|\\/g,ab=new RegExp("\\\\([\\da-f]{1,6}"+K+"?|("+K+")|.)","ig"),bb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{G.apply(D=H.call(t.childNodes),t.childNodes),D[t.childNodes.length].nodeType}catch(cb){G={apply:D.length?function(a,b){F.apply(a,H.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function db(a,b,d,e){var f,g,h,i,j,m,p,q,u,v;if((b?b.ownerDocument||b:t)!==l&&k(b),b=b||l,d=d||[],!a||"string"!=typeof a)return d;if(1!==(i=b.nodeType)&&9!==i)return[];if(n&&!e){if(f=Z.exec(a))if(h=f[1]){if(9===i){if(g=b.getElementById(h),!g||!g.parentNode)return d;if(g.id===h)return d.push(g),d}else if(b.ownerDocument&&(g=b.ownerDocument.getElementById(h))&&r(b,g)&&g.id===h)return d.push(g),d}else{if(f[2])return G.apply(d,b.getElementsByTagName(a)),d;if((h=f[3])&&c.getElementsByClassName&&b.getElementsByClassName)return G.apply(d,b.getElementsByClassName(h)),d}if(c.qsa&&(!o||!o.test(a))){if(q=p=s,u=b,v=9===i&&a,1===i&&"object"!==b.nodeName.toLowerCase()){m=ob(a),(p=b.getAttribute("id"))?q=p.replace(_,"\\$&"):b.setAttribute("id",q),q="[id='"+q+"'] ",j=m.length;while(j--)m[j]=q+pb(m[j]);u=$.test(a)&&mb(b.parentNode)||b,v=m.join(",")}if(v)try{return G.apply(d,u.querySelectorAll(v)),d}catch(w){}finally{p||b.removeAttribute("id")}}}return xb(a.replace(P,"$1"),b,d,e)}function eb(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function fb(a){return a[s]=!0,a}function gb(a){var b=l.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function hb(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function ib(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||B)-(~a.sourceIndex||B);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function jb(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function kb(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function lb(a){return fb(function(b){return b=+b,fb(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function mb(a){return a&&typeof a.getElementsByTagName!==A&&a}c=db.support={},f=db.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},k=db.setDocument=function(a){var b,e=a?a.ownerDocument||a:t,g=e.defaultView;return e!==l&&9===e.nodeType&&e.documentElement?(l=e,m=e.documentElement,n=!f(e),g&&g!==g.top&&(g.addEventListener?g.addEventListener("unload",function(){k()},!1):g.attachEvent&&g.attachEvent("onunload",function(){k()})),c.attributes=gb(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=gb(function(a){return a.appendChild(e.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Y.test(e.getElementsByClassName)&&gb(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),c.getById=gb(function(a){return m.appendChild(a).id=s,!e.getElementsByName||!e.getElementsByName(s).length}),c.getById?(d.find.ID=function(a,b){if(typeof b.getElementById!==A&&n){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ab,bb);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ab,bb);return function(a){var c=typeof a.getAttributeNode!==A&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==A?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==A&&n?b.getElementsByClassName(a):void 0},p=[],o=[],(c.qsa=Y.test(e.querySelectorAll))&&(gb(function(a){a.innerHTML="<select t=''><option selected=''></option></select>",a.querySelectorAll("[t^='']").length&&o.push("[*^$]="+K+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||o.push("\\["+K+"*(?:value|"+J+")"),a.querySelectorAll(":checked").length||o.push(":checked")}),gb(function(a){var b=e.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&o.push("name"+K+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||o.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),o.push(",.*:")})),(c.matchesSelector=Y.test(q=m.webkitMatchesSelector||m.mozMatchesSelector||m.oMatchesSelector||m.msMatchesSelector))&&gb(function(a){c.disconnectedMatch=q.call(a,"div"),q.call(a,"[s!='']:x"),p.push("!=",O)}),o=o.length&&new RegExp(o.join("|")),p=p.length&&new RegExp(p.join("|")),b=Y.test(m.compareDocumentPosition),r=b||Y.test(m.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},z=b?function(a,b){if(a===b)return j=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===e||a.ownerDocument===t&&r(t,a)?-1:b===e||b.ownerDocument===t&&r(t,b)?1:i?I.call(i,a)-I.call(i,b):0:4&d?-1:1)}:function(a,b){if(a===b)return j=!0,0;var c,d=0,f=a.parentNode,g=b.parentNode,h=[a],k=[b];if(!f||!g)return a===e?-1:b===e?1:f?-1:g?1:i?I.call(i,a)-I.call(i,b):0;if(f===g)return ib(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)k.unshift(c);while(h[d]===k[d])d++;return d?ib(h[d],k[d]):h[d]===t?-1:k[d]===t?1:0},e):l},db.matches=function(a,b){return db(a,null,null,b)},db.matchesSelector=function(a,b){if((a.ownerDocument||a)!==l&&k(a),b=b.replace(S,"='$1']"),!(!c.matchesSelector||!n||p&&p.test(b)||o&&o.test(b)))try{var d=q.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return db(b,l,null,[a]).length>0},db.contains=function(a,b){return(a.ownerDocument||a)!==l&&k(a),r(a,b)},db.attr=function(a,b){(a.ownerDocument||a)!==l&&k(a);var e=d.attrHandle[b.toLowerCase()],f=e&&C.call(d.attrHandle,b.toLowerCase())?e(a,b,!n):void 0;return void 0!==f?f:c.attributes||!n?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},db.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},db.uniqueSort=function(a){var b,d=[],e=0,f=0;if(j=!c.detectDuplicates,i=!c.sortStable&&a.slice(0),a.sort(z),j){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return i=null,a},e=db.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=db.selectors={cacheLength:50,createPseudo:fb,match:V,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ab,bb),a[3]=(a[4]||a[5]||"").replace(ab,bb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||db.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&db.error(a[0]),a},PSEUDO:function(a){var b,c=!a[5]&&a[2];return V.CHILD.test(a[0])?null:(a[3]&&void 0!==a[4]?a[2]=a[4]:c&&T.test(c)&&(b=ob(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ab,bb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=w[a+" "];return b||(b=new RegExp("(^|"+K+")"+a+"("+K+"|$)"))&&w(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==A&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=db.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),t=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&t){k=q[s]||(q[s]={}),j=k[a]||[],n=j[0]===u&&j[1],m=j[0]===u&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[u,n,m];break}}else if(t&&(j=(b[s]||(b[s]={}))[a])&&j[0]===u)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(t&&((l[s]||(l[s]={}))[a]=[u,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||db.error("unsupported pseudo: "+a);return e[s]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?fb(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=I.call(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:fb(function(a){var b=[],c=[],d=g(a.replace(P,"$1"));return d[s]?fb(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:fb(function(a){return function(b){return db(a,b).length>0}}),contains:fb(function(a){return function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:fb(function(a){return U.test(a||"")||db.error("unsupported lang: "+a),a=a.replace(ab,bb).toLowerCase(),function(b){var c;do if(c=n?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===m},focus:function(a){return a===l.activeElement&&(!l.hasFocus||l.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return X.test(a.nodeName)},input:function(a){return W.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:lb(function(){return[0]}),last:lb(function(a,b){return[b-1]}),eq:lb(function(a,b,c){return[0>c?c+b:c]}),even:lb(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:lb(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:lb(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:lb(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=jb(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=kb(b);function nb(){}nb.prototype=d.filters=d.pseudos,d.setFilters=new nb;function ob(a,b){var c,e,f,g,h,i,j,k=x[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=Q.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=R.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(P," ")}),h=h.slice(c.length));for(g in d.filter)!(e=V[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?db.error(a):x(a,i).slice(0)}function pb(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function qb(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=v++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[u,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[s]||(b[s]={}),(h=i[d])&&h[0]===u&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function rb(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function sb(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function tb(a,b,c,d,e,f){return d&&!d[s]&&(d=tb(d)),e&&!e[s]&&(e=tb(e,f)),fb(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||wb(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:sb(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=sb(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?I.call(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=sb(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):G.apply(g,r)})}function ub(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],i=g||d.relative[" "],j=g?1:0,k=qb(function(a){return a===b},i,!0),l=qb(function(a){return I.call(b,a)>-1},i,!0),m=[function(a,c,d){return!g&&(d||c!==h)||((b=c).nodeType?k(a,c,d):l(a,c,d))}];f>j;j++)if(c=d.relative[a[j].type])m=[qb(rb(m),c)];else{if(c=d.filter[a[j].type].apply(null,a[j].matches),c[s]){for(e=++j;f>e;e++)if(d.relative[a[e].type])break;return tb(j>1&&rb(m),j>1&&pb(a.slice(0,j-1).concat({value:" "===a[j-2].type?"*":""})).replace(P,"$1"),c,e>j&&ub(a.slice(j,e)),f>e&&ub(a=a.slice(e)),f>e&&pb(a))}m.push(c)}return rb(m)}function vb(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,i,j,k){var m,n,o,p=0,q="0",r=f&&[],s=[],t=h,v=f||e&&d.find.TAG("*",k),w=u+=null==t?1:Math.random()||.1,x=v.length;for(k&&(h=g!==l&&g);q!==x&&null!=(m=v[q]);q++){if(e&&m){n=0;while(o=a[n++])if(o(m,g,i)){j.push(m);break}k&&(u=w)}c&&((m=!o&&m)&&p--,f&&r.push(m))}if(p+=q,c&&q!==p){n=0;while(o=b[n++])o(r,s,g,i);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=E.call(j));s=sb(s)}G.apply(j,s),k&&!f&&s.length>0&&p+b.length>1&&db.uniqueSort(j)}return k&&(u=w,h=t),r};return c?fb(f):f}g=db.compile=function(a,b){var c,d=[],e=[],f=y[a+" "];if(!f){b||(b=ob(a)),c=b.length;while(c--)f=ub(b[c]),f[s]?d.push(f):e.push(f);f=y(a,vb(e,d))}return f};function wb(a,b,c){for(var d=0,e=b.length;e>d;d++)db(a,b[d],c);return c}function xb(a,b,e,f){var h,i,j,k,l,m=ob(a);if(!f&&1===m.length){if(i=m[0]=m[0].slice(0),i.length>2&&"ID"===(j=i[0]).type&&c.getById&&9===b.nodeType&&n&&d.relative[i[1].type]){if(b=(d.find.ID(j.matches[0].replace(ab,bb),b)||[])[0],!b)return e;a=a.slice(i.shift().value.length)}h=V.needsContext.test(a)?0:i.length;while(h--){if(j=i[h],d.relative[k=j.type])break;if((l=d.find[k])&&(f=l(j.matches[0].replace(ab,bb),$.test(i[0].type)&&mb(b.parentNode)||b))){if(i.splice(h,1),a=f.length&&pb(i),!a)return G.apply(e,f),e;break}}}return g(a,m)(f,b,!n,e,$.test(a)&&mb(b.parentNode)||b),e}return c.sortStable=s.split("").sort(z).join("")===s,c.detectDuplicates=!!j,k(),c.sortDetached=gb(function(a){return 1&a.compareDocumentPosition(l.createElement("div"))}),gb(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||hb("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&gb(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||hb("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),gb(function(a){return null==a.getAttribute("disabled")})||hb(J,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),db}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;function x(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(w.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return n.inArray(a,b)>=0!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;e>b;b++)if(n.contains(d[b],this))return!0}));for(b=0;e>b;b++)n.find(a,d[b],c);return c=this.pushStack(e>1?n.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(x(this,a||[],!1))},not:function(a){return this.pushStack(x(this,a||[],!0))},is:function(a){return!!x(this,"string"==typeof a&&u.test(a)?n(a):a||[],!1).length}});var y,z=a.document,A=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,B=n.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:A.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||y).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:z,!0)),v.test(c[1])&&n.isPlainObject(b))for(c in b)n.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}if(d=z.getElementById(c[2]),d&&d.parentNode){if(d.id!==c[2])return y.find(a);this.length=1,this[0]=d}return this.context=z,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof y.ready?y.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};B.prototype=n.fn,y=n(z);var C=/^(?:parents|prev(?:Until|All))/,D={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(a,b,c){var d=[],e=a[b];while(e&&9!==e.nodeType&&(void 0===c||1!==e.nodeType||!n(e).is(c)))1===e.nodeType&&d.push(e),e=e[b];return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),n.fn.extend({has:function(a){var b,c=n(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(n.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=u.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.unique(f):f)},index:function(a){return a?"string"==typeof a?n.inArray(this[0],n(a)):n.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.unique(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function E(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return n.dir(a,"parentNode")},parentsUntil:function(a,b,c){return n.dir(a,"parentNode",c)},next:function(a){return E(a,"nextSibling")},prev:function(a){return E(a,"previousSibling")},nextAll:function(a){return n.dir(a,"nextSibling")},prevAll:function(a){return n.dir(a,"previousSibling")},nextUntil:function(a,b,c){return n.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return n.dir(a,"previousSibling",c)},siblings:function(a){return n.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return n.sibling(a.firstChild)},contents:function(a){return n.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(D[a]||(e=n.unique(e)),C.test(a)&&(e=e.reverse())),this.pushStack(e)}});var F=/\S+/g,G={};function H(a){var b=G[a]={};return n.each(a.match(F)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?G[a]||H(a):n.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(c=a.memory&&l,d=!0,f=g||0,g=0,e=h.length,b=!0;h&&e>f;f++)if(h[f].apply(l[0],l[1])===!1&&a.stopOnFalse){c=!1;break}b=!1,h&&(i?i.length&&j(i.shift()):c?h=[]:k.disable())},k={add:function(){if(h){var d=h.length;!function f(b){n.each(b,function(b,c){var d=n.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),b?e=h.length:c&&(g=d,j(c))}return this},remove:function(){return h&&n.each(arguments,function(a,c){var d;while((d=n.inArray(c,h,d))>-1)h.splice(d,1),b&&(e>=d&&e--,f>=d&&f--)}),this},has:function(a){return a?n.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],e=0,this},disable:function(){return h=i=c=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,c||k.disable(),this},locked:function(){return!i},fireWith:function(a,c){return!h||d&&!i||(c=c||[],c=[a,c.slice?c.slice():c],b?i.push(c):j(c)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!d}};return k},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&n.isFunction(a.promise)?e:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var I;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){if(a===!0?!--n.readyWait:!n.isReady){if(!z.body)return setTimeout(n.ready);n.isReady=!0,a!==!0&&--n.readyWait>0||(I.resolveWith(z,[n]),n.fn.trigger&&n(z).trigger("ready").off("ready"))}}});function J(){z.addEventListener?(z.removeEventListener("DOMContentLoaded",K,!1),a.removeEventListener("load",K,!1)):(z.detachEvent("onreadystatechange",K),a.detachEvent("onload",K))}function K(){(z.addEventListener||"load"===event.type||"complete"===z.readyState)&&(J(),n.ready())}n.ready.promise=function(b){if(!I)if(I=n.Deferred(),"complete"===z.readyState)setTimeout(n.ready);else if(z.addEventListener)z.addEventListener("DOMContentLoaded",K,!1),a.addEventListener("load",K,!1);else{z.attachEvent("onreadystatechange",K),a.attachEvent("onload",K);var c=!1;try{c=null==a.frameElement&&z.documentElement}catch(d){}c&&c.doScroll&&!function e(){if(!n.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}J(),n.ready()}}()}return I.promise(b)};var L="undefined",M;for(M in n(l))break;l.ownLast="0"!==M,l.inlineBlockNeedsLayout=!1,n(function(){var a,b,c=z.getElementsByTagName("body")[0];c&&(a=z.createElement("div"),a.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",b=z.createElement("div"),c.appendChild(a).appendChild(b),typeof b.style.zoom!==L&&(b.style.cssText="border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1",(l.inlineBlockNeedsLayout=3===b.offsetWidth)&&(c.style.zoom=1)),c.removeChild(a),a=b=null)}),function(){var a=z.createElement("div");if(null==l.deleteExpando){l.deleteExpando=!0;try{delete a.test}catch(b){l.deleteExpando=!1}}a=null}(),n.acceptData=function(a){var b=n.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b};var N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(O,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}n.data(a,b,c)}else c=void 0}return c}function Q(a){var b;for(b in a)if(("data"!==b||!n.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function R(a,b,d,e){if(n.acceptData(a)){var f,g,h=n.expando,i=a.nodeType,j=i?n.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||n.guid++:h),j[k]||(j[k]=i?{}:{toJSON:n.noop}),("object"==typeof b||"function"==typeof b)&&(e?j[k]=n.extend(j[k],b):j[k].data=n.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[n.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[n.camelCase(b)])):f=g,f
}}function S(a,b,c){if(n.acceptData(a)){var d,e,f=a.nodeType,g=f?n.cache:a,h=f?a[n.expando]:n.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){n.isArray(b)?b=b.concat(n.map(b,n.camelCase)):b in d?b=[b]:(b=n.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!Q(d):!n.isEmptyObject(d))return}(c||(delete g[h].data,Q(g[h])))&&(f?n.cleanData([a],!0):l.deleteExpando||g!=g.window?delete g[h]:g[h]=null)}}}n.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?n.cache[a[n.expando]]:a[n.expando],!!a&&!Q(a)},data:function(a,b,c){return R(a,b,c)},removeData:function(a,b){return S(a,b)},_data:function(a,b,c){return R(a,b,c,!0)},_removeData:function(a,b){return S(a,b,!0)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=n.data(f),1===f.nodeType&&!n._data(f,"parsedAttrs"))){c=g.length;while(c--)d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d]));n._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){n.data(this,a)}):arguments.length>1?this.each(function(){n.data(this,a,b)}):f?P(f,a,n.data(f,a)):void 0},removeData:function(a){return this.each(function(){n.removeData(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=n._data(a,b),c&&(!d||n.isArray(c)?d=n._data(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return n._data(a,c)||n._data(a,c,{empty:n.Callbacks("once memory").add(function(){n._removeData(a,b+"queue"),n._removeData(a,c)})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=n._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var T=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,U=["Top","Right","Bottom","Left"],V=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)},W=n.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)n.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},X=/^(?:checkbox|radio)$/i;!function(){var a=z.createDocumentFragment(),b=z.createElement("div"),c=z.createElement("input");if(b.setAttribute("className","t"),b.innerHTML="  <link/><table></table><a href='/a'>a</a>",l.leadingWhitespace=3===b.firstChild.nodeType,l.tbody=!b.getElementsByTagName("tbody").length,l.htmlSerialize=!!b.getElementsByTagName("link").length,l.html5Clone="<:nav></:nav>"!==z.createElement("nav").cloneNode(!0).outerHTML,c.type="checkbox",c.checked=!0,a.appendChild(c),l.appendChecked=c.checked,b.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue,a.appendChild(b),b.innerHTML="<input type='radio' checked='checked' name='t'/>",l.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,l.noCloneEvent=!0,b.attachEvent&&(b.attachEvent("onclick",function(){l.noCloneEvent=!1}),b.cloneNode(!0).click()),null==l.deleteExpando){l.deleteExpando=!0;try{delete b.test}catch(d){l.deleteExpando=!1}}a=b=c=null}(),function(){var b,c,d=z.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(l[b+"Bubbles"]=c in a)||(d.setAttribute(c,"t"),l[b+"Bubbles"]=d.attributes[c].expando===!1);d=null}();var Y=/^(?:input|select|textarea)$/i,Z=/^key/,$=/^(?:mouse|contextmenu)|click/,_=/^(?:focusinfocus|focusoutblur)$/,ab=/^([^.]*)(?:\.(.+)|)$/;function bb(){return!0}function cb(){return!1}function db(){try{return z.activeElement}catch(a){}}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n._data(a);if(r){c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=n.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return typeof n===L||a&&n.event.triggered===a.type?void 0:n.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(F)||[""],h=b.length;while(h--)f=ab.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=n.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=n.event.special[o]||{},l=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},i),(m=g[o])||(m=g[o]=[],m.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,l):m.push(l),n.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n.hasData(a)&&n._data(a);if(r&&(k=r.events)){b=(b||"").match(F)||[""],j=b.length;while(j--)if(h=ab.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;while(f--)g=m[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(k)&&(delete r.handle,n._removeData(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,l,m,o=[d||z],p=j.call(b,"type")?b.type:b,q=j.call(b,"namespace")?b.namespace.split("."):[];if(h=l=d=d||z,3!==d.nodeType&&8!==d.nodeType&&!_.test(p+n.event.triggered)&&(p.indexOf(".")>=0&&(q=p.split("."),p=q.shift(),q.sort()),g=p.indexOf(":")<0&&"on"+p,b=b[n.expando]?b:new n.Event(p,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=q.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:n.makeArray(c,[b]),k=n.event.special[p]||{},e||!k.trigger||k.trigger.apply(d,c)!==!1)){if(!e&&!k.noBubble&&!n.isWindow(d)){for(i=k.delegateType||p,_.test(i+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),l=h;l===(d.ownerDocument||z)&&o.push(l.defaultView||l.parentWindow||a)}m=0;while((h=o[m++])&&!b.isPropagationStopped())b.type=m>1?i:k.bindType||p,f=(n._data(h,"events")||{})[b.type]&&n._data(h,"handle"),f&&f.apply(h,c),f=g&&h[g],f&&f.apply&&n.acceptData(h)&&(b.result=f.apply(h,c),b.result===!1&&b.preventDefault());if(b.type=p,!e&&!b.isDefaultPrevented()&&(!k._default||k._default.apply(o.pop(),c)===!1)&&n.acceptData(d)&&g&&d[p]&&!n.isWindow(d)){l=d[g],l&&(d[g]=null),n.event.triggered=p;try{d[p]()}catch(r){}n.event.triggered=void 0,l&&(d[g]=l)}return b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(n._data(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,g=0;while((e=f.handlers[g++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,c=((n.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),void 0!==c&&(a.result=c)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(e=[],f=0;h>f;f++)d=b[f],c=d.selector+" ",void 0===e[c]&&(e[c]=d.needsContext?n(c,this).index(i)>=0:n.find(c,this,null,[i]).length),e[c]&&e.push(d);e.length&&g.push({elem:i,handlers:e})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[n.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=$.test(e)?this.mouseHooks:Z.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new n.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||z),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button,g=b.fromElement;return null==a.pageX&&null!=b.clientX&&(d=a.target.ownerDocument||z,e=d.documentElement,c=d.body,a.pageX=b.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&g&&(a.relatedTarget=g===a.target?b.toElement:g),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==db()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===db()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return n.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=n.extend(new n.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?n.event.trigger(e,null,b):n.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=z.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===L&&(a[d]=null),a.detachEvent(d,c))},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&(a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault())?bb:cb):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={isDefaultPrevented:cb,isPropagationStopped:cb,isImmediatePropagationStopped:cb,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=bb,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=bb,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=bb,this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!n.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),l.submitBubbles||(n.event.special.submit={setup:function(){return n.nodeName(this,"form")?!1:void n.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=n.nodeName(b,"input")||n.nodeName(b,"button")?b.form:void 0;c&&!n._data(c,"submitBubbles")&&(n.event.add(c,"submit._submit",function(a){a._submit_bubble=!0}),n._data(c,"submitBubbles",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&n.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return n.nodeName(this,"form")?!1:void n.event.remove(this,"._submit")}}),l.changeBubbles||(n.event.special.change={setup:function(){return Y.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(n.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),n.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),n.event.simulate("change",this,a,!0)})),!1):void n.event.add(this,"beforeactivate._change",function(a){var b=a.target;Y.test(b.nodeName)&&!n._data(b,"changeBubbles")&&(n.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||n.event.simulate("change",this.parentNode,a,!0)}),n._data(b,"changeBubbles",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return n.event.remove(this,"._change"),!Y.test(this.nodeName)}}),l.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a),!0)};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=n._data(d,b);e||d.addEventListener(a,c,!0),n._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=n._data(d,b)-1;e?n._data(d,b,e):(d.removeEventListener(a,c,!0),n._removeData(d,b))}}}),n.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(f in a)this.on(f,b,c,a[f],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=cb;else if(!d)return this;return 1===e&&(g=d,d=function(a){return n().off(a),g.apply(this,arguments)},d.guid=g.guid||(g.guid=n.guid++)),this.each(function(){n.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=cb),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});function eb(a){var b=fb.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}var fb="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gb=/ jQuery\d+="(?:null|\d+)"/g,hb=new RegExp("<(?:"+fb+")[\\s/>]","i"),ib=/^\s+/,jb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,kb=/<([\w:]+)/,lb=/<tbody/i,mb=/<|&#?\w+;/,nb=/<(?:script|style|link)/i,ob=/checked\s*(?:[^=]|=\s*.checked.)/i,pb=/^$|\/(?:java|ecma)script/i,qb=/^true\/(.*)/,rb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,sb={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:l.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},tb=eb(z),ub=tb.appendChild(z.createElement("div"));sb.optgroup=sb.option,sb.tbody=sb.tfoot=sb.colgroup=sb.caption=sb.thead,sb.th=sb.td;function vb(a,b){var c,d,e=0,f=typeof a.getElementsByTagName!==L?a.getElementsByTagName(b||"*"):typeof a.querySelectorAll!==L?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||n.nodeName(d,b)?f.push(d):n.merge(f,vb(d,b));return void 0===b||b&&n.nodeName(a,b)?n.merge([a],f):f}function wb(a){X.test(a.type)&&(a.defaultChecked=a.checked)}function xb(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function yb(a){return a.type=(null!==n.find.attr(a,"type"))+"/"+a.type,a}function zb(a){var b=qb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Ab(a,b){for(var c,d=0;null!=(c=a[d]);d++)n._data(c,"globalEval",!b||n._data(b[d],"globalEval"))}function Bb(a,b){if(1===b.nodeType&&n.hasData(a)){var c,d,e,f=n._data(a),g=n._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)n.event.add(b,c,h[c][d])}g.data&&(g.data=n.extend({},g.data))}}function Cb(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!l.noCloneEvent&&b[n.expando]){e=n._data(b);for(d in e.events)n.removeEvent(b,d,e.handle);b.removeAttribute(n.expando)}"script"===c&&b.text!==a.text?(yb(b).text=a.text,zb(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),l.html5Clone&&a.innerHTML&&!n.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&X.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}n.extend({clone:function(a,b,c){var d,e,f,g,h,i=n.contains(a.ownerDocument,a);if(l.html5Clone||n.isXMLDoc(a)||!hb.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(ub.innerHTML=a.outerHTML,ub.removeChild(f=ub.firstChild)),!(l.noCloneEvent&&l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(d=vb(f),h=vb(a),g=0;null!=(e=h[g]);++g)d[g]&&Cb(e,d[g]);if(b)if(c)for(h=h||vb(a),d=d||vb(f),g=0;null!=(e=h[g]);g++)Bb(e,d[g]);else Bb(a,f);return d=vb(f,"script"),d.length>0&&Ab(d,!i&&vb(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k,m=a.length,o=eb(b),p=[],q=0;m>q;q++)if(f=a[q],f||0===f)if("object"===n.type(f))n.merge(p,f.nodeType?[f]:f);else if(mb.test(f)){h=h||o.appendChild(b.createElement("div")),i=(kb.exec(f)||["",""])[1].toLowerCase(),k=sb[i]||sb._default,h.innerHTML=k[1]+f.replace(jb,"<$1></$2>")+k[2],e=k[0];while(e--)h=h.lastChild;if(!l.leadingWhitespace&&ib.test(f)&&p.push(b.createTextNode(ib.exec(f)[0])),!l.tbody){f="table"!==i||lb.test(f)?"<table>"!==k[1]||lb.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;while(e--)n.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j)}n.merge(p,h.childNodes),h.textContent="";while(h.firstChild)h.removeChild(h.firstChild);h=o.lastChild}else p.push(b.createTextNode(f));h&&o.removeChild(h),l.appendChecked||n.grep(vb(p,"input"),wb),q=0;while(f=p[q++])if((!d||-1===n.inArray(f,d))&&(g=n.contains(f.ownerDocument,f),h=vb(o.appendChild(f),"script"),g&&Ab(h),c)){e=0;while(f=h[e++])pb.test(f.type||"")&&c.push(f)}return h=null,o},cleanData:function(a,b){for(var d,e,f,g,h=0,i=n.expando,j=n.cache,k=l.deleteExpando,m=n.event.special;null!=(d=a[h]);h++)if((b||n.acceptData(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)m[e]?n.event.remove(d,e):n.removeEvent(d,e,g.handle);j[f]&&(delete j[f],k?delete d[i]:typeof d.removeAttribute!==L?d.removeAttribute(i):d[i]=null,c.push(f))}}}),n.fn.extend({text:function(a){return W(this,function(a){return void 0===a?n.text(this):this.empty().append((this[0]&&this[0].ownerDocument||z).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=xb(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=xb(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?n.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||n.cleanData(vb(c)),c.parentNode&&(b&&n.contains(c.ownerDocument,c)&&Ab(vb(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&n.cleanData(vb(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&n.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return W(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(gb,""):void 0;if(!("string"!=typeof a||nb.test(a)||!l.htmlSerialize&&hb.test(a)||!l.leadingWhitespace&&ib.test(a)||sb[(kb.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(jb,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(vb(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,n.cleanData(vb(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,k=this.length,m=this,o=k-1,p=a[0],q=n.isFunction(p);if(q||k>1&&"string"==typeof p&&!l.checkClone&&ob.test(p))return this.each(function(c){var d=m.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(k&&(i=n.buildFragment(a,this[0].ownerDocument,!1,this),c=i.firstChild,1===i.childNodes.length&&(i=c),c)){for(g=n.map(vb(i,"script"),yb),f=g.length;k>j;j++)d=i,j!==o&&(d=n.clone(d,!0,!0),f&&n.merge(g,vb(d,"script"))),b.call(this[j],d,j);if(f)for(h=g[g.length-1].ownerDocument,n.map(g,zb),j=0;f>j;j++)d=g[j],pb.test(d.type||"")&&!n._data(d,"globalEval")&&n.contains(h,d)&&(d.src?n._evalUrl&&n._evalUrl(d.src):n.globalEval((d.text||d.textContent||d.innerHTML||"").replace(rb,"")));i=c=null}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=0,e=[],g=n(a),h=g.length-1;h>=d;d++)c=d===h?this:this.clone(!0),n(g[d])[b](c),f.apply(e,c.get());return this.pushStack(e)}});var Db,Eb={};function Fb(b,c){var d=n(c.createElement(b)).appendTo(c.body),e=a.getDefaultComputedStyle?a.getDefaultComputedStyle(d[0]).display:n.css(d[0],"display");return d.detach(),e}function Gb(a){var b=z,c=Eb[a];return c||(c=Fb(a,b),"none"!==c&&c||(Db=(Db||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Db[0].contentWindow||Db[0].contentDocument).document,b.write(),b.close(),c=Fb(a,b),Db.detach()),Eb[a]=c),c}!function(){var a,b,c=z.createElement("div"),d="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=c.getElementsByTagName("a")[0],a.style.cssText="float:left;opacity:.5",l.opacity=/^0.5/.test(a.style.opacity),l.cssFloat=!!a.style.cssFloat,c.style.backgroundClip="content-box",c.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===c.style.backgroundClip,a=c=null,l.shrinkWrapBlocks=function(){var a,c,e,f;if(null==b){if(a=z.getElementsByTagName("body")[0],!a)return;f="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",c=z.createElement("div"),e=z.createElement("div"),a.appendChild(c).appendChild(e),b=!1,typeof e.style.zoom!==L&&(e.style.cssText=d+";width:1px;padding:1px;zoom:1",e.innerHTML="<div></div>",e.firstChild.style.width="5px",b=3!==e.offsetWidth),a.removeChild(c),a=c=e=null}return b}}();var Hb=/^margin/,Ib=new RegExp("^("+T+")(?!px)[a-z%]+$","i"),Jb,Kb,Lb=/^(top|right|bottom|left)$/;a.getComputedStyle?(Jb=function(a){return a.ownerDocument.defaultView.getComputedStyle(a,null)},Kb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Jb(a),g=c?c.getPropertyValue(b)||c[b]:void 0,c&&(""!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),Ib.test(g)&&Hb.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0===g?g:g+""}):z.documentElement.currentStyle&&(Jb=function(a){return a.currentStyle},Kb=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Jb(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Ib.test(g)&&!Lb.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});function Mb(a,b){return{get:function(){var c=a();if(null!=c)return c?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d,e,f,g,h=z.createElement("div"),i="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",j="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";h.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",b=h.getElementsByTagName("a")[0],b.style.cssText="float:left;opacity:.5",l.opacity=/^0.5/.test(b.style.opacity),l.cssFloat=!!b.style.cssFloat,h.style.backgroundClip="content-box",h.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===h.style.backgroundClip,b=h=null,n.extend(l,{reliableHiddenOffsets:function(){if(null!=c)return c;var a,b,d,e=z.createElement("div"),f=z.getElementsByTagName("body")[0];if(f)return e.setAttribute("className","t"),e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=z.createElement("div"),a.style.cssText=i,f.appendChild(a).appendChild(e),e.innerHTML="<table><tr><td></td><td>t</td></tr></table>",b=e.getElementsByTagName("td"),b[0].style.cssText="padding:0;margin:0;border:0;display:none",d=0===b[0].offsetHeight,b[0].style.display="",b[1].style.display="none",c=d&&0===b[0].offsetHeight,f.removeChild(a),e=f=null,c},boxSizing:function(){return null==d&&k(),d},boxSizingReliable:function(){return null==e&&k(),e},pixelPosition:function(){return null==f&&k(),f},reliableMarginRight:function(){var b,c,d,e;if(null==g&&a.getComputedStyle){if(b=z.getElementsByTagName("body")[0],!b)return;c=z.createElement("div"),d=z.createElement("div"),c.style.cssText=i,b.appendChild(c).appendChild(d),e=d.appendChild(z.createElement("div")),e.style.cssText=d.style.cssText=j,e.style.marginRight=e.style.width="0",d.style.width="1px",g=!parseFloat((a.getComputedStyle(e,null)||{}).marginRight),b.removeChild(c)}return g}});function k(){var b,c,h=z.getElementsByTagName("body")[0];h&&(b=z.createElement("div"),c=z.createElement("div"),b.style.cssText=i,h.appendChild(b).appendChild(c),c.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%",n.swap(h,null!=h.style.zoom?{zoom:1}:{},function(){d=4===c.offsetWidth}),e=!0,f=!1,g=!0,a.getComputedStyle&&(f="1%"!==(a.getComputedStyle(c,null)||{}).top,e="4px"===(a.getComputedStyle(c,null)||{width:"4px"}).width),h.removeChild(b),c=h=null)}}(),n.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Nb=/alpha\([^)]*\)/i,Ob=/opacity\s*=\s*([^)]*)/,Pb=/^(none|table(?!-c[ea]).+)/,Qb=new RegExp("^("+T+")(.*)$","i"),Rb=new RegExp("^([+-])=("+T+")","i"),Sb={position:"absolute",visibility:"hidden",display:"block"},Tb={letterSpacing:0,fontWeight:400},Ub=["Webkit","O","Moz","ms"];function Vb(a,b){if(b in a)return b;var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=Ub.length;while(e--)if(b=Ub[e]+c,b in a)return b;return d}function Wb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=n._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&V(d)&&(f[g]=n._data(d,"olddisplay",Gb(d.nodeName)))):f[g]||(e=V(d),(c&&"none"!==c||!e)&&n._data(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function Xb(a,b,c){var d=Qb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Yb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+U[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+U[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+U[f]+"Width",!0,e))):(g+=n.css(a,"padding"+U[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+U[f]+"Width",!0,e)));return g}function Zb(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Jb(a),g=l.boxSizing()&&"border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Kb(a,b,f),(0>e||null==e)&&(e=a.style[b]),Ib.test(e))return e;d=g&&(l.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Yb(a,b,c||(g?"border":"content"),d,f)+"px"}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Kb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":l.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;if(b=n.cssProps[h]||(n.cssProps[h]=Vb(i,h)),g=n.cssHooks[b]||n.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=Rb.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(n.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||n.cssNumber[h]||(c+="px"),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]="",i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=Vb(a.style,h)),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Kb(a,b,d)),"normal"===f&&b in Tb&&(f=Tb[b]),""===c||c?(e=parseFloat(f),c===!0||n.isNumeric(e)?e||0:f):f}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?0===a.offsetWidth&&Pb.test(n.css(a,"display"))?n.swap(a,Sb,function(){return Zb(a,b,d)}):Zb(a,b,d):void 0},set:function(a,c,d){var e=d&&Jb(a);return Xb(a,c,d?Yb(a,b,d,l.boxSizing()&&"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),l.opacity||(n.cssHooks.opacity={get:function(a,b){return Ob.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=n.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===n.trim(f.replace(Nb,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Nb.test(f)?f.replace(Nb,e):f+" "+e)}}),n.cssHooks.marginRight=Mb(l.reliableMarginRight,function(a,b){return b?n.swap(a,{display:"inline-block"},Kb,[a,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+U[d]+b]=f[d]||f[d-2]||f[0];return e}},Hb.test(a)||(n.cssHooks[a+b].set=Xb)}),n.fn.extend({css:function(a,b){return W(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=Jb(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)
},a,b,arguments.length>1)},show:function(){return Wb(this,!0)},hide:function(){return Wb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){V(this)?n(this).show():n(this).hide()})}});function $b(a,b,c,d,e){return new $b.prototype.init(a,b,c,d,e)}n.Tween=$b,$b.prototype={constructor:$b,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=$b.propHooks[this.prop];return a&&a.get?a.get(this):$b.propHooks._default.get(this)},run:function(a){var b,c=$b.propHooks[this.prop];return this.pos=b=this.options.duration?n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):$b.propHooks._default.set(this),this}},$b.prototype.init.prototype=$b.prototype,$b.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[n.cssProps[a.prop]]||n.cssHooks[a.prop])?n.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},$b.propHooks.scrollTop=$b.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},n.fx=$b.prototype.init,n.fx.step={};var _b,ac,bc=/^(?:toggle|show|hide)$/,cc=new RegExp("^(?:([+-])=|)("+T+")([a-z%]*)$","i"),dc=/queueHooks$/,ec=[jc],fc={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=cc.exec(b),f=e&&e[3]||(n.cssNumber[a]?"":"px"),g=(n.cssNumber[a]||"px"!==f&&+d)&&cc.exec(n.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,n.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function gc(){return setTimeout(function(){_b=void 0}),_b=n.now()}function hc(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=U[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function ic(a,b,c){for(var d,e=(fc[b]||[]).concat(fc["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function jc(a,b,c){var d,e,f,g,h,i,j,k,m=this,o={},p=a.style,q=a.nodeType&&V(a),r=n._data(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,m.always(function(){m.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=n.css(a,"display"),k=Gb(a.nodeName),"none"===j&&(j=k),"inline"===j&&"none"===n.css(a,"float")&&(l.inlineBlockNeedsLayout&&"inline"!==k?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",l.shrinkWrapBlocks()||m.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],bc.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||n.style(a,d)}if(!n.isEmptyObject(o)){r?"hidden"in r&&(q=r.hidden):r=n._data(a,"fxshow",{}),f&&(r.hidden=!q),q?n(a).show():m.done(function(){n(a).hide()}),m.done(function(){var b;n._removeData(a,"fxshow");for(b in o)n.style(a,b,o[b])});for(d in o)g=ic(q?r[d]:0,d,m),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function kc(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function lc(a,b,c){var d,e,f=0,g=ec.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=_b||gc(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:_b||gc(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(kc(k,j.opts.specialEasing);g>f;f++)if(d=ec[f].call(j,a,k,j.opts))return d;return n.map(k,ic,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(lc,{tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],fc[c]=fc[c]||[],fc[c].unshift(b)},prefilter:function(a,b){b?ec.unshift(a):ec.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(V).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=lc(this,n.extend({},a),f);(e||n._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=n._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&dc.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=n._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(hc(b,!0),a,d,e)}}),n.each({slideDown:hc("show"),slideUp:hc("hide"),slideToggle:hc("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=n.timers,c=0;for(_b=n.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||n.fx.stop(),_b=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){ac||(ac=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(ac),ac=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(a,b){return a=n.fx?n.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a,b,c,d,e=z.createElement("div");e.setAttribute("className","t"),e.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=e.getElementsByTagName("a")[0],c=z.createElement("select"),d=c.appendChild(z.createElement("option")),b=e.getElementsByTagName("input")[0],a.style.cssText="top:1px",l.getSetAttribute="t"!==e.className,l.style=/top/.test(a.getAttribute("style")),l.hrefNormalized="/a"===a.getAttribute("href"),l.checkOn=!!b.value,l.optSelected=d.selected,l.enctype=!!z.createElement("form").enctype,c.disabled=!0,l.optDisabled=!d.disabled,b=z.createElement("input"),b.setAttribute("value",""),l.input=""===b.getAttribute("value"),b.value="t",b.setAttribute("type","radio"),l.radioValue="t"===b.value,a=b=c=d=e=null}();var mc=/\r/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(mc,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.text(a)}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(l.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)if(d=e[g],n.inArray(n.valHooks.option.get(d),f)>=0)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>=0:void 0}},l.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var nc,oc,pc=n.expr.attrHandle,qc=/^(?:checked|selected)$/i,rc=l.getSetAttribute,sc=l.input;n.fn.extend({attr:function(a,b){return W(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===L?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),d=n.attrHooks[b]||(n.expr.match.bool.test(b)?oc:nc)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=n.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void n.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(F);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)?sc&&rc||!qc.test(c)?a[d]=!1:a[n.camelCase("default-"+c)]=a[d]=!1:n.attr(a,c,""),a.removeAttribute(rc?c:d)},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),oc={set:function(a,b,c){return b===!1?n.removeAttr(a,c):sc&&rc||!qc.test(c)?a.setAttribute(!rc&&n.propFix[c]||c,c):a[n.camelCase("default-"+c)]=a[c]=!0,c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=pc[b]||n.find.attr;pc[b]=sc&&rc||!qc.test(b)?function(a,b,d){var e,f;return d||(f=pc[b],pc[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,pc[b]=f),e}:function(a,b,c){return c?void 0:a[n.camelCase("default-"+b)]?b.toLowerCase():null}}),sc&&rc||(n.attrHooks.value={set:function(a,b,c){return n.nodeName(a,"input")?void(a.defaultValue=b):nc&&nc.set(a,b,c)}}),rc||(nc={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},pc.id=pc.name=pc.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},n.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:nc.set},n.attrHooks.contenteditable={set:function(a,b,c){nc.set(a,""===b?!1:b,c)}},n.each(["width","height"],function(a,b){n.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),l.style||(n.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var tc=/^(?:input|select|textarea|button|object)$/i,uc=/^(?:a|area)$/i;n.fn.extend({prop:function(a,b){return W(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return a=n.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!n.isXMLDoc(a),f&&(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=n.find.attr(a,"tabindex");return b?parseInt(b,10):tc.test(a.nodeName)||uc.test(a.nodeName)&&a.href?0:-1}}}}),l.hrefNormalized||n.each(["href","src"],function(a,b){n.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),l.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this}),l.enctype||(n.propFix.enctype="encoding");var vc=/[\t\r\n\f]/g;n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j="string"==typeof a&&a;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(F)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(vc," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=n.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j=0===arguments.length||"string"==typeof a&&a;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(F)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(vc," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?n.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(n.isFunction(a)?function(c){n(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=n(this),f=a.match(F)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===L||"boolean"===c)&&(this.className&&n._data(this,"__className__",this.className),this.className=this.className||a===!1?"":n._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(vc," ").indexOf(b)>=0)return!0;return!1}}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var wc=n.now(),xc=/\?/,yc=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;n.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=n.trim(b+"");return e&&!n.trim(e.replace(yc,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():n.error("Invalid JSON: "+b)},n.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||n.error("Invalid XML: "+b),c};var zc,Ac,Bc=/#.*$/,Cc=/([?&])_=[^&]*/,Dc=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ec=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Fc=/^(?:GET|HEAD)$/,Gc=/^\/\//,Hc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Ic={},Jc={},Kc="*/".concat("*");try{Ac=location.href}catch(Lc){Ac=z.createElement("a"),Ac.href="",Ac=Ac.href}zc=Hc.exec(Ac.toLowerCase())||[];function Mc(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(F)||[];if(n.isFunction(c))while(d=f[e++])"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Nc(a,b,c,d){var e={},f=a===Jc;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Oc(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&n.extend(!0,a,c),a}function Pc(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Qc(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Ac,type:"GET",isLocal:Ec.test(zc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Kc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Oc(Oc(a,n.ajaxSettings),b):Oc(n.ajaxSettings,a)},ajaxPrefilter:Mc(Ic),ajaxTransport:Mc(Jc),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=n.ajaxSetup({},b),l=k.context||k,m=k.context&&(l.nodeType||l.jquery)?n(l):n.event,o=n.Deferred(),p=n.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!j){j={};while(b=Dc.exec(f))j[b[1].toLowerCase()]=b[2]}b=j[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return i&&i.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||Ac)+"").replace(Bc,"").replace(Gc,zc[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=n.trim(k.dataType||"*").toLowerCase().match(F)||[""],null==k.crossDomain&&(c=Hc.exec(k.url.toLowerCase()),k.crossDomain=!(!c||c[1]===zc[1]&&c[2]===zc[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(zc[3]||("http:"===zc[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=n.param(k.data,k.traditional)),Nc(Ic,k,b,v),2===t)return v;h=k.global,h&&0===n.active++&&n.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!Fc.test(k.type),e=k.url,k.hasContent||(k.data&&(e=k.url+=(xc.test(e)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=Cc.test(e)?e.replace(Cc,"$1_="+wc++):e+(xc.test(e)?"&":"?")+"_="+wc++)),k.ifModified&&(n.lastModified[e]&&v.setRequestHeader("If-Modified-Since",n.lastModified[e]),n.etag[e]&&v.setRequestHeader("If-None-Match",n.etag[e])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+Kc+"; q=0.01":""):k.accepts["*"]);for(d in k.headers)v.setRequestHeader(d,k.headers[d]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(d in{success:1,error:1,complete:1})v[d](k[d]);if(i=Nc(Jc,k,b,v)){v.readyState=1,h&&m.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,i.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,c,d){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),i=void 0,f=d||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,c&&(u=Pc(k,v,c)),u=Qc(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(n.lastModified[e]=w),w=v.getResponseHeader("etag"),w&&(n.etag[e]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,h&&m.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),h&&(m.trigger("ajaxComplete",[v,k]),--n.active||n.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){if(n.isFunction(a))return this.each(function(b){n(this).wrapAll(a.call(this,b))});if(this[0]){var b=n(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&1===a.firstChild.nodeType)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(n.isFunction(a)?function(b){n(this).wrapInner(a.call(this,b))}:function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!l.reliableHiddenOffsets()&&"none"===(a.style&&a.style.display||n.css(a,"display"))},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var Rc=/%20/g,Sc=/\[\]$/,Tc=/\r?\n/g,Uc=/^(?:submit|button|image|reset|file)$/i,Vc=/^(?:input|select|textarea|keygen)/i;function Wc(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||Sc.test(a)?d(a,e):Wc(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)Wc(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)Wc(c,a[c],b,e);return d.join("&").replace(Rc,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&Vc.test(this.nodeName)&&!Uc.test(a)&&(this.checked||!X.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(Tc,"\r\n")}}):{name:b.name,value:c.replace(Tc,"\r\n")}}).get()}}),n.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&$c()||_c()}:$c;var Xc=0,Yc={},Zc=n.ajaxSettings.xhr();a.ActiveXObject&&n(a).on("unload",function(){for(var a in Yc)Yc[a](void 0,!0)}),l.cors=!!Zc&&"withCredentials"in Zc,Zc=l.ajax=!!Zc,Zc&&n.ajaxTransport(function(a){if(!a.crossDomain||l.cors){var b;return{send:function(c,d){var e,f=a.xhr(),g=++Xc;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)void 0!==c[e]&&f.setRequestHeader(e,c[e]+"");f.send(a.hasContent&&a.data||null),b=function(c,e){var h,i,j;if(b&&(e||4===f.readyState))if(delete Yc[g],b=void 0,f.onreadystatechange=n.noop,e)4!==f.readyState&&f.abort();else{j={},h=f.status,"string"==typeof f.responseText&&(j.text=f.responseText);try{i=f.statusText}catch(k){i=""}h||!a.isLocal||a.crossDomain?1223===h&&(h=204):h=j.text?200:404}j&&d(h,i,j,f.getAllResponseHeaders())},a.async?4===f.readyState?setTimeout(b):f.onreadystatechange=Yc[g]=b:b()},abort:function(){b&&b(void 0,!0)}}}});function $c(){try{return new a.XMLHttpRequest}catch(b){}}function _c(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=z.head||n("head")[0]||z.documentElement;return{send:function(d,e){b=z.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||e(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var ad=[],bd=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=ad.pop()||n.expando+"_"+wc++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(bd.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&bd.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(bd,"$1"+e):b.jsonp!==!1&&(b.url+=(xc.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,ad.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||z;var d=v.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=n.buildFragment([a],b,e),e&&e.length&&n(e).remove(),n.merge([],d.childNodes))};var cd=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&cd)return cd.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=a.slice(h,a.length),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(f="POST"),g.length>0&&n.ajax({url:a,type:f,dataType:"html",data:b}).done(function(a){e=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,e||[a.responseText,b,a])}),this},n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};var dd=a.document.documentElement;function ed(a){return n.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&n.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;if(f)return b=f.documentElement,n.contains(b,e)?(typeof e.getBoundingClientRect!==L&&(d=e.getBoundingClientRect()),c=ed(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===n.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(c=a.offset()),c.top+=n.css(a[0],"borderTopWidth",!0),c.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-n.css(d,"marginTop",!0),left:b.left-c.left-n.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||dd;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||dd})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);n.fn[a]=function(d){return W(this,function(a,d,e){var f=ed(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?n(f).scrollLeft():e,c?e:n(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=Mb(l.pixelPosition,function(a,c){return c?(c=Kb(a,b),Ib.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return W(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var fd=a.jQuery,gd=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=gd),b&&a.jQuery===n&&(a.jQuery=fd),n},typeof b===L&&(a.jQuery=a.$=n),n});

// canvasprops.js
"use strict";function CanvasProps(i,t,s){this.width=i,this.height=t,this.fillColor=s,this.id="canvasProps",this.oType="CanvasProps"}CanvasProps.DEFAULT_HEIGHT=1080,CanvasProps.DEFAULT_WIDTH=1920,CanvasProps.DEFAULT_FILL_COLOR="#ffffff",CanvasProps.load=function(i){var t=new CanvasProps,s=Number(i.height);return t.height=isNaN(s)?CanvasProps.DEFAULT_HEIGHT:s,s=Number(i.width),t.width=isNaN(s)?CanvasProps.DEFAULT_WIDTH:s,t.fillColor=i.fillColor,t},CanvasProps.prototype={constructor:CanvasProps,clone:function(){return new CanvasProps(this.width,this.height,this.fillColor)},getWidth:function(){return this.width},setWidth:function(i){this.width=i,this.sync()},getHeight:function(){return this.height},setHeight:function(i){this.height=i,this.sync()},getFillColor:function(){return this.fillColor},setFillColor:function(i){this.fillColor=i,this.sync()},sync:function(){var i=getCanvas();i.height=this.height,i.width=this.width,i.fillColor=this.fillColor,minimap.initMinimap(),backgroundImage=null},toString:function(){return"CanvasProp [width: "+this.width+" height: "+this.height+" fillColor: "+this.fillColor+" ]"}};

// style.js
"use strict";function Style(){this.font=null,this.strokeStyle=null,this.fillStyle=null,this.globalAlpha=null,this.globalCompositeOperation=null,this.lineWidth=null,this.lineCap=this.STYLE_LINE_CAP_BUTT,this.lineJoin=this.STYLE_LINE_JOIN_MITER,this.shadowOffsetX=null,this.shadowOffsetY=null,this.shadowBlur=null,this.shadowColor=null,this.colorStops=[],this.gradientBounds=[],this.dashLength=0,this.lineStyle=null,this.image=null,this.oType="Style"}Style.LINE_STYLE_CONTINOUS="continuous",Style.LINE_STYLE_DOTTED="dotted",Style.LINE_STYLE_DASHED="dashed",Style.LINE_STYLES={continuous:{lineDash:[],lineDashOffset:0,lineCap:"round"},dotted:{lineDash:[1,2],lineDashOffset:0,lineCap:"round"},dashed:{lineDash:[4,4],lineDashOffset:0,lineCap:"round"}},Style.load=function(t){var i=new Style;return i.strokeStyle=t.strokeStyle,i.fillStyle=t.fillStyle,i.globalAlpha=t.globalAlpha,i.globalCompositeOperation=t.globalCompositeOperation,i.lineWidth=t.lineWidth,i.lineCap=t.lineCap,i.lineJoin=t.lineJoin,i.shadowOffsetX=t.shadowOffsetX,i.shadowOffsetY=t.shadowOffsetY,i.shadowBlur=t.shadowBlur,i.shadowColor=t.shadowColor,i.gradientBounds=t.gradientBounds,i.colorStops=t.colorStops,i.dashLength=t.dashLength,i.lineStyle=t.lineStyle,i.image=t.image,i},Style.prototype={STYLE_LINE_JOIN_ROUND:"round",STYLE_LINE_JOIN_BEVEL:"bevel",STYLE_LINE_JOIN_MITER:"miter",STYLE_LINE_CAP_BUTT:"butt",STYLE_LINE_CAP_ROUND:"round",STYLE_LINE_CAP_SQUARE:"square",constructor:Style,setupContext:function(t){for(var i in this)if(null!=this[i]&&void 0!=i&&"gradientBounds"!==i&&"colorStops"!==i&&"image"!==i&&"constructor"!==i)try{t[i]=this[i]}catch(t){alert("Style:setupContext() Error trying to setup context's property: ["+i+"] details = ["+t+"]\n")}if(DIAGRAMO.gradientFill&&0!=this.gradientBounds.length&&null!=this.fillStyle&&null==this.image){this.generateGradientColors();for(var e=t.createLinearGradient(this.gradientBounds[0],this.gradientBounds[1],this.gradientBounds[2],this.gradientBounds[3]),n=0;n<this.colorStops.length;n++)e.addColorStop(n,this.colorStops[n]);t.fillStyle=e}if(null!=this.lineStyle){var l=Style.LINE_STYLES[this.lineStyle],s=l.lineDash,o=[];switch(this.lineStyle){case Style.LINE_STYLE_CONTINOUS:o=s;break;case Style.LINE_STYLE_DOTTED:for(n=0;n<s.length;n++)0==n?o.push(s[n]):o.push(s[n]*t.lineWidth);break;case Style.LINE_STYLE_DASHED:for(n=0;n<s.length;n++)o.push(s[n]*t.lineWidth)}t.setLineDash(o),t.lineCap=l.lineCap,this.lineCap=l.lineCap}if(null!=this.image&&Browser.msie)t.createPattern(this.image,"no-repeat")},clone:function(){var t=new Style;for(var i in t)t[i]="colorStops"!=i&&"gradientBounds"!=i?this[i]:this[i].slice();return t},toJSON:function(){var t=this.clone();for(var i in t)null==t[i]&&delete t[i];return t},generateGradientColors:function(){var t=Util.hexToRgb(this.fillStyle),i=Util.rgbToHsl(t.r,t.g,t.b),e=i.slice();e[2]=e[2]+gradientLightStep,e[2]=e[2]>1?1:e[2];var n=i.slice();n[2]=n[2]-gradientLightStep,n[2]=n[2]<0?0:n[2],e=Util.hslToString(e),n=Util.hslToString(n),this.colorStops=[e,n]},getGradient:function(){return this.colorStops[0]+"/"+this.colorStops[1]},setGradient:function(t,i){this.colorStops[0]=i.split("/")[0],this.colorStops[1]=i.split("/")[1]},merge:function(t){for(var i in t)null!=this[i]&&void 0!=this[i]||"image"==i||(this[i]=t[i])},transform:function(t){if(0!=this.gradientBounds.length){var i=new Point(this.gradientBounds[0],this.gradientBounds[1]),e=new Point(this.gradientBounds[2],this.gradientBounds[3]);i.transform(t),e.transform(t),this.gradientBounds[0]=i.x,this.gradientBounds[1]=i.y,this.gradientBounds[2]=e.x,this.gradientBounds[3]=e.y}if(this.image){var n=new Point(0,0),l=new Point(this.image.width,this.image.height);n.transform(t),l.transform(t),this.image.width=l.x-n.x,this.image.height=l.y-n.y}},equals:function(t){return!(!t instanceof Style)},toSVG:function(){var t=' style="';return t+="stroke:"+(null==this.strokeStyle||""==this.strokeStyle?"none":this.strokeStyle)+";",t+="fill:"+(null==this.fillStyle||""==this.fillStyle?"none":this.fillStyle)+";",t+="stroke-width:"+(null==this.lineWidth||""==this.lineWidth?"none":this.lineWidth)+";",t+="stroke-linecap:"+(null==this.lineCap||""==this.lineCap?"inherit":this.lineCap)+";",t+="stroke-linejoin:"+(null==this.lineJoin||""==this.lineJoin?"inherit":this.lineJoin)+";",t+='" '}};

// primitives.js
"use strict";function Point(t,i){this.x=t,this.y=i,this.style=new Style,this.oType="Point"}function Line(t,i){this.startPoint=t,this.endPoint=i,this.style=new Style,this.style.gradientBounds=this.getBounds(),this.oType="Line"}function Polyline(){this.points=[],this.style=new Style,this.style.gradientBounds=this.getBounds(),this.startPoint=null,this.oType="Polyline"}function Polygon(){this.points=[],this.style=new Style,this.style.gradientBounds=this.getBounds(),this.oType="Polygon"}function DottedPolygon(t){this.points=[],this.style=new Style,this.style.gradientBounds=this.getBounds(),this.pattern=t,this.oType="DottedPolygon"}function QuadCurve(t,i,n){this.startPoint=t,this.controlPoint=i,this.endPoint=n,this.style=new Style,this.style.gradientBounds=this.getBounds(),this.oType="QuadCurve"}function CubicCurve(t,i,n,o){this.startPoint=t,this.controlPoint1=i,this.controlPoint2=n,this.endPoint=o,this.style=new Style,this.style.gradientBounds=this.getBounds(),this.oType="CubicCurve"}function Arc(t,i,n,o,e,s,r){this.endAngle=e,this.startAngle=o,this.middle=new Point(t,i),this.radius=n,this.curves=[];this.startPoint=null,this.endPoint=null,this.startAngleRadians=0,this.endAngleRadians=0;var h=Math.PI/180*o;this.startAngleRadians=h,this.endAngleRadians=Math.PI/180*e;for(var l=Math.PI/180*(e-o)/8,a=0;a<8;a++){a<1&&(this.startPoint=new Point(t+n*Math.cos(l*a),i+n*Math.sin(l*a)));var u=new Point(t+n*Math.cos(l*a),i+n*Math.sin(l*a)),P=n/Math.cos(.5*l),c=new Point(t+P*Math.cos(l*(a+1)-.5*l),i+P*Math.sin(l*(a+1)-.5*l));7==a&&(this.endPoint=new Point(t+n*Math.cos(l*(a+1)),i+n*Math.sin(l*(a+1))));var y=new Point(t+n*Math.cos(l*(a+1)),i+n*Math.sin(l*(a+1)));u.transform(Matrix.translationMatrix(-t,-i)),c.transform(Matrix.translationMatrix(-t,-i)),y.transform(Matrix.translationMatrix(-t,-i)),u.transform(Matrix.rotationMatrix(h)),c.transform(Matrix.rotationMatrix(h)),y.transform(Matrix.rotationMatrix(h)),u.transform(Matrix.translationMatrix(t,i)),c.transform(Matrix.translationMatrix(t,i)),y.transform(Matrix.translationMatrix(t,i)),this.curves.push(new QuadCurve(u,c,y))}this.styleFlag=r,this.style=new Style,this.style.gradientBounds=this.getBounds(),this.direction=s,this.oType="Arc"}function Ellipse(t,i,n){var o=.2761423749154,e=2*i*o,s=2*n*o;this.centerPoint=t,this.topLeftCurve=new CubicCurve(new Point(t.x-i,t.y),new Point(t.x-i,t.y-s),new Point(t.x-e,t.y-n),new Point(t.x,t.y-n)),this.topRightCurve=new CubicCurve(new Point(t.x,t.y-n),new Point(t.x+e,t.y-n),new Point(t.x+i,t.y-s),new Point(t.x+i,t.y)),this.bottomRightCurve=new CubicCurve(new Point(t.x+i,t.y),new Point(t.x+i,t.y+s),new Point(t.x+e,t.y+n),new Point(t.x,t.y+n)),this.bottomLeftCurve=new CubicCurve(new Point(t.x,t.y+n),new Point(t.x-e,t.y+n),new Point(t.x-i,t.y+s),new Point(t.x-i,t.y)),this.matrix=null,this.style=new Style,this.style.gradientBounds=this.getBounds(),this.oType="Ellipse"}function DashedArc(t,i,n,o,e,s,r,h){this.arc=new Arc(t,i,n,o,e,s,r),this.style=this.arc.style,this.dashWidth=h,this.lines=[];for(var l=0;l<100;l+=this.dashWidth){var a=new Arc(t,i,n+this.style.lineWidth/2,(e-o)/100*l,(e-o)/100*(l+1),!1);a.style.strokeStyle=this.style.strokeStyle,this.lines.push(a)}this.oType="DashedArc"}function Path(){this.primitives=[],this.style=new Style,this.style.gradientBounds=this.getBounds(),this.oType="Path"}function Figure(t){this.id=STACK.generateId(),this.name=t,this.primitives=[],this.groupId=-1,this.properties=[],this.style=new Style,this.style.gradientBounds=this.getBounds(),this.rotationCoords=[],this.url="",this.oType="Figure"}function NURBS(t){if(t.length<2)throw"NURBS: contructor() We need minimum 3 points to have a NURBS";this.points=Point.cloneArray(t),this.fragments=this.nurbsPoints(this.points),this.style=new Style,this.style.gradientBounds=this.getBounds(),this.oType="NURBS"}Point.load=function(t){var i=new Point(Number(t.x),Number(t.y));return i.style=Style.load(t.style),i},Point.loadArray=function(t){for(var i=[],n=0;n<t.length;n++)i.push(Point.load(t[n]));return i},Point.cloneArray=function(t){for(var i=[],n=0;n<t.length;n++)i.push(t[n].clone());return i},Point.prototype={constructor:Point,transform:function(t){null!=this.style&&this.style.transform(t);var i=this.x,n=this.y;this.x=t[0][0]*i+t[0][1]*n+t[0][2],this.y=t[1][0]*i+t[1][1]*n+t[1][2]},paint:function(t){if(null!=this.style&&this.style.setupContext(t),""!=this.style.strokeStyle){t.fillStyle=this.style.strokeStyle,t.beginPath();var i=1;null!=this.style.lineWidth&&(i=parseInt(this.style.lineWidth)),t.arc(this.x,this.y,i,0,Math.PI/180*360,!1),t.fill()}},equals:function(t){return t instanceof Point&&(this.x==t.x&&this.y==t.y&&this.style.equals(t.style))},clone:function(){var t=new Point(this.x,this.y);return t.style=this.style.clone(),t},near:function(t,i,n){return Math.sqrt(Math.pow(this.x-t,2)+Math.pow(this.y-i,2))<=n},contains:function(t,i){return this.x==t&&this.y==i},toString:function(){return"point("+this.x+","+this.y+")"},getPoints:function(){return[this]},getBounds:function(){return Util.getBounds(this.getPoints())},toSVG:function(){var t="";return t+="\n"+repeat("\t",INDENTATION)+'<circle cx="'+this.x+'" cy="'+this.y+'" r="1"',t+=this.style.toSVG(),t+="/>"}},Line.load=function(t){var i=new Line(Point.load(t.startPoint),Point.load(t.endPoint));return i.style=Style.load(t.style),i},Line.prototype={contructor:Line,transform:function(t){this.startPoint.transform(t),this.endPoint.transform(t),null!=this.style&&this.style.transform(t)},paint:function(t){if(t.beginPath(),null!=this.style&&this.style.setupContext(t),t.moveTo(this.startPoint.x,this.startPoint.y),0==this.style.dashLength)t.lineTo(this.endPoint.x,this.endPoint.y),t.closePath();else for(var i=Math.sqrt(Math.pow(this.startPoint.x-this.endPoint.x,2)+Math.pow(this.startPoint.y-this.endPoint.y,2)),n=Util.getAngle(this.startPoint,this.endPoint),o=!1,e=0;e<i;e+=this.style.dashLength){var s=this.startPoint.clone();s.transform(Matrix.translationMatrix(-this.startPoint.x,-this.startPoint.y)),s.transform(Matrix.translationMatrix(0,-e)),s.transform(Matrix.rotationMatrix(n)),s.transform(Matrix.translationMatrix(this.startPoint.x,this.startPoint.y)),0==o?(t.lineTo(s.x,s.y),o=!0):(t.moveTo(s.x,s.y),o=!1)}null!=this.style.strokeStyle&&""!=this.style.strokeStyle&&t.stroke()},clone:function(){var t=new Line(this.startPoint.clone(),this.endPoint.clone());return t.style=this.style.clone(),t},equals:function(t){return!(!t instanceof Line)&&(this.startPoint.equals(t.startPoint)&&this.endPoint.equals(t.endPoint)&&this.style.equals(t.style))},contains:function(t,i){if(Math.min(this.startPoint.x,this.endPoint.x)<=t&&t<=Math.max(this.startPoint.x,this.endPoint.x)&&Math.min(this.startPoint.y,this.endPoint.y)<=i&&i<=Math.max(this.startPoint.y,this.endPoint.y)){if(this.startPoint.x==this.endPoint.x)return t==this.startPoint.x;var n=(this.endPoint.y-this.startPoint.y)/(this.endPoint.x-this.startPoint.x);return i==n*t+(this.startPoint.y-n*this.startPoint.x)}return!1},near:function(t,i,n){if(this.endPoint.x===this.startPoint.x)return(this.startPoint.y-n<=i&&this.endPoint.y+n>=i||this.endPoint.y-n<=i&&this.startPoint.y+n>=i)&&t>this.startPoint.x-n&&t<this.startPoint.x+n;if(this.startPoint.y===this.endPoint.y)return(this.startPoint.x-n<=t&&this.endPoint.x+n>=t||this.endPoint.x-n<=t&&this.startPoint.x+n>=t)&&i>this.startPoint.y-n&&i<this.startPoint.y+n;var o=Math.min(this.endPoint.x,this.startPoint.x),e=Math.min(this.endPoint.y,this.startPoint.y),s=Math.max(this.endPoint.x,this.startPoint.x),r=Math.max(this.endPoint.y,this.startPoint.y),h=this.endPoint.y-this.startPoint.y,l=this.startPoint.x-this.endPoint.x,a=-(this.startPoint.x*this.endPoint.y-this.endPoint.x*this.startPoint.y),u=Math.abs((h*t+l*i+a)/Math.sqrt(Math.pow(h,2)+Math.pow(l,2))),P=(l*(l*t-h*i)-h*a)/(Math.pow(h,2)+Math.pow(l,2)),c=(h*(-l*t+h*i)-l*a)/(Math.pow(h,2)+Math.pow(l,2));return u<=n&&s>=P&&P>=o&&r>=c&&c>=e||this.startPoint.near(t,i,n)||this.endPoint.near(t,i,n)},getPoints:function(){var t=[];return t.push(this.startPoint),t.push(this.endPoint),t},getPoint:function(t){return new Point(t*(this.endPoint.x-this.startPoint.x)+this.startPoint.x,t*(this.endPoint.y-this.startPoint.y)+this.startPoint.y)},getMiddle:function(){return Util.getMiddle(this.startPoint,this.endPoint)},getLength:function(){return Util.getLength(this.startPoint,this.endPoint)},getBounds:function(){return Util.getBounds(this.getPoints())},toString:function(){return"line("+this.startPoint+","+this.endPoint+")"},toSVG:function(){var t="\n"+repeat("\t",INDENTATION)+'<line x1="'+this.startPoint.x+'" y1="'+this.startPoint.y+'" x2="'+this.endPoint.x+'" y2="'+this.endPoint.y+'"';return t+=this.style.toSVG(),t+=" />"}},Polyline.load=function(t){var i=new Polyline;return i.points=Point.loadArray(t.points),i.style=Style.load(t.style),i.startPoint=Point.load(t.startPoint),i},Polyline.prototype={constructor:Polyline,addPoint:function(t){0==this.points.length&&(this.startPoint=t),this.points.push(t),this.style.gradientBounds=this.getBounds()},transform:function(t){null!=this.style&&this.style.transform(t);for(var i=0;i<this.points.length;i++)this.points[i].transform(t)},getPoints:function(){return Point.cloneArray(this.points)},getVisualPoint:function(t){var i,n=this.getLength(),o=0;for(i=0;i<this.points.length-1&&!(o+Util.distance(this.points[i],this.points[i+1])>n*t);i++)o+=Util.distance(this.points[i],this.points[i+1]);var e=(n*t-o)/Util.distance(this.points[i],this.points[i+1]);return new Line(this.points[i],this.points[i+1]).getPoint(e)},getBounds:function(){return Util.getBounds(this.getPoints())},clone:function(){for(var t=new Polyline,i=0;i<this.points.length;i++)t.addPoint(this.points[i].clone());return t.style=this.style.clone(),t},getLength:function(){for(var t=0,i=0;i<this.points.length-1;i++)t+=Util.distance(this.points[i],this.points[i+1]);return t},equals:function(t){if(!t instanceof Polyline)return!1;if(t.points.length!=this.points.length)return!1;for(var i=0;i<this.points.length;i++)if(!this.points[i].equals(t.points[i]))return!1;return!!this.style.equals(t.style)&&!!this.startPoint.equals(t.startPoint)},paint:function(t){null!=this.style&&this.style.setupContext(t),Log.info("Polyline:paint() start"),t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var i=1;i<this.points.length;i++)t.lineTo(this.points[i].x,this.points[i].y);null!=this.style.fillStyle&&""!=this.style.fillStyle&&t.fill(),null!=this.style.strokeStyle&&""!=this.style.strokeStyle&&(t.strokeStyle=this.style.strokeStyle,t.stroke())},contains:function(t,i){return Util.isPointInside(new Point(t,i),this.getPoints())},near:function(t,i,n){for(var o=0;o<this.points.length-1;o++){if(new Line(this.points[o],this.points[o+1]).near(t,i,n))return!0}return!1},toString:function(){for(var t="polyline(",i=0;i<this.points.length;i++)t+=this.points[i].toString()+" ";return t+=")"},toSVG:function(){for(var t="\n"+repeat("\t",INDENTATION)+'<polyline points="',i=0;i<this.points.length;i++)t+=this.points[i].x+","+this.points[i].y+" ";return t+='"',t+=this.style.toSVG(),t+="/>"}},Polygon.load=function(t){var i=new Polygon;return i.points=Point.loadArray(t.points),i.style=Style.load(t.style),i},Polygon.prototype={contructor:Polygon,addPoint:function(t){this.points.push(t),this.style.gradientBounds=this.getBounds()},getPosition:function(){return[this.points[0].x,[this.points[0].y]]},paint:function(t){if(t.beginPath(),null!=this.style&&this.style.setupContext(t),this.points.length>1){t.moveTo(this.points[0].x,this.points[0].y);for(var i=1;i<this.points.length;i++)t.lineTo(this.points[i].x,this.points[i].y)}t.closePath(),null!=this.style.fillStyle&&""!=this.style.fillStyle&&t.fill(),null!=this.style.strokeStyle&&""!=this.style.strokeStyle&&t.stroke()},getPoints:function(){for(var t=[],i=0;i<this.points.length;i++)t.push(this.points[i]);return t},getBounds:function(){return Util.getBounds(this.getPoints())},fill:function(t,i){t.fillStyle=i,t.beginPath(),t.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n++)t.lineTo(this.points[n].x,this.points[n].y);t.lineTo(this.points[0].x,this.points[0].y),t.closePath(),t.fill()},near:function(t,i,n){var o=0;for(o=0;o<this.points.length-1;o++){var e=new Line(this.points[o],this.points[o+1]);if(e.near(t,i,n))return!0}return!!(e=new Line(this.points[o],this.points[0])).near(t,i,n)},equals:function(t){if(!t instanceof Polygon)return!1;if(t.points.length==this.points.length)for(var i=0;i<this.points.length;i++)if(!this.points[i].equals(t.points[i]))return!1;return!0},clone:function(){for(var t=new Polygon,i=0;i<this.points.length;i++)t.addPoint(this.points[i].clone());return t.style=this.style.clone(),t},contains:function(t,i,n){var o=new Point(t,i);return o||alert("Polygon: P is null"),n?Util.isPointInsideOrOnBorder(o,this.points):Util.isPointInside(o,this.points)},transform:function(t){null!=this.style&&this.style.transform(t);for(var i=0;i<this.points.length;i++)this.points[i].transform(t)},toString:function(){for(var t="polygon(",i=0;i<this.points.length;i++)t+=this.points[i].toString()+" ";return t+=")"},toSVG:function(){for(var t="\n"+repeat("\t",INDENTATION)+'<polygon points="',i=0;i<this.points.length;i++)t+=this.points[i].x+","+this.points[i].y+" ";return t+='" '+this.style.toSVG()+" />"}},DottedPolygon.load=function(t){var i=new DottedPolygon(t.pattern);return i.points=Point.loadArray(t.points),i.style=Style.load(t.style),i},DottedPolygon.prototype={contructor:DottedPolygon,addPoint:function(t){this.points.push(t)},getPosition:function(){return[this.points[0].x,[this.points[0].y]]},paint:function(t){if(null!=this.style&&this.style.setupContext(t),!(this.points.length<2)){var n=Point.cloneArray(this.points);if(null!=this.style.fillStyle&&""!=this.style.fillStyle){for(t.beginPath(),t.moveTo(n[0].x,n[0].y),i=1;i<n.length;i++)t.lineTo(n[i].x,n[i].y);t.fill()}null!=this.style.strokeStyle&&""!=this.style.strokeStyle&&(t.beginPath(),Util.decorate(t,n,this.pattern),t.stroke())}},getPoints:function(){for(var t=[],i=0;i<this.points.length;i++)t.push(this.points[i]);return t},getBounds:function(){return Util.getBounds(this.getPoints())},near:function(t,i,n){var o=0;for(o=0;o<this.points.length-1;o++){var e=new Line(this.points[o],this.points[o+1]);if(e.near(t,i,n))return!0}return!!(e=new Line(this.points[o],this.points[0])).near(t,i,n)},equals:function(t){if(!t instanceof DottedPolygon)return!1;if(t.points.length==this.points.length)for(var i=0;i<this.points.length;i++)if(!this.points[i].equals(t.points[i]))return!1;return!0},clone:function(){for(var t=new DottedPolygon,i=0;i<this.points.length;i++)t.addPoint(this.points[i].clone());return t.style=this.style.clone(),t},contains:function(t,i){var n=new Point(t,i);return n||alert("DottedPolygon: P is null"),Util.isPointInside(n,this.points)},transform:function(t){null!=this.style&&this.style.transform(t);for(var i=0;i<this.points.length;i++)this.points[i].transform(t)},toString:function(){for(var t="dottedpolygon(",i=0;i<this.points.length;i++)t+=this.points[i].toString()+" ";return t+=")"},toSVG:function(){return"\n"+repeat("\t",INDENTATION)+'<text x="20" y="40">DottedPolygon:toSVG() - no implemented</text>'}},QuadCurve.load=function(t){var i=new QuadCurve(Point.load(t.startPoint),Point.load(t.controlPoint),Point.load(t.endPoint));return i.style=Style.load(t.style),i},QuadCurve.loadArray=function(t){for(var i=[],n=0;n<t.length;n++)i.push(QuadCurve.load(t[n]));return i},QuadCurve.prototype={constructor:QuadCurve,transform:function(t){null!=this.style&&this.style.transform(t),this.startPoint.transform(t),this.controlPoint.transform(t),this.endPoint.transform(t)},getPoints:function(){for(var t=[],i=0;i<=1;i+=.01)t.push(this.getPoint(i));return t},getPoint:function(t){var i=Math.pow(1-t,2),n=2*(1-t)*t,o=Math.pow(t,2);return new Point(i*this.startPoint.x+n*this.controlPoint.x+o*this.endPoint.x,i*this.startPoint.y+n*this.controlPoint.y+o*this.endPoint.y)},getVisualPoint:function(t){var i=this.getPoints(),n=new Polyline;return n.points=i,n.getVisualPoint(t)},getLength:function(){for(var t=new Polyline,i=0;i<=1;i+=.01)t.addPoint(this.getPoint(i));return t.getLength()},getBounds:function(){return Util.getBounds(this.getPoints())},paint:function(t){t.beginPath(),null!=this.style&&this.style.setupContext(t),t.moveTo(this.startPoint.x,this.startPoint.y),t.quadraticCurveTo(this.controlPoint.x,this.controlPoint.y,this.endPoint.x,this.endPoint.y),null!=this.style.fillStyle&&""!=this.style.fillStyle&&t.fill(),null!=this.style.strokeStyle&&""!=this.style.strokeStyle&&t.stroke()},deprecated__near:function(t,i,n){if(!Util.isPointInside(new Point(t,i),[this.startPoint,this.controlPoint,this.endPoint])&&!this.startPoint.near(t,i,n)&&!this.endPoint.near(t,i,n))return!1;for(var o=0,e=100,s=(e-o)/2;s>=o&&s<=e&&e-o>.01;){var r=(s=o+(e-o)/2)/100,h=Math.pow(1-r,2),l=2*r*(1-r),a=(Math.pow(r,2),new Point(h*this.startPoint.x+l*this.controlPoint.x+this.fromStart*this.endPoint.x,h*this.startPoint.y+l*this.controlPoint.y+this.fromStart*this.endPoint.y));if(a.near(t,i,n))return!0;var u=Math.sqrt(Math.pow(this.startPoint.x-a.x,2)+Math.pow(this.startPoint.y-a.y,2)),P=Math.sqrt(Math.pow(this.startPoint.x-t,2)+Math.pow(this.startPoint.y-i,2));if(P<u)e=s;else{if(P==u)return!1;o=s}return this.startPoint.near(t,i,n)||this.endPoint.near(t,i,n)}},near:function(t,i,n){var o=this.getPoints(),e=new Polyline;return e.points=o,e.near(t,i,n)},clone:function(){var t=new QuadCurve(this.startPoint.clone(),this.controlPoint.clone(),this.endPoint.clone());return t.style=this.style.clone(),t},equals:function(t){return!(!t instanceof QuadCurve)&&(this.startPoint.equals(t.startPoint)&&this.controlPoint.equals(t.controlPoint)&&this.endPoint.equals(t.endPoint)&&this.style.equals(t.style))},deprecated_contains:function(t,i){return this.near(t,i,3)},deprecated_2_contains:function(t,i){var n=this.startPoint.x,o=this.startPoint.y,e=this.controlPoint.x,s=this.controlPoint.y,r=this.endPoint.x,h=this.endPoint.y,l=n-2*e+r,a=o-2*s+h,u=r-n,P=h-o,c=((t-n)*a-(i-o)*l)/(u*a-P*l);if(c<0||c>1||c!=c)return!1;var y=l*c*c+2*(e-n)*c+n,f=a*c*c+2*(s-o)*c+o,p=u*c+n,d=P*c+o;return t>=y&&t<p||t>=p&&t<y||i>=f&&i<d||i>=d&&i<f},contains:function(t,i){var n=this.getPoints(),o=new Polyline;return o.points=n,o.contains(t,i)},toString:function(){return"quad("+this.startPoint+","+this.controlPoint+","+this.endPoint+")"},toSVG:function(){var t="\n"+repeat("\t",INDENTATION)+'<path d="M';return t+=this.startPoint.x+","+this.endPoint.y,t+=" Q"+this.controlPoint.x+","+this.controlPoint.y,t+=" "+this.endPoint.x+","+this.endPoint.y,t+='" '+this.style.toSVG()+" />"}},CubicCurve.load=function(t){var i=new CubicCurve(Point.load(t.startPoint),Point.load(t.controlPoint1),Point.load(t.controlPoint2),Point.load(t.endPoint));return i.style=Style.load(t.style),i},CubicCurve.prototype={constructor:CubicCurve,transform:function(t){null!=this.style&&this.style.transform(t),this.startPoint.transform(t),this.controlPoint1.transform(t),this.controlPoint2.transform(t),this.endPoint.transform(t)},paint:function(t){t.beginPath(),null!=this.style&&(this.style.setupContext(t),Log.info("stroke style : "+this.style.strokeStyle)),t.beginPath(),t.moveTo(this.startPoint.x,this.startPoint.y),t.bezierCurveTo(this.controlPoint1.x,this.controlPoint1.y,this.controlPoint2.x,this.controlPoint2.y,this.endPoint.x,this.endPoint.y),null!=this.style.fillStyle&&""!=this.style.fillStyle&&t.fill(),null!=this.style.strokeStyle&&""!=this.style.strokeStyle&&t.stroke(),Log.groupEnd()},clone:function(){var t=new CubicCurve(this.startPoint.clone(),this.controlPoint1.clone(),this.controlPoint2.clone(),this.endPoint.clone());return t.style=this.style.clone(),t},equals:function(t){return!(!t instanceof CubicCurve)&&(this.startPoint.equals(t.startPoint)&&this.controlPoint1.equals(t.controlPoint1)&&this.controlPoint2.equals(t.controlPoint2)&&this.endPoint.equals(t.endPoint))},contains:function(t,i){for(var n=new Polyline,o=0;o<=1;o+=.01){var e=Math.pow(1-o,3),s=3*o*Math.pow(1-o,2),r=3*Math.pow(o,2)*(1-o),h=Math.pow(o,3),l=e*this.startPoint.x+s*this.controlPoint1.x+r*this.controlPoint2.x+h*this.endPoint.x,a=e*this.startPoint.y+s*this.controlPoint1.y+r*this.controlPoint2.y+h*this.endPoint.y;n.addPoint(new Point(l,a))}return n.contains(t,i)},near:function(t,i,n){for(var o=new Polyline,e=0;e<=1;e+=.01){var s=Math.pow(1-e,3),r=3*e*Math.pow(1-e,2),h=3*Math.pow(e,2)*(1-e),l=Math.pow(e,3),a=s*this.startPoint.x+r*this.controlPoint1.x+h*this.controlPoint2.x+l*this.endPoint.x,u=s*this.startPoint.y+r*this.controlPoint1.y+h*this.controlPoint2.y+l*this.endPoint.y;o.addPoint(new Point(a,u))}return o.near(t,i,n)},getPoints:function(){for(var t=[],i=0;i<=1;i+=.01)t.push(this.getPoint(i));return t},getBounds:function(){return Util.getBounds(this.getPoints())},getLength:function(){var t=new Polyline;return t.points=this.getPoints(),t.getLength()},getPoint:function(t){var i=Math.pow(1-t,3),n=3*t*Math.pow(1-t,2),o=3*Math.pow(t,2)*(1-t),e=Math.pow(t,3);return new Point(i*this.startPoint.x+n*this.controlPoint1.x+o*this.controlPoint2.x+e*this.endPoint.x,i*this.startPoint.y+n*this.controlPoint1.y+o*this.controlPoint2.y+e*this.endPoint.y)},getVisualPoint:function(t){var i=this.getPoints(),n=new Polyline;return n.points=i,n.getVisualPoint(t)},toString:function(){return"quad("+this.startPoint+","+this.controlPoint1+","+this.controlPoint2+","+this.endPoint+")"},toSVG:function(){var t="\n"+repeat("\t",INDENTATION)+'<path d="M';return t+=this.startPoint.x+","+this.endPoint.y,t+=" C"+this.controlPoint1.x+","+this.controlPoint1.y,t+=" "+this.controlPoint2.x+","+this.controlPoint2.y,t+=" "+this.endPoint.x+","+this.endPoint.y,t+='" '+this.style.toSVG()+"  />"}},Arc.load=function(t){var i=new Arc;return i.endAngle=t.endAngle,i.startAngle=t.startAngle,i.middle=Point.load(t.middle),i.radius=t.radius,i.curves=QuadCurve.loadArray(t.curves),i.startPoint=Point.load(t.startPoint),i.endPoint=Point.load(t.endPoint),i.startAngleRadians=t.startAngleRadians,i.endAngleRadians=t.endAngleRadians,i.styleFlag=t.styleFlag,i.style=Style.load(t.style),i.direction=t.direction,i},Arc.loadArray=function(t){for(var i=[],n=0;n<t.length;n++)i.push(Arc.load(t[n]));return i},Arc.prototype={constructor:Arc,transform:function(t){null!=this.style&&this.style.transform(t),this.middle.transform(t);for(var i=0;i<this.curves.length;i++)this.curves[i].transform(t)},paint:function(t){t.beginPath(),null!=this.style&&this.style.setupContext(t),t.lineWidth=this.style.lineWidth,t.moveTo(this.curves[0].startPoint.x,this.curves[0].startPoint.y);for(var i=0;i<this.curves.length;i++)t.quadraticCurveTo(this.curves[i].controlPoint.x,this.curves[i].controlPoint.y,this.curves[i].endPoint.x,this.curves[i].endPoint.y);1==this.styleFlag?t.closePath():2==this.styleFlag&&(t.lineTo(this.middle.x,this.middle.y),t.closePath()),null!=this.style.fillStyle&&""!=this.style.fillStyle&&t.fill(),null!=this.style.strokeStyle&&""!=this.style.strokeStyle&&t.stroke()},clone:function(){for(var t=new Arc(this.middle.x,this.middle.y,this.radius,this.startAngle,this.endAngle,this.direction,this.styleFlag),i=0;i<this.curves.length;i++)t.curves[i]=this.curves[i].clone();return t.style=this.style.clone(),t},equals:function(t){if(!t instanceof Arc)return!1;for(var i=0;i<this.curves.lenght;i++)if(!this.curves[i].equals(t.curves[i]))return!1;return this.startAngle==t.startAngle&&this.endAngle==t.endAngle&&this.middle.equals(t.middle)&&this.radius==t.radius&&this.numControlPoints==t.numControlPoints&&this.startPoint.equals(t.startPoint)&&this.endPoint.equals(t.endPoint)&&this.startAngleRadians==t.startAngleRadians&&this.endAngleRadians==t.endAngleRadians},near:function(t,i,n){for(var o=0;o<this.curves.length;o++)if(this.curves[o].near(t,i,n))return!0;return!1},contains:function(t,i){var n=this.getPoints();return Util.isPointInside(new Point(t,i),n)},getPoints:function(){var t=[];2==this.styleFlag&&t.push(this.middle);for(var i=0;i<this.curves.length;i++)for(var n=this.curves[i].getPoints(),o=0;o<n.length;o++)t.push(n[o]);return t},getBounds:function(){return Util.getBounds(this.getPoints())},toString:function(){return"arc("+new Point(this.x,this.y)+","+this.radius+","+this.startAngle+","+this.endAngle+","+this.direction+")"},toSVG:function(){var t="\n"+repeat("\t",INDENTATION)+'<path d="';t+=" M"+this.curves[0].startPoint.x+","+this.curves[0].startPoint.y;for(var i=0;i<this.curves.length;i++)t+=" Q"+this.curves[i].controlPoint.x+","+this.curves[i].controlPoint.y+" "+this.curves[i].endPoint.x+","+this.curves[i].endPoint.y;return t+='" ',t+=this.style.toSVG(),t+="/>"}},Ellipse.load=function(t){var i=new Ellipse(new Point(0,0),0,0);return i.offsetWidth=t.offsetWidth,i.offsetHeight=t.offsetHeight,i.centerPoint=Point.load(t.centerPoint),i.topLeftCurve=CubicCurve.load(t.topLeftCurve),i.topRightCurve=CubicCurve.load(t.topRightCurve),i.bottomRightCurve=CubicCurve.load(t.bottomRightCurve),i.bottomLeftCurve=CubicCurve.load(t.bottomLeftCurve),this.matrix=Matrix.clone(t.matrix),i.style=Style.load(t.style),i},Ellipse.prototype={constructor:Ellipse,transform:function(t){this.topLeftCurve.transform(t),this.topRightCurve.transform(t),this.bottomLeftCurve.transform(t),this.bottomRightCurve.transform(t),this.centerPoint.transform(t),this.style&&this.style.transform(t)},paint:function(t){null!=this.style&&this.style.setupContext(t),t.beginPath(),t.moveTo(this.topLeftCurve.startPoint.x,this.topLeftCurve.startPoint.y),t.bezierCurveTo(this.topLeftCurve.controlPoint1.x,this.topLeftCurve.controlPoint1.y,this.topLeftCurve.controlPoint2.x,this.topLeftCurve.controlPoint2.y,this.topLeftCurve.endPoint.x,this.topLeftCurve.endPoint.y),t.bezierCurveTo(this.topRightCurve.controlPoint1.x,this.topRightCurve.controlPoint1.y,this.topRightCurve.controlPoint2.x,this.topRightCurve.controlPoint2.y,this.topRightCurve.endPoint.x,this.topRightCurve.endPoint.y),t.bezierCurveTo(this.bottomRightCurve.controlPoint1.x,this.bottomRightCurve.controlPoint1.y,this.bottomRightCurve.controlPoint2.x,this.bottomRightCurve.controlPoint2.y,this.bottomRightCurve.endPoint.x,this.bottomRightCurve.endPoint.y),t.bezierCurveTo(this.bottomLeftCurve.controlPoint1.x,this.bottomLeftCurve.controlPoint1.y,this.bottomLeftCurve.controlPoint2.x,this.bottomLeftCurve.controlPoint2.y,this.bottomLeftCurve.endPoint.x,this.bottomLeftCurve.endPoint.y),null!=this.style.fillStyle&&""!=this.style.fillStyle&&t.fill(),null!=this.style.strokeStyle&&""!=this.style.strokeStyle&&t.stroke()},contains:function(t,i){for(var n=this.topLeftCurve.getPoints(),o=[this.topRightCurve,this.bottomRightCurve,this.bottomLeftCurve],e=0;e<o.length;e++)for(var s=o[e].getPoints(),r=0;r<s.length;r++)n.push(s[r]);return Util.isPointInside(new Point(t,i),n)},near:function(t,i,n){return this.topLeftCurve.near(t,i,n)||this.topRightCurve.near(t,i,n)||this.bottomLeftCurve.near(t,i,n)||this.bottomRightCurve.near(t,i,n)},equals:function(t){return!(!t instanceof Ellipse)&&(this.offsetWidth==t.offsetWidth&&this.offsetHeight==t.offsetHeight&&this.centerPoint.equals(t.centerPoint)&&this.topLeftCurve.equals(t.topLeftCurve)&&this.topRightCurve.equals(t.topRightCurve)&&this.bottomRightCurve.equals(t.bottomRightCurve)&&this.bottomLeftCurve.equals(t.bottomLeftCurve))},clone:function(){var t=new Ellipse(this.centerPoint.clone(),10,10);return t.topLeftCurve=this.topLeftCurve.clone(),t.topRightCurve=this.topRightCurve.clone(),t.bottomLeftCurve=this.bottomLeftCurve.clone(),t.bottomRightCurve=this.bottomRightCurve.clone(),t.style=this.style.clone(),t},toString:function(){return"ellipse("+this.centerPoint+","+this.xRadius+","+this.yRadius+")"},toSVG:function(){var t="\n"+repeat("\t",INDENTATION)+'<path d="M';return t+=this.topLeftCurve.startPoint.x+","+this.topLeftCurve.startPoint.y,t+=" C"+this.topLeftCurve.controlPoint1.x+","+this.topLeftCurve.controlPoint1.y,t+=" "+this.topLeftCurve.controlPoint2.x+","+this.topLeftCurve.controlPoint2.y,t+=" "+this.topLeftCurve.endPoint.x+","+this.topLeftCurve.endPoint.y,t+=" C"+this.topRightCurve.controlPoint1.x+","+this.topRightCurve.controlPoint1.y,t+=" "+this.topRightCurve.controlPoint2.x+","+this.topRightCurve.controlPoint2.y,t+=" "+this.topRightCurve.endPoint.x+","+this.topRightCurve.endPoint.y,t+=" C"+this.bottomRightCurve.controlPoint1.x+","+this.bottomRightCurve.controlPoint1.y,t+=" "+this.bottomRightCurve.controlPoint2.x+","+this.bottomRightCurve.controlPoint2.y,t+=" "+this.bottomRightCurve.endPoint.x+","+this.bottomRightCurve.endPoint.y,t+=" C"+this.bottomLeftCurve.controlPoint1.x+","+this.bottomLeftCurve.controlPoint1.y,t+=" "+this.bottomLeftCurve.controlPoint2.x+","+this.bottomLeftCurve.controlPoint2.y,t+=" "+this.bottomLeftCurve.endPoint.x+","+this.bottomLeftCurve.endPoint.y,t+='" '+this.style.toSVG()+"  />"},getPoints:function(){for(var t=[],i=[this.topLeftCurve,this.topRightCurve,this.bottomRightCurve,this.bottomLeftCurve],n=0;n<i.length;n++)for(var o=i[n].getPoints(),e=0;e<o.length;e++)t.push(o[e]);return t},getBounds:function(){return Util.getBounds(this.getPoints())}},DashedArc.load=function(t){var i=new DashedArc(100,100,30,0,360,!1,0,6);return i.style.fillStyle="#ffffff",i.arc=Arc.load(t.arc),i.style=i.arc.style,i.dashWidth=t.dashWidth,i.lines=Arc.loadArray(t.lines),i},DashedArc.prototype={constructor:DashedArc,transform:function(t){this.arc.transform(t);for(var i=0;i<this.lines.length;i++)this.lines[i].transform(t)},getBounds:function(){return this.arc.getBounds()},getPoints:function(){return this.arc.getPoints()},contains:function(t,i){return this.arc.contains(t,i)},near:function(t,i,n){return this.arc.near(t,i,n)},toString:function(){return this.arc.toString()},toSVG:function(){throw"Arc:toSVG() - not implemented"},equals:function(t){if(!t instanceof DashedArc)return!1;if(this.lines.length!=t.lines.length)return!1;for(var i in this.lines)if(!this.lines[i].equals(t.lines[i]))return!1;return this.arc.equals(t.arc)&&this.style.equals(t.style)&&this.dashWidth==t.dashWidth},clone:function(){return this.arc.clone()},paint:function(t){this.style.setupContext(t),t.lineCap="round";for(var i=0;i<this.lines.length;i++)t.beginPath(),this.lines[i].paint(t),t.stroke();this.style.strokeStyle=null,this.arc.paint(t)}},Path.load=function(t){var i=new Path;i.style=Style.load(t.style);for(var n=0;n<t.primitives.length;n++)"Point"==t.primitives[n].oType?i.primitives.push(Point.load(t.primitives[n])):"Line"==t.primitives[n].oType?i.primitives.push(Line.load(t.primitives[n])):"Polyline"==t.primitives[n].oType?i.primitives.push(Polyline.load(t.primitives[n])):"Polygon"==t.primitives[n].oType?i.primitives.push(Polygon.load(t.primitives[n])):"QuadCurve"==t.primitives[n].oType?i.primitives.push(QuadCurve.load(t.primitives[n])):"CubicCurve"==t.primitives[n].oType?i.primitives.push(CubicCurve.load(t.primitives[n])):"Arc"==t.primitives[n].oType?i.primitives.push(Arc.load(t.primitives[n])):"Ellipse"==t.primitives[n].oType?i.primitives.push(Ellipse.load(t.primitives[n])):"DashedArc"==t.primitives[n].oType?i.primitives.push(DashedArc.load(t.primitives[n])):"Path"==t.primitives[n].oType&&i.primitives.push(Path.load(t.primitives[n]));return i},Path.prototype={constructor:Path,transform:function(t){for(var i=0;i<this.primitives.length;i++)this.primitives[i].transform(t)},addPrimitive:function(t){this.primitives.push(t),this.style.gradientBounds=this.getBounds()},contains:function(t,i){for(var n=[],o=0;o<this.primitives.length;o++){if(this.primitives[o].contains(t,i))return!0;for(var e=this.primitives[o].getPoints(),s=0;s<e.length;s++)n.push(e[s])}return Util.isPointInside(new Point(t,i),n)},near:function(t,i,n){for(var o=0;o<this.primitives.length;o++)if(this.primitives[o].near(t,i,n))return!0;return!1},getPoints:function(){for(var t=[],i=0;i<this.primitives.length;i++)t=t.concat(this.primitives[i].getPoints());return t},getBounds:function(){var t=[];for(var i in this.primitives){var n=this.primitives[i].getBounds();t.push(new Point(n[0],n[1])),t.push(new Point(n[2],n[3]))}return Util.getBounds(t)},clone:function(){for(var t=new Path,i=0;i<this.primitives.length;i++)t.addPrimitive(this.primitives[i].clone()),this.primitives[i].parentFigure&&(t.primitives[i].parentFigure=t);return t},equals:function(t){if(!t instanceof Path)return!1;for(var i=0;i<this.primitives.length;i++)if(!this.primitives[i].equals(t.primitives[i]))return!1;return!0},paint:function(t){if(t.save(),null!=this.style&&this.style.setupContext(t),null!=this.style.fillStyle&&""!=this.style.fillStyle){t.beginPath(),t.moveTo(this.primitives[0].startPoint.x,this.primitives[0].startPoint.y);for(var i=0;i<this.primitives.length;i++){if((o=this.primitives[i])instanceof Line)t.lineTo(o.endPoint.x,o.endPoint.y);else if(o instanceof Polyline)for(var n=0;n<o.points.length;n++)t.lineTo(o.points[n].x,o.points[n].y);else o instanceof QuadCurve?t.quadraticCurveTo(o.controlPoint.x,o.controlPoint.y,o.endPoint.x,o.endPoint.y):o instanceof CubicCurve&&t.bezierCurveTo(o.controlPoint1.x,o.controlPoint1.y,o.controlPoint2.x,o.controlPoint2.y,o.endPoint.x,o.endPoint.y)}t.fill()}if(null!=this.style.strokeStyle&&""!=this.style.strokeStyle)for(i=0;i<this.primitives.length;i++){var o=this.primitives[i];if(t.save(),t.beginPath(),t.moveTo(o.startPoint.x,o.startPoint.y),o instanceof Line)t.lineTo(o.endPoint.x,o.endPoint.y),t.closePath();else if(o instanceof Polyline)for(n=0;n<o.points.length;n++)t.lineTo(o.points[n].x,o.points[n].y);else o instanceof QuadCurve?t.quadraticCurveTo(o.controlPoint.x,o.controlPoint.y,o.endPoint.x,o.endPoint.y):o instanceof CubicCurve?t.bezierCurveTo(o.controlPoint1.x,o.controlPoint1.y,o.controlPoint2.x,o.controlPoint2.y,o.endPoint.x,o.endPoint.y):o instanceof Arc&&t.arc(o.startPoint.x,o.startPoint.y,o.radius,o.startAngleRadians,o.endAngleRadians,!0);var e=o.style.clone();null==o.style?o.style=this.style:o.style.merge(this.style),o.style.setupContext(t),t.stroke(),o.style=e,t.restore()}t.restore()},toSVG:function(){for(var t="\n"+repeat("\t",INDENTATION)+'<path d="',i=null,n=0;n<this.primitives.length;n++){var o=this.primitives[n];if(o instanceof Point)throw"Path:toSVG()->Point - not implemented";if(o instanceof Line)null!=i&&i.endPoint.x==o.startPoint.x&&i.endPoint.y==o.startPoint.y||(t+=" M"+o.startPoint.x+","+o.startPoint.y),t+=" L"+o.endPoint.x+","+o.endPoint.y;else if(o instanceof Polyline)for(var e=0;e<o.points.length;e++)t+=" L"+o.points[e].x+","+o.points[e].y;else if(o instanceof QuadCurve)t+=" Q"+o.controlPoint.x+","+o.controlPoint.y+","+o.endPoint.x+","+o.endPoint.y;else{if(!(o instanceof CubicCurve))throw o instanceof Arc?"Path:toSVG()->Arc - not implemented":o instanceof Polyline?"Path:toSVGPolylineArc - not implemented":"Path:toSVG()->unknown primitive rendering not implemented";t+=" C"+o.controlPoint1.x+","+o.controlPoint1.y+","+o.controlPoint2.x+","+o.controlPoint2.y+","+o.endPoint.x+","+o.endPoint.y}i=o}return t+='" ',t+=this.style.toSVG(),t+=" />"}},Figure.load=function(t){var i=new Figure;i.id=t.id,i.name=t.name;for(var n=0;n<t.primitives.length;n++)"Point"==t.primitives[n].oType?i.addPrimitive(Point.load(t.primitives[n])):"Line"==t.primitives[n].oType?i.addPrimitive(Line.load(t.primitives[n])):"Polyline"==t.primitives[n].oType?i.addPrimitive(Polyline.load(t.primitives[n])):"Polygon"==t.primitives[n].oType?i.addPrimitive(Polygon.load(t.primitives[n])):"DottedPolygon"==t.primitives[n].oType?i.addPrimitive(DottedPolygon.load(t.primitives[n])):"QuadCurve"==t.primitives[n].oType?i.addPrimitive(QuadCurve.load(t.primitives[n])):"CubicCurve"==t.primitives[n].oType?i.addPrimitive(CubicCurve.load(t.primitives[n])):"Arc"==t.primitives[n].oType?i.addPrimitive(Arc.load(t.primitives[n])):"Ellipse"==t.primitives[n].oType?i.addPrimitive(Ellipse.load(t.primitives[n])):"DashedArc"==t.primitives[n].oType?i.addPrimitive(DashedArc.load(t.primitives[n])):"Text"==t.primitives[n].oType?i.addPrimitive(Text.load(t.primitives[n])):"Path"==t.primitives[n].oType?i.addPrimitive(Path.load(t.primitives[n])):"Figure"==t.primitives[n].oType?i.addPrimitive(Figure.load(t.primitives[n])):"ImageFrame"==t.primitives[n].oType&&i.addPrimitive(ImageFrame.load(t.primitives[n]));return i.groupId=t.groupId,i.properties=BuilderProperty.loadArray(t.properties),i.style=Style.load(t.style),i.rotationCoords=Point.loadArray(t.rotationCoords),i.url=t.url,i},Figure.loadArray=function(t){for(var i=[],n=0;n<t.length;n++)i.push(Figure.load(t[n]));return i},Figure.prototype={constructor:Figure,getText:function(){for(var t=0;t<this.primitives.length;t++)if(this.primitives[t]instanceof Text)return this.primitives[t];return""},setText:function(t){for(var i=0;i<this.primitives.length;i++)this.primitives[i]instanceof Text&&(this.primitives[i]=t)},transform:function(t,i){"undefined"!=i&&void 0!=i||(i=!0);for(var n=0;n<this.primitives.length;n++)this.primitives[n].transform(t);this.style.transform(t),i&&CONNECTOR_MANAGER.connectionPointTransform(this.id,t),0!=this.rotationCoords.length&&(this.rotationCoords[0].transform(t),this.rotationCoords[1].transform(t))},getPoints:function(){for(var t=[],i=0;i<this.primitives.length;i++)t=t.concat(this.primitives[i].getPoints());return t},addPrimitive:function(t){t.id=this.primitives.length,this.primitives.push(t),this.style.gradientBounds=this.getBounds()},finalise:function(){var t=this.getBounds();if(null==t)throw"Figure bounds are null !!!";this.rotationCoords[0]=new Point(t[0]+(t[2]-t[0])/2,t[1]+(t[3]-t[1])/2),this.rotationCoords[1]=new Point(this.rotationCoords[0].x,t[1])},clone:function(){for(var t=new Figure(this.name),i=0;i<this.primitives.length;i++)t.addPrimitive(this.primitives[i].clone());return t.properties=this.properties.slice(0),t.style=this.style.clone(),t.rotationCoords[0]=this.rotationCoords[0].clone(),t.rotationCoords[1]=this.rotationCoords[1].clone(),t.url=this.url,CONNECTOR_MANAGER.connectionPointGetAllByParent(this.id).forEach(function(i){CONNECTOR_MANAGER.connectionPointCreate(t.id,i.point.clone(),ConnectionPoint.TYPE_FIGURE)}),t},applyAnotherFigureStyle:function(t){this.style=t.style.clone();var i=this.getText();if(i instanceof Text){var n=i.getTextStr(),o=i.vector;(i=t.getText().clone()).setTextStr(n),i.vector=o,this.setText(i)}},contains:function(t,i){for(var n=[],o=0;o<this.primitives.length;o++){if(this.primitives[o].contains(t,i))return!0;n=n.concat(this.primitives[o].getPoints())}return Util.isPointInside(new Point(t,i),n)},getBounds:function(){for(var t=[],i=0;i<this.primitives.length;i++){var n=this.primitives[i].getBounds();t.push(new Point(n[0],n[1])),t.push(new Point(n[2],n[3]))}return Util.getBounds(t)},paint:function(t){this.style&&this.style.setupContext(t);for(var i=0;i<this.primitives.length;i++){t.save();var n=this.primitives[i],o=null;n.style&&(o=n.style.clone()),null==n.style?n.style=this.style.clone():n.style.merge(this.style),n.paint(t),n.style=o,t.restore()}},equals:function(t){if(!t instanceof Figure)return Log.info("Figure:equals() 0"),!1;if(this.primitives.length!=t.primitives.length)return Log.info("Figure:equals() 2"),!1;for(var i=0;i<this.primitives.length;i++)if(!this.primitives[i].equals(t.primitives[i]))return Log.info("Figure:equals() 1"),!1;if(this.groupId!=t.groupId)return!1;if(this.rotationCoords.length!=t.rotationCoords.length)return!1;for(var i in this.rotationCoords)if(!this.rotationCoords[i].equals(t.rotationCoords[i]))return!1;return!!this.style.equals(t.style)&&!this.url!=t.url},near:function(t,i,n){for(var o=0;o<this.primitives.length;o++)if(this.primitives[o].near(t,i,n))return!0;return!1},toString:function(){for(var t=this.name+" [id: "+this.id+"] (",i=0;i<this.primitives.length;i++)t+=this.primitives[i].toString();return t+=")"},toSVG:function(){var t="";t+="\n"+repeat("\t",INDENTATION)+"\x3c!--Figure start--\x3e";for(var i=0;i<this.primitives.length;i++){var n=this.primitives[i];throw n.style&&n.style.clone(),null==n.style?n.style=this.style:n.style.merge(this.style),t+=this.primitives[i].toSVG(),Exception("Figure->toSVG->URL not exported")}return t+="\n"+repeat("\t",INDENTATION)+"\x3c!--Figure end--\x3e\n"}},NURBS.load=function(t){var i=new NURBS(Point.loadArray(t.points));return i.style=Style.load(t.style),i},NURBS.prototype={nurbsPoints:function(t){var n=t.length,o=[];if(2===n)return o.push(new Line(t[0],t[1])),o;if(3===n)return o.push(new QuadCurve(t[0],t[1],t[2])),o;if(4===n)return o.push(new CubicCurve(t[0],t[1],t[2],t[3])),o;function e(t,i){return new Point(t.x+i.x,t.y+i.y)}function s(t,i){if(0==i)throw"Division by zero not allowed (yet :) "+this.callee;return new Point(t.x/i,t.y/i)}function r(t,i){return new Point(t.x*i,t.y*i)}var h,l=[0,0,0];for(h=0;h<=n-3;h++)l.push(h);for(l.push(n-3,n-3),i=1;i<=n-3;i++){var a=s(e(r(t[i],l[i+4]-l[i+2]),r(t[i+1],l[i+2]-l[i+1])),l[i+4]-l[i+1]),u=(l[i+3]-l[i+2])/(l[i+3]-l[i+1]),P=s(e(r(t[i-1],l[i+3]-l[i+2]),r(t[i],l[i+2]-l[i])),l[i+3]-l[i]),c=r(a,(l[i+2]-l[i+1])/(l[i+3]-l[i+1])),y=e(r(P,u),c),f=s(e(r(t[i],l[i+4]-l[i+3]),r(t[i+1],l[i+3]-l[i+1])),l[i+4]-l[i+1]),p=(l[i+3]-l[i+2])/(l[i+4]-l[i+2]),d=s(e(r(t[i+1],l[i+5]-l[i+3]),r(t[i+2],l[i+3]-l[i+2])),l[i+5]-l[i+2]),v=r(f,(l[i+4]-l[i+3])/(l[i+4]-l[i+2])),g=e(r(d,p),v);o.push(new CubicCurve(y,a,f,g))}return o},paint:function(t){t.beginPath(),null!=this.style&&this.style.setupContext(t);for(var i=0;i<this.fragments.length;i++){var n=this.fragments[i];n.style=this.style.clone(),n.paint(t)}},transform:function(t){for(var i=0;i<this.points.length;i++){this.points[i].transform(t)}for(var n=0;n<this.fragments.length;n++){this.fragments[n].transform(t)}},contains:function(t,i){for(var n=0;n<this.fragments.length;n++){if(this.fragments[n].contains(t,i))return!0}return!1},getLength:function(){for(var t=0,i=0;i<this.fragments.length;i++)t+=this.fragments[i].getLength();return t},_deprecated_getMiddle:function(){var t,i=[];for(t=0;t<this.fragments.length;t++)i.push(this.fragments[t].getLength());t=0;var n=0;for(t=0;t<this.fragments.length&&!(n+this.fragments[t].getLength()>this.getLength()/2);t++)n+=this.fragments[t].getLength();var o=(this.getLength()/2-n)/this.fragments[t].getLength();return this.fragments[t].getVisualPoint(o)},getMiddle:function(){var t=this.getPoints(),i=new Polyline;return i.points=t,i.getVisualPoint(.5)},equals:function(t){throw Exception("Not implemented")},toString:function(){throw Exception("Not implemented")},toSVG:function(){for(var t="\n"+repeat("\t",INDENTATION)+'<path d="',i=0;i<this.fragments.length;i++){var n=this.fragments[i];t+="M"+n.startPoint.x+","+n.endPoint.y,t+=" C"+n.controlPoint1.x+","+n.controlPoint1.y,t+=" "+n.controlPoint2.x+","+n.controlPoint2.y,t+=" "+n.endPoint.x+","+n.endPoint.y}return t+='" style="'+this.style.toSVG()+'"  />'},clone:function(){throw Exception("Not implemented")},getBounds:function(){return Util.getBounds(this.getPoints())},near:function(t,i,n){for(var o=0;o<this.fragments.length;o++){if(this.fragments[o].near(t,i,n))return!0}return!1},getPoints:function(){for(var t=[],i=0;i<this.fragments.length;i++){var n=this.fragments[i];t=t.concat(n.getPoints())}return t}};var R90=[[Math.cos(.0872664626),-Math.sin(.0872664626),0],[Math.sin(.0872664626),Math.cos(.0872664626),0],[0,0,1]],R90A=[[Math.cos(.0872664626),Math.sin(.0872664626),0],[-Math.sin(.0872664626),Math.cos(.0872664626),0],[0,0,1]],IDENTITY=[[1,0,1],[0,1,0],[0,0,1]];if("undefined"==typeof document){print("\n--==Point==--\n"),p=new Point(10,10),print(p),print("\n"),p.transform(R90),print(p),print("\n--==Line==--\n"),l=new Line(new Point(10,23),new Point(34,50)),print(l),print("\n"),print("\n--==Polyline==--\n"),polyline=new Polyline;for(var i=0;i<5;i++)polyline.addPoint(new Point(i,i*i));print(polyline),print("\n"),print("\n--==Quad curve==--\n"),q=new QuadCurve(new Point(75,25),new Point(25,25),new Point(25,62)),print(q),print("\n"),q.transform(R90),print(q),print("\n--==Cubic curve==--\n"),q=new CubicCurve(new Point(75,40),new Point(75,37),new Point(70,25),new Point(50,25)),print(q),print("\n"),q.transform(R90),print(q),print("\n--==Figure==--\n"),f=new Figure,f.addPrimitive(p),f.addPrimitive(q),print(f),f.transform(R90),print("\n"),print(f),print("\n")}

// imageFrame.js
"use strict";function ImageFrame(t,e,i,r,a,o){this.loaded=!1,this.vector=[new Point(e,i),new Point(e,i-20),new Point(e+20,i)],this.constraints=!1,this.frameWidth=a,a&&(this.constraints=!0),this.frameHeight=o,o&&(this.constraints=!0),this.scale=r,this.keepRatio=!0,this.url=t,this.image=new Image,this.setUrl(t),this.debug=!1,this.style=new Style,this.oType="ImageFrame"}ImageFrame.DEFAULT_WIDTH=10,ImageFrame.DEFAULT_HEIGHT=10,ImageFrame.load=function(t){var e=new ImageFrame;return e.vector=Point.loadArray(t.vector),e.constraints=t.constraints,e.frameHeight=t.frameHeight,e.frameWidth=t.frameWidth,e.scale=t.scale,e.keepRatio=t.keepRatio,e.setUrl(t.url),e.debug=t.debug,e},ImageFrame.prototype={constructor:ImageFrame,toJSON:function(){return{loaded:(t=this).loaded,vector:t.vector,constraints:t.constraints,frameWidth:t.frameWidth,frameHeight:t.frameHeight,scale:t.scale,keepRatio:t.keepRatio,url:t.url,debug:t.debug,style:t.style,oType:t.oType};var t},setUrl:function(t){var e,i;Log.info("ImageFrame.setUrl() : "+t),t&&(this.url=t,this.loaded=!1,this.image=new Image,this.image.onload=(i=this,function(){i.loaded=!0,Log.info("ImageFrame.setUrl(): image finally loaded! :)"),Log.info("ImageFrame.setUrl(): image width:"+i.image.width+" height:"+i.image.height),i.constraints?Log.info("Constrains present"):(Log.info("Original image loaded. Image height: "+i.image.height+" width: "+i.image.width),i.constraints||(i.frameHeight=i.image.height,i.frameWidth=i.image.width)),Log.info("ImageFrame.setUrl(): force repaint"),draw()}),this.image.onerror=(e=this,function(){Log.error("Error with image. URL: "+e.url+" loaded: "+e.loaded)}),this.image.src=t)},getUrl:function(){return this.image.src?this.image.src:""},paint:function(t){if(this.loaded){t.save();var e=Util.getAngle(this.vector[0],this.vector[1]);t.translate(this.vector[0].x,this.vector[0].y),t.rotate(e),t.translate(-this.vector[0].x,-this.vector[0].y),Log.group("A paint"),Log.info("ImageFrame.paint(): frameWidth: "+this.frameWidth+" frameHeight: "+this.frameHeight),Log.info("ImageFrame.paint(): image.width: "+this.image.width+" image.height: "+this.image.height);var i=this.frameWidth/this.image.width,r=this.frameHeight/this.image.height,a=Math.min(i,r);Log.info("ImageFrame.paint(): wRatio: "+i+" vRatio: "+r+" ratio: "+a);var o=this.image.width*a,s=this.image.height*a;Log.info("ImageFrame.paint(): imgScaledWidth: "+o+" imgScaleHeight: "+s),t.drawImage(this.image,this.vector[0].x-o/2,this.vector[0].y-s/2,o,s),Log.groupEnd(),t.restore()}},transform:function(t){var e=Math.sqrt(Math.pow(this.vector[0].x-this.vector[1].x,2)+Math.pow(this.vector[0].y-this.vector[1].y,2)),i=Math.sqrt(Math.pow(this.vector[0].x-this.vector[2].x,2)+Math.pow(this.vector[0].y-this.vector[2].y,2));if(this.vector[0].transform(t),this.vector[1].transform(t),this.vector[2].transform(t),this.scale){var r=Math.sqrt(Math.pow(this.vector[0].x-this.vector[1].x,2)+Math.pow(this.vector[0].y-this.vector[1].y,2))/e,a=Math.sqrt(Math.pow(this.vector[0].x-this.vector[2].x,2)+Math.pow(this.vector[0].y-this.vector[2].y,2))/i;this.frameHeight*=r,this.frameWidth*=a,1==r&&1==a||(this.constraints=!0)}},getAngle:function(){return Util.getAngle(this.vector[0],this.vector[1])},getNormalBounds:function(){var t=new Polygon;return this.frameWidth&&this.frameHeight?(t.addPoint(new Point(this.vector[0].x-this.frameWidth/2,this.vector[0].y-this.frameHeight/2)),t.addPoint(new Point(this.vector[0].x+this.frameWidth/2,this.vector[0].y-this.frameHeight/2)),t.addPoint(new Point(this.vector[0].x+this.frameWidth/2,this.vector[0].y+this.frameHeight/2)),t.addPoint(new Point(this.vector[0].x-this.frameWidth/2,this.vector[0].y+this.frameHeight/2))):(t.addPoint(new Point(this.vector[0].x-ImageFrame.DEFAULT_WIDTH/2,this.vector[0].y-ImageFrame.DEFAULT_HEIGHT/2)),t.addPoint(new Point(this.vector[0].x+ImageFrame.DEFAULT_WIDTH/2,this.vector[0].y-ImageFrame.DEFAULT_HEIGHT/2)),t.addPoint(new Point(this.vector[0].x+ImageFrame.DEFAULT_WIDTH/2,this.vector[0].y+ImageFrame.DEFAULT_HEIGHT/2)),t.addPoint(new Point(this.vector[0].x-ImageFrame.DEFAULT_WIDTH/2,this.vector[0].y+ImageFrame.DEFAULT_HEIGHT/2))),t},contains:function(t,e){var i=!1;if(this.loaded){var r=this.getAngle(),a=this.getNormalBounds();a.transform(Matrix.translationMatrix(-this.vector[0].x,-this.vector[0].y)),a.transform(Matrix.rotationMatrix(r)),a.transform(Matrix.translationMatrix(this.vector[0].x,this.vector[0].y));try{i=a.contains(t,e)}catch(t){Log.error("ImageFrame->contains(error): "+t)}}return i},getBounds:function(){var t=Util.getAngle(this.vector[0],this.vector[1]),e=this.getNormalBounds();return e.transform(Matrix.translationMatrix(-this.vector[0].x,-this.vector[0].y)),e.transform(Matrix.rotationMatrix(t)),e.transform(Matrix.translationMatrix(this.vector[0].x,this.vector[0].y)),e.getBounds()},getPoints:function(){var t=Util.getAngle(this.vector[0],this.vector[1]),e=this.getNormalBounds();return e.transform(Matrix.translationMatrix(-this.vector[0].x,-this.vector[0].y)),e.transform(Matrix.rotationMatrix(t)),e.transform(Matrix.translationMatrix(this.vector[0].x,this.vector[0].y)),e.getPoints()},clone:function(){var t=new ImageFrame;return t.frameHeight=this.frameHeight,t.frameWidth=this.frameWidth,t.keepRatio=this.keepRatio,t.constraints=this.constraints,t.vector=Point.cloneArray(this.vector),t.setUrl(this.url),t},toSVG:function(){var t="";if(this.loaded){var e=180*this.getAngle()/Math.PI;t+="\n"+repeat("\t",INDENTATION)+'<g transform="rotate ('+e+", "+this.vector[0].x+", "+this.vector[0].y+')">',INDENTATION++,Log.group("A paint"),Log.info("ImageFrame.toSVG(): frameWidth: "+this.frameWidth+" frameHeight: "+this.frameHeight),Log.info("ImageFrame.toSVG(): image.width: "+this.image.width+" image.height: "+this.image.height);var i=this.frameWidth/this.image.width,r=this.frameHeight/this.image.height,a=Math.min(i,r);Log.info("ImageFrame.toSVG(): wRatio: "+i+" vRatio: "+r+" ratio: "+a);var o=this.image.width*a,s=this.image.height*a;Log.info("ImageFrame.toSVG(): imgScaledWidth: "+o+" imgScaleHeight: "+s);var n=this.vector[0].x-o/2,h=this.vector[0].y-s/2;t+="\n"+repeat("\t",INDENTATION)+'<image x="'+n+'" y="'+h+'" width="'+o+'" height="'+s+'" xlink:href="'+this.getUrl()+'" />',Log.groupEnd(),INDENTATION--,t+="\n"+repeat("\t",INDENTATION)+"</g>"}return t}},ImageFrame.figure_InsertedImage=function(t,e,i){var r=new Figure("InsertedImage");r.style.fillStyle=FigureDefaults.fillStyle,r.style.strokeStyle=FigureDefaults.strokeStyle;var a=new ImageFrame(t,e,i,!0);return r.addPrimitive(a),a.image.addEventListener("load",function(){var t=a.image.width,o=a.image.height;r.properties.push(new BuilderProperty("Text","primitives.1.str",BuilderProperty.TYPE_TEXT)),r.properties.push(new BuilderProperty("Text Size","primitives.1.size",BuilderProperty.TYPE_TEXT_FONT_SIZE)),r.properties.push(new BuilderProperty("Font","primitives.1.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY)),r.properties.push(new BuilderProperty("Alignment","primitives.1.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT)),r.properties.push(new BuilderProperty("Text Underlined","primitives.1.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED)),r.properties.push(new BuilderProperty("Text Color","primitives.1.style.fillStyle",BuilderProperty.TYPE_COLOR)),r.properties.push(new BuilderProperty("URL","url",BuilderProperty.TYPE_URL));var s=new Text(FigureDefaults.textStr,e,i+o/2+2*FigureDefaults.textSize,FigureDefaults.textFont,FigureDefaults.textSize);s.style.fillStyle=FigureDefaults.textColor,r.addPrimitive(s),a.frameHeight=o+FigureDefaults.textSize,CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e+t/2,i),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e-t/2,i),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e,i-o/2),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e,i+o/2+3*FigureDefaults.textSize),ConnectionPoint.TYPE_FIGURE),r.finalise(),draw()},!1),r.finalise(),r};

// matrix.js
"use strict";function Matrix(){}Matrix.add=function(r,t){var n=[];if(r.length==t.length)for(var i=0;i<r.length;i++){n[i]=[];for(var a=0;a<r[i].length;a++)n[i][a]=r[i][a]+t[i][a]}return n},Matrix.clone=function(r){if(void 0===r||null==r)return null;for(var t=[],n=0;n<r.length;n++)"object"==typeof r&&r[n].length?t.push(Matrix.clone(r[n])):t.push(r[n]);return t},Matrix.subtract=function(r,t){var n=[];if(r.length==t.length)for(var i=0;i<r.length;i++){n[i]=[];for(var a=0;a<r[i].length;a++)n[i][a]=r[i][a]-t[i][a]}return n},Matrix.isNaN=function(r){for(var t=0;t<r.length;t++)if(r[t]instanceof Array){for(var n=0;n<r[t].length;n++)if(isNaN(r[t][n]))return!0}else if(isNaN(r[t]))return!0;return!1},Matrix.multiply=function(r,t){var n=[];if(r[0].length==t.length)for(var i=0;i<r.length;i++){n[i]=[];for(var a=0;a<t[0].length;a++){n[i][a]=0;for(var e=0;e<t.length;e++)n[i][a]+=r[i][e]*t[e][a]}}return n},Matrix.mergeTransformations=function(){var r=[];if(arguments.length>0){r=Matrix.clone(arguments[arguments.length-1]);for(var t=arguments.length-2;t>=0;t--)r=Matrix.multiply(r,arguments[t])}return r},Matrix.invertMatrix=function(r){},Matrix.equals=function(r,t){if(r.length!=t.length)return!1;for(var n in r){if(r[n].length!=t[n].length)return!1;for(var i in r[n])if(r[n][i]!=t[n][i])return!1}return!0},Matrix.rotationMatrix=function(r){return[[Math.cos(r),-Math.sin(r),0],[Math.sin(r),Math.cos(r),0],[0,0,1]]},Matrix.translationMatrix=function(r,t){return[[1,0,r],[0,1,t],[0,0,1]]},Matrix.scaleMatrix=function(r,t){return null==t&&(t=r),[[r,0,0],[0,t,0],[0,0,1]]},Matrix.R90=[[0,-1,0],[0,1,0],[0,0,1]],Matrix.IDENTITY=[[1,0,0],[0,1,0],[0,0,1]],Matrix.UP=[[1,0,0],[0,1,-1],[0,0,1]],Matrix.DOWN=[[1,0,0],[0,1,1],[0,0,1]],Matrix.LEFT=[[1,0,-1],[0,1,0],[0,0,1]],Matrix.RIGHT=[[1,0,1],[0,1,0],[0,0,1]];

// util.js
"use strict";var Util={getBounds:function(n){if(!n.length)return null;for(var t=n[0].x,e=t,i=n[0].y,r=i,o=1;o<n.length;o++)t=Math.min(t,n[o].x),i=Math.min(i,n[o].y),e=Math.max(e,n[o].x),r=Math.max(r,n[o].y);return[t,i,e,r]},rgbToHsl:function(n,t,e){n/=255,t/=255,e/=255;var i,r,o=Math.max(n,t,e),a=Math.min(n,t,e),u=(o+a)/2;if(o===a)i=r=0;else{var s=o-a;switch(r=u>.5?s/(2-o-a):s/(o+a),o){case n:i=(t-e)/s+(t<e?6:0);break;case t:i=(e-n)/s+2;break;case e:i=(n-t)/s+4}i/=6}return[i,r,u]},hexToRgb:function(n){n=n.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(n,t,e,i){return t+t+e+e+i+i});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},hslToString:function(n){return"hsl("+360*n[0]+", "+100*n[1]+"%, "+100*n[2]+"%)"},getUnionBounds:function(n){},areBoundsInBounds:function(n,t){return t[0]<=n[0]&&n[0]<=t[2]&&t[1]<=n[1]&&n[1]<=t[3]&&t[0]<=n[2]&&n[2]<=t[2]&&t[1]<=n[3]&&n[3]<=t[3]},boundsToPolygon:function(n){var t=new Polygon;return t.addPoint(new Point(n[0],n[1])),t.addPoint(new Point(n[2],n[1])),t.addPoint(new Point(n[2],n[3])),t.addPoint(new Point(n[0],n[3])),t},capitaliseFirstLetter:function(n){return n.charAt(0).toUpperCase()+n.slice(1)},feather:function(n,t){return[n[0]+t,n[1]+t,n[2]+t,n[3]+t]},distance:function(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))},point_on_segment:function(n,t,e){var i=Util.distance(n,t),r=n.x+e/i*(t.x-n.x),o=n.y+e/i*(t.y-n.y);return new Point(r,o)},decorate:function(n,t,e){for(var i=(new Date).getMilliseconds(),r=[],o=0;o<e.length;o++)r[o]=e[o]*n.lineWidth;function a(t){n.lineTo(t.x,t.y)}function u(t){n.moveTo(t.x,t.y)}var s=t[0];o=0;var l=0,f=r[0];for(u(s);o<t.length-1;){var x=0;if(f<0)break;if(f>0){if(f>Util.distance(s,t[o+1])){l%2==0?a(t[o+1]):u(t[o+1]),x+=Util.distance(s,t[o+1]),f-=Util.distance(s,t[o+1]),s=t[o+1],o++;continue}var y=Util.point_on_segment(s,t[o+1],f);l%2==0?a(y):u(y),x+=Util.distance(s,y),s=y,f=0,l=(l+1)%r.length}for(;x<Util.distance(t[o],t[o+1]);){if(Util.distance(t[o],t[o+1]),r[l],!(x+r[l]<=Util.distance(t[o],t[o+1]))){l%2==0?a(t[o+1]):u(t[o+1]),f=r[l]-Util.distance(s,t[o+1]),x+=Util.distance(s,t[o+1]),s=t[o+1];break}y=Util.point_on_segment(s,t[o+1],r[l]);l%2==0?a(y):u(y),f=0,x+=r[l],s=y,l=(l+1)%r.length}++o}var c=(new Date).getMilliseconds();console.info("Took "+(c-i)+" ms")},round:function(n,t){return Math.round(n*Math.pow(10,t))/Math.pow(10,t)},getLength:function(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))},getMiddle:function(n,t){return new Point((n.x+t.x)/2,(n.y+t.y)/2)},getPolylineLength:function(n){for(var t=0,e=0;e<n.length-1;e++)t+=Util.getLength(n[e],n[e+1]);return t},lineIntersectsRectangle:function(n,t,e){var i=new Line(n,t),r=[];r.push(new Line(new Point(e[0],e[1]),new Point(e[2],e[1]))),r.push(new Line(new Point(e[2],e[1]),new Point(e[2],e[3]))),r.push(new Line(new Point(e[2],e[3]),new Point(e[0],e[3]))),r.push(new Line(new Point(e[0],e[3]),new Point(e[0],e[1])));for(var o=0;o<r.length;o++)if(this.lineIntersectsLine(i,r[o]))return!0;return!1},polylineIntersectsRectangle:function(n,t,e){var i=[];i.push(new Line(new Point(t[0],t[1]),new Point(t[2],t[1]))),i.push(new Line(new Point(t[2],t[1]),new Point(t[2],t[3]))),i.push(new Line(new Point(t[2],t[3]),new Point(t[0],t[3]))),i.push(new Line(new Point(t[0],t[3]),new Point(t[0],t[1])));for(var r=0;r<n.length-1;r++)for(var o=new Line(n[r],n[r+1]),a=0;a<i.length;a++)if(this.lineIntersectsLine(o,i[a]))return!0;if(e)for(o=new Line(n[n.length-1],n[0]),a=0;a<i.length;a++)if(this.lineIntersectsLine(o,i[a]))return!0;return!1},lineIntersectsLine:function(n,t){if(n.startPoint.x==n.endPoint.x&&t.startPoint.x==t.endPoint.x)return n.startPoint.x==t.startPoint.x&&(n.contains(t.startPoint.x,t.startPoint.y)||n.contains(t.endPoint.x,t.endPoint.y));if(n.startPoint.x==n.endPoint.x||t.startPoint.x==t.endPoint.x){if(n.startPoint.x==n.endPoint.x){var e=n;n=t,t=e}var i=(n.endPoint.y-n.startPoint.y)/(n.endPoint.x-n.startPoint.x),r=n.startPoint.y-i*n.startPoint.x,o=t.startPoint.x,a=i*o+r;return n.contains(o,a)&&t.contains(o,a)}var u=(n.endPoint.y-n.startPoint.y)/(n.endPoint.x-n.startPoint.x),s=n.startPoint.y-u*n.startPoint.x,l=(t.endPoint.y-t.startPoint.y)/(t.endPoint.x-t.startPoint.x),f=t.startPoint.y-l*t.startPoint.x;return u==l?s==f&&(n.contains(t.startPoint.x,t.startPoint.y)||n.contains(t.endPoint.x,t.endPoint.y)):(a=u*(o=(f-s)/(u-l))+s,n.contains(o,a)&&t.contains(o,a))},deprecated_collinearity:function(n,t,e){if(n.x===t.x&&n.y===t.y)return!0;if(n.x===e.x&&n.y===e.y)return!0;if(t.x===e.x&&t.y===e.y)return!0;if(n.x===t.x)return e.x===n.x;var i=(t.y-n.y)/(t.x-n.x),r=n.y-i*n.x;return e.y===i*e.x+r},collinearity:function(n,t,e,i){var r=n.x*t.y+n.y*e.x+t.x*e.y-(t.y*e.x+n.y*t.x+n.x*e.y);return i?Math.abs(r)<=i:0===r},getEndPoint:function(n,t,e){var i=n.clone();return i.transform(Matrix.translationMatrix(-n.x,-n.y)),i.y-=t,i.transform(Matrix.rotationMatrix(e)),i.transform(Matrix.translationMatrix(n.x,n.y)),i},getAngle:function(n,t,e){n.x=Util.round(n.x,5),n.y=Util.round(n.y,5),t.x=Util.round(t.x,5),t.y=Util.round(t.y,5);var i=Math.atan((t.x-n.x)/(t.y-n.y));for(i=-i,t.x>=n.x&&t.y>=n.y?i+=Math.PI:t.x<=n.x&&t.y>=n.y?i+=Math.PI:t.x<=n.x&&t.y<=n.y&&(i+=2*Math.PI);i>=2*Math.PI;)i-=2*Math.PI;return isNaN(i)&&(i=0),e&&(i=Math.round(i/e)*e),i},getAngle3Points:function(n,t,e,i){var r=Util.getAngle(t,n),o=Util.getAngle(t,e)-r;return i&&(o=Math.round(o/i)*i),o},isPointInside:function(n,t){if(t.length<3)return!1;for(var e=0,i=t[0],r=1;r<=t.length;r++){var o=t[r%t.length];if(n.y>Math.min(i.y,o.y)&&n.y<=Math.max(i.y,o.y)&&n.x<=Math.max(i.x,o.x)&&i.y!=o.y){var a=(n.y-i.y)*(o.x-i.x)/(o.y-i.y)+i.x;(i.x==o.x||n.x<=a)&&e++}i=o}return e%2!=0},isPointInsideOrOnBorder:function(n,t){if(t.length<3)return!1;for(var e=t[0].x,i=t[0].x,r=t[0].y,o=t[0].y,a=1;a<t.length;a++){var u=t[a];e=Math.min(u.x,e),i=Math.max(u.x,i),r=Math.min(u.y,r),o=Math.max(u.y,o)}return n.x>=e&&n.x<=i&&n.y>=r&&n.y<=o},pointCrossingsForLine:function(n,t,e,i,r,o){if(t<i&&t<o)return 0;if(t>=i&&t>=o)return 0;if(n>=e&&n>=r)return 0;if(i==o)throw Exception("Asserted: "+i+" == "+o);return n<e&&n<r?i<o?1:-1:n>=e+(t-i)*(r-e)/(o-i)?0:i<o?1:-1},pointCrossingsForCubic:function(n,t,e,i,r,o,a,u,s,l,f){if(t<i&&t<o&&t<u&&t<l)return 0;if(t>=i&&t>=o&&t>=u&&t>=l)return 0;if(n>=e&&n>=r&&n>=a&&n>=s)return 0;if(n<e&&n<r&&n<a&&n<s){if(t>=i){if(t<l)return 1}else if(t>=l)return-1;return 0}if(f>52)return pointCrossingsForLine(n,t,e,i,s,l);var x=(r+a)/2,y=(o+u)/2,c=((r=(e+r)/2)+x)/2,d=((o=(i+o)/2)+y)/2,h=(x+(a=(a+s)/2))/2,g=(y+(u=(u+l)/2))/2;return x=(c+h)/2,y=(d+g)/2,isNaN(x)||isNaN(y)?0:Util.pointCrossingsForCubic(n,t,e,i,r,o,c,d,x,y,f+1)+Util.pointCrossingsForCubic(n,t,x,y,h,g,a,u,s,l,f+1)},min:function(n){if(0==n.lenght)return NaN;for(var t=n[0],e=0;e<n.length;e++)t>n[e]&&(t=n[e]);return t},max:function(n){if(0==n.lenght)return NaN;for(var t=n[0],e=0;e<n.length;e++)t<n[e]&&(t=n[e]);return t},forwardPath:function(n){if(n.length<=2)return!0;for(var t=0;t<n.length-2;t++)if(n[t].x==n[t+1].x&&n[t+1].x==n[t+2].x){if(0!=signum(n[t+1].y-n[t].y)&&signum(n[t+1].y-n[t].y)==-1*signum(n[t+2].y-n[t+1].y))return!1}else if(n[t].y==n[t+1].y&&n[t+1].y==n[t+2].y&&0!=signum(n[t+1].x-n[t].x)&&signum(n[t+1].x-n[t].x)==-1*signum(n[t+2].x-n[t+1].x))return!1;return!0},orthogonalPath:function(n){if(n.length<=1)return!0;for(var t=0;t<n.length-1;t++)if(n[t].x!=n[t+1].x&&n[t].y!=n[t+1].y)return!1;return!0},collinearReduction:function(n){var t=[];if(n.length<3)return Point.cloneArray(n);t.push(n[0].clone());for(var e=1;e<n.length-1;e++)n[e-1].x==n[e].x&&n[e].x==n[e+1].x||n[e-1].y==n[e].y&&n[e].y==n[e+1].y||t.push(n[e].clone());return t.push(n[n.length-1].clone()),t},scorePath:function(n){if(n.length<=2)return-1;for(var t=0,e=1;e<n.length-1;e++)if(n[e-1].x==n[e].x&&n[e].x==n[e+1].x){if(signum(n[e+1].y-n[e].y)!=signum(n[e].y-n[e-1].y))return-1;t++}else if(n[e-1].y==n[e].y&&n[e].y==n[e+1].y){if(signum(n[e+1].x-n[e].x)!=signum(n[e].x-n[e-1].x))return-1;t++}else t--;return t},operaReplacer:function(n,t){return void 0!==t&&null!==t&&t.toFixed&&(t=t.toFixed(20),/\.\d*0+$/.test(t)&&(t=t.replace(/(\.)?0+$/,""))),t},loadPrimitive:function(n){var t=null;return"Point"==n.oType?t=Point.load(n):"Line"==n.oType?t=Line.load(n):"Polyline"==n.oType?t=Polyline.load(n):"Polygon"==n.oType?t=Polygon.load(n):"DottedPolygon"==n.oType?t=DottedPolygon.load(n):"QuadCurve"==n.oType?t=QuadCurve.load(n):"CubicCurve"==n.oType?t=CubicCurve.load(n):"Arc"==n.oType?t=Arc.load(n):"Ellipse"==n.oType?t=Ellipse.load(n):"DashedArc"==n.oType?t=DashedArc.load(n):"Text"==n.oType?t=Text.load(n):"Path"==n.oType?t=Path.load(n):"Figure"==n.oType?t=Figure.load(n):"ImageFrame"==n.oType&&(t=ImageFrame.load(n)),t},getObjectByXY:function(n,t){var e=CONNECTOR_MANAGER.connectorGetByXY(n,t);if(-1!=e)return{id:e,type:"Connector"};var i=STACK.figureGetByXY(n,t);if(-1!=i){var r=STACK.figureGetById(i).groupId;return-1!=r?{id:r,type:"Group"}:{id:i,type:"Figure"}}var o=STACK.containerGetByXY(n,t);return-1!==o?{id:o,type:"Container"}:{id:-1,type:""}}};function signum(n){return n>0?1:n<0?-1:0}function isNumeric(n){return n-0==n&&(n.length>0||""!=n)}function repeat(n,t){for(var e="",i=0;i<t;i++)e+=n;return e}function setSelectionRange(n,t,e){n.setSelectionRange&&(n.focus(),n.setSelectionRange(t,e))}function Browser(){var n=navigator.appName.toLowerCase(),t=navigator.userAgent.toLowerCase(),e=t.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i),i=t.match(/version\/([\.\d]+)/i);e&&null!=i&&(e[2]=i[1]),e=e?[e[1],e[2]]:[n,navigator.appVersion,"-?"],this.webkit=e[0].indexOf("chrome")>-1||e[0].indexOf("safari")>-1,this.opera=e[0].indexOf("opera")>-1,this.msie=e[0].indexOf("msie")>-1,this.mozilla=e[0].indexOf("firefox")>-1,this.version=e[1]}function removeElement(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function removeNodeList(n){var t,e=n.length;for(t=0;t<e;t++)removeElement(n[t])}

// groups.js
"use strict";function Group(r){this.id=r||STACK.generateId(),this.permanent=!1,this.rotationCoords=[],this.oType="Group"}Group.load=function(r){var t=new Group;return t.id=r.id,t.permanent=r.permanent,t.rotationCoords=Point.loadArray(r.rotationCoords),t},Group.loadArray=function(r){for(var t=[],n=0;n<r.length;n++)t.push(Group.load(r[n]));return t},Group.prototype={constructor:Group,paint:function(r){throw"Group is not painted. It is only an abstract grouping"},contains:function(r,t){for(var n=STACK.figureGetByGroupId(this.id),o=0;o<n.length;o++)if(1==n[o].contains(r,t))return!0;return!1},near:function(r,t,n){for(var o=STACK.figureGetByGroupId(this.id),i=0;i<o.length;i++)if(1==o[i].near(r,t,n))return!0;return!1},getBounds:function(){for(var r=STACK.figureGetByGroupId(this.id),t=[],n=0;n<r.length;n++){var o=r[n].getBounds();t.push(new Point(o[0],o[1])),t.push(new Point(o[2],o[3]))}return Util.getBounds(t)},getPoints:function(){STACK.figureGetByGroupId(this.id);for(var r=[],t=0;t<STACK.figureIds.length;t++){var n=STACK.figureGetById(STACK.figureIds[t]).getPoints();r=r.concat(n)}return r},transform:function(r){this.rotationCoords[0].transform(r),this.rotationCoords[1].transform(r);for(var t=STACK.figureGetByGroupId(this.id),n=0;n<t.length;n++)t[n].transform(r)},equals:function(r){if(!r instanceof Group)return!1;for(var t=0;t<this.rotationCoords;t++)if(!this.rotationCoords[t].equals(r.rotationCoords[t]))return!1;return this.permanent==r.permanent},clone:function(){var r=new Group;return r.permanent=this.permanent,r},toString:function(){return"Group id: "+this.id+" permanent: "+this.permanent}};

// stack.js
"use strict";function Stack(){this.figures=[],this.groups=[],this.containers=[],this.currentId=0,this.idToIndex=[],this.oType="Stack"}Stack.load=function(e){var t=new Stack;return t.figures=Figure.loadArray(e.figures),t.containers=Container.loadArray(e.containers),t.groups=Group.loadArray(e.groups),t.figureSelectedIndex=e.figureSelectedIndex,t.currentId=e.currentId,t.idToIndex=e.idToIndex,t},Stack.prototype={constructor:Stack,groupCreate:function(e,t){for(var i=0;i<this.groups.length;i++)if(0==this.groups[i].permanent)throw"Stack::groupCreate()  You can not create new groups while you have temporary groups alive";var r=new Group(t);for(i=0;i<e.length;i++){this.figureGetById(e[i]).groupId=r.id}var n=r.getBounds();return r.rotationCoords.push(new Point(n[0]+(n[2]-n[0])/2,n[1]+(n[3]-n[1])/2)),r.rotationCoords.push(new Point(n[0]+(n[2]-n[0])/2,n[1])),this.groups.push(r),r.id},groupGetById:function(e){for(var t=0;t<this.groups.length;t++)if(this.groups[t].id==e)return this.groups[t];return null},groupDestroy:function(e){for(var t=-1,i=0;i<this.groups.length;i++)if(this.groups[i].id==e){t=i;break}if(t>-1){this.groups.splice(t,1);var r=this.figureGetByGroupId(e);for(i=0;i<r.length;i++)r[i].groupId=-1}},groupRemoveTemporary:function(){throw Exception("Not implemented")},equals:function(e){var t="";if(!e instanceof Stack)return!1;if(this.figures.length!=e.figures.length)return t+="not same nr of figures",!1;for(var i=0;i<this.figures.length;i++)if(!this.figures[i].equals(e.figures[i]))return t+="figures not the same",!1;if(this.groups.length!=e.groups.length)return t+="not same nr of groups",!1;for(i=0;i<this.groups.length;i++)if(!this.groups[i].equals(e.groups[i]))return t+="groups not the same",!1;for(i=0;i<this.figures.idToIndex;i++)if(void 0!=this.idToIndex[i]&&void 0!=e.idToIndex&&this.idToIndex[i]!=e.idToIndex[i])return t+="not same idToIndex",!1;return this.currentId!=e.currentId?(t+="not same currentId",!1):(""!=t&&alert(t),!0)},generateId:function(){return this.currentId++},figureAdd:function(e){this.figures.push(e),this.idToIndex[e.id]=this.figures.length-1},containerAdd:function(e){this.containers.push(e)},figureRemove_deprecated:function(e){for(var t=-1,i=0;i<this.figures.length;i++)if(this.figures[i]==e){t=i;break}if(CONNECTOR_MANAGER.connectionPointRemoveAllByParent(e.id),t>-1){this.figures.splice(t,1);for(i=t;i<this.figures.length;i++)this.idToIndex[this.figures[i].id]=i}t<this.figureSelectedIndex&&-1!=t&&this.figureSelectedIndex--},containerRemoveById:function(e){for(var t=-1,i=0;i<this.containers.length;i++)if(this.containers[i].id===e){t=i;break}t>-1&&this.containers.splice(t,1)},figureRemoveById:function(e){for(var t=-1,i=0;i<this.figures.length;i++)if(this.figures[i].id==e){t=i;break}if(t>-1){var r,n=CONNECTOR_MANAGER.connectionPointGetAllByParent(e),o=n.length;for(r=0;r<o;r++)CONNECTOR_MANAGER.glueRemoveAllByFirstId(n[r].id);CONNECTOR_MANAGER.connectionPointRemoveAllByParent(e),this.figures.splice(t,1),this.reindex()}},reindex:function(){for(var e=0;e<this.figures.length;e++)this.idToIndex[this.figures[e].id]=e},reset:function(){this.figures=[],this.figureSelectedIndex=-1,this.currentId=0},getIndex:function(e){for(var t=0;t<this.figures.length;t++)if(this.figures[t]==e)return t;return-1},figureGetByGroupId:function(e){for(var t=[],i=0;i<this.figures.length;i++)this.figures[i].groupId==e&&t.push(this.figures[i]);return t},figureGetIdsByGroupId:function(e){for(var t=[],i=0;i<this.figures.length;i++)this.figures[i].groupId==e&&t.push(this.figures[i].id);return t},figureGetById:function(e){for(var t=0;t<this.figures.length;t++)if(this.figures[t].id==e)return this.figures[t];return null},figureGetAsFirstFigureForConnector:function(e){Log.group("Stack:figureGetAsFirstFigureForConnector");var t=null;Log.debug("Connector id = "+e);var i=CONNECTOR_MANAGER.connectionPointGetFirstForConnector(e);Log.debug("ConnectionPoint id = "+i.id);var r=CONNECTOR_MANAGER.glueGetBySecondConnectionPointId(i.id)[0];if(r){Log.debug("Glue id1 = ("+r.id1+", "+r.id2+")");var n=CONNECTOR_MANAGER.connectionPointGetById(r.id1);Log.debug("Figure's ConnectionPoint id = "+n.id),t=this.figureGetById(n.parentId)}else Log.debug("no glue");return Log.groupEnd(),t},figureGetAsSecondFigureForConnector:function(e){Log.group("Stack:figureGetAsSecondFigureForConnector");var t=null;Log.debug("Connector id = "+e);var i=CONNECTOR_MANAGER.connectionPointGetSecondForConnector(e);Log.debug("ConnectionPoint id = "+i.id);var r=CONNECTOR_MANAGER.glueGetBySecondConnectionPointId(i.id)[0];if(r){Log.debug("Glue id1 = ("+r.id1+", "+r.id2+")");var n=CONNECTOR_MANAGER.connectionPointGetById(r.id1);Log.debug("Figure's ConnectionPoint id = "+n.id),t=this.figureGetById(n.parentId)}else Log.debug("no glue");return Log.groupEnd(),t},figureGetByXY:function(e,t){for(var i=-1,r=this.figures.length-1;r>=0;r--)if(this.figures[r].contains(e,t)){i=this.figures[r].id;break}return i},textGetByFigureXY:function(e,t,i){for(var r=this.figures.length-1;r>=0;r--){var n=this.figures[r];if(n.id===e)for(var o=n.primitives.length-1;o>=0;o--){var s=n.primitives[o];if("Text"===s.oType&&s.contains(t,i))return s.id}}return-1},textGetByContainerXY:function(e,t,i){for(var r=this.containers.length-1;r>=0;r--){var n=this.containers[r];if(n.id===e)for(var o=n.primitives.length-1;o>=0;o--){var s=n.primitives[o];if("Text"==s.oType&&s.contains(t,i))return s.id}}return-1},containerGetByXY:function(e,t){for(var i=-1,r=this.containers.length-1;r>=0;r--)if(this.containers[r].contains(e,t)){i=this.containers[r].id;break}return i},containerGetByXYOnEdge:function(e,t){for(var i=-1,r=this.containers.length-1;r>=0;r--)if(this.containers[r].onEdge(e,t)){i=this.containers[r].id;break}return i},containerGetById:function(e){for(var t=0;t<this.containers.length;t++)if(this.containers[t].id==e)return this.containers[t];return null},figuresGetByXY:function(e,t){for(var i=[],r=this.figures.length-1;r>=0;r--)this.figures[r].contains(e,t)&&i.push(this.figures[r].id);return i},setPosition_deprecated:function(e,t){for(var i=-1,r=0;r<this.figures.length;r++)this.figures[r]==e&&(i=r);if(-1!=i&&t>=0&&t<this.figures.length){var n=this.figures.splice(i,1);this.figures.splice(t,0,n[0]);for(r=0;r<this.figures.length;r++)this.idToIndex[this.figures[r].id]=r;this.figureSelectedIndex=t}},swapToPosition:function(e,t){var i=this.idToIndex[e];if(-1!=i&&t>=0&&t<this.figures.length){this.idToIndex[e]=t,this.idToIndex[this.figures[t].id]=i;var r=this.figures[i];this.figures[i]=this.figures[t],this.figures[t]=r}},setPosition:function(e,t){var i=this.idToIndex[e],r=this.figures[i],n=-1;i<t&&(n=1),Log.info(n);for(var o=i;o!=t;o+=n)this.figures[o]=this.figures[o+n],this.idToIndex[this.figures[o].id]=o;this.figures[t]=r,this.idToIndex[this.figures[t].id]=t},figureIsOver:function(e,t){for(var i=!1,r=0;r<this.figures.length;r++){if(this.figures[r].contains(e,t)){i=!0;break}}return i},containerIsOver:function(e,t){for(var i=!1,r=0;r<this.containers.length;r++){if(this.containers[r].contains(e,t)){i=!0;break}}return i},containerIsOnEdge:function(e,t){for(var i=!1,r=0;r<this.containers.length;r++){if(this.containers[r].onEdge(e,t)){i=!0;break}}return i},getWorkAreaBounds:function(){var e,t,i,r,n,o=!0,s=function(n){(void 0===e||e>n[0])&&(e=n[0]),(void 0===i||i>n[1])&&(i=n[1]),(void 0===t||n[2]>t)&&(t=n[2]),(void 0===r||n[3]>r)&&(r=n[3]),o=!1},u=this.containers.length;for(n=0;n<u;n++)s(this.containers[n].getBounds());var g=this.figures.length;for(n=0;n<g;n++)s(this.figures[n].getBounds());var a=CONNECTOR_MANAGER.connectors.length;for(n=0;n<a;n++)s(CONNECTOR_MANAGER.connectors[n].getBounds());return o?[0,0,canvasProps.getWidth(),canvasProps.getHeight()]:[e,i,t,r]},transform:function(e){var t,i=this.containers.length;for(t=0;t<i;t++)this.containers[t].transform(e);var r=this.figures.length;for(t=0;t<r;t++)-1===CONTAINER_MANAGER.getContainerForFigure(this.figures[t].id)&&this.figures[t].transform(e)},paint:function(e,t){if(DIAGRAMO.debug){var i=1;if(e.save(),e.font="10px Arial",e.fillStyle="#000000",e.strokeStyle="#000000",e.lineWidth=1,e.fillText("state: "+state,0,10*i++),e.fillText("selectedFigureId: : "+selectedFigureId,0,10*i++),e.fillText("selectedGroupId: : "+selectedGroupId,0,10*i++),e.fillText("selectedContainerId: : "+selectedContainerId,0,10*i++),-1!=selectedGroupId){var r=this.groupGetById(selectedGroupId);e.fillText("permanent: : "+r.permanent,0,10*i++)}if(e.fillText("selectedConnectorId: : "+selectedConnectorId,0,10*i++),-1!=selectedConnectorId){var n=CONNECTOR_MANAGER.connectorGetById(selectedConnectorId);e.fillText("connector type: : "+n.type,0,10*i++)}e.restore()}for(var o=0;o<this.containers.length;o++)e.save(),this.containers[o].paint(e),e.restore();for(o=0;o<this.figures.length;o++)e.save||alert("save() no present"),e.save(),this.figures[o].paint(e),e.restore(),state!=STATE_CONNECTOR_PICK_FIRST&&state!=STATE_CONNECTOR_PICK_SECOND&&state!=STATE_CONNECTOR_MOVE_POINT||CONNECTOR_MANAGER.connectionPointPaint(e,this.figures[o].id);if(state!=STATE_CONNECTOR_PICK_FIRST&&state!=STATE_CONNECTOR_PICK_SECOND&&state!=STATE_CONNECTOR_MOVE_POINT||CONNECTOR_MANAGER.connectionCloudPaint(e),CONNECTOR_MANAGER.connectorPaint(e,selectedConnectorId),state==STATE_FIGURE_SELECTED){var s=this.figureGetById(selectedFigureId);HandleManager.shapeSet(s),t||HandleManager.paint(e)}else if(state==STATE_CONNECTOR_SELECTED){var u=CONNECTOR_MANAGER.connectorGetById(selectedConnectorId);HandleManager.shapeSet(u),t||HandleManager.paint(e)}else if(state==STATE_CONTAINER_SELECTED){var g=STACK.containerGetById(selectedContainerId);HandleManager.shapeSet(g),t||HandleManager.paint(e)}else if(state==STATE_GROUP_SELECTED){var a=this.groupGetById(selectedGroupId);HandleManager.shapeSet(a),t||HandleManager.paint(e)}else if(state==STATE_SELECTING_MULTIPLE){if(SHIFT_PRESSED){if(-1!=selectedFigureId){s=this.figureGetById(selectedFigureId);HandleManager.paint(e)}if(-1!=selectedGroupId){a=this.groupGetById(selectedGroupId);HandleManager.paint(e)}}selectionArea.paint(e),Log.info(selectionArea.toString())}if(DIAGRAMO.debug){var f={s0:"#ff0000",s1_1:"#009900",s1_2:"#0033ff",s2_1:"#00ff33",s2_2:"#ff3399",s2_3:"#808019",s2_4:"#e6e64c",s2_5:"#e67814",s2_6:"#309bda"};e.save();for(o=0;o<DIAGRAMO.debugSolutions.length;o++){var d=3+3*o,h=DIAGRAMO.debugSolutions[o],c=h[2];e.save(),e.strokeStyle=f[h[1]],e.lineWidth=1,e.beginPath(),e.moveTo(c[0].x+d,c[0].y+d);for(var l=1;l<c.length;l++)e.lineTo(c[l].x+d,c[l].y+d);e.stroke(),e.restore();for(l=0;l<c.length;l++)e.save(),e.beginPath(),e.strokeStyle="#cccccc",e.arc(c[l].x,c[l].y,3,0,2*Math.PI,!0),e.stroke(),e.restore()}i+=4;for(var I in f)e.save(),e.strokeText(I,0,10*i),e.strokeStyle=f[I],e.beginPath(),e.moveTo(50,10*i),e.lineTo(150,10*i),e.stroke(),e.restore(),i+=2;e.restore()}},toSVG:function(){for(var e="",t=0;t<this.figures.length;t++)e+=this.figures[t].toSVG();return e}};

// connections.js
"use strict";var connector_defaultConnectorTextSize=12,connector_defaultConnectorTextStr="",connector_defaultConnectorTextFont="Arial",connector_defaultConnectorTextStrokeStyle="#000000",connector_defaultConnectorTextFillStyle="#000000",connector_defaultConnectorTextBgStyle="#ffffff";function Connector(t,n,i,e){this.id=e,this.turningPoints=[t,n],this.type=i,this.userChanges=[],this.solution="",this.style=new Style,this.style.strokeStyle="#000000",this.style.lineWidth=1.005,this.style.lineStyle=Style.LINE_STYLE_CONTINOUS,this.middleText=new Text(connector_defaultConnectorTextStr,(t.x+n.x)/2+10,(t.y+n.y)/2-13,connector_defaultConnectorTextFont,connector_defaultConnectorTextSize),this.middleText.style.strokeStyle=connector_defaultConnectorTextStrokeStyle,this.middleText.style.fillStyle=connector_defaultConnectorTextFillStyle,this.middleText.bgStyle=connector_defaultConnectorTextBgStyle,this.properties=[],this.properties.push(new BuilderProperty("Color","style.strokeStyle",BuilderProperty.TYPE_COLOR)),this.properties.push(new BuilderProperty("Text Color","middleText.style.fillStyle",BuilderProperty.TYPE_COLOR)),this.properties.push(new BuilderProperty("Line Width","style.lineWidth",BuilderProperty.TYPE_LINE_WIDTH)),this.properties.push(new BuilderProperty("Line Style","style.lineStyle",BuilderProperty.TYPE_LINE_STYLE)),this.properties.push(new BuilderProperty("Text","middleText.str",BuilderProperty.TYPE_TEXT)),this.properties.push(new BuilderProperty("Text Size","middleText.size",BuilderProperty.TYPE_TEXT_FONT_SIZE)),this.properties.push(new BuilderProperty("Font","middleText.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY)),this.properties.push(new BuilderProperty("Alignment","middleText.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT)),this.properties.push(new BuilderProperty("Text Underlined","middleText.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED)),this.properties.push(new BuilderProperty("End Style","endStyle",BuilderProperty.TYPE_CONNECTOR_END)),this.startStyle=Connector.STYLE_NORMAL,this.endStyle=Connector.STYLE_FILLED_TRIANGLE,this.activeConnectionPointId=-1,this.oType="Connector"}function ConnectionPoint(t,n,i,e){this.id=i,this.point=n.clone(),this.parentId=t,this.type=e,this.color=ConnectionPoint.NORMAL_COLOR,this.radius=3,this.oType="ConnectionPoint"}function Glue(t,n,i){this.id1=t,this.id2=n,this.type1="figure",this.type2="connector",this.oType="Glue",this.automatic=i}Connector.TYPE_STRAIGHT="straight",Connector.TYPE_JAGGED="jagged",Connector.TYPE_ROUND="round",Connector.TYPE_ORGANIC="organic",Connector.STYLE_NORMAL="Normal",Connector.STYLE_ARROW="Arrow",Connector.STYLE_EMPTY_TRIANGLE="Empty",Connector.STYLE_FILLED_TRIANGLE="Filled",Connector.ARROW_SIZE=12,Connector.ARROW_ANGLE=15,Connector.USER_CHANGE_HORIZONTAL_ALIGN="h",Connector.USER_CHANGE_VERTICAL_ALIGN="v",Connector.load=function(t){var n=new Connector(new Point(0,0),new Point(0,0),Connector.TYPE_STRAIGHT,0);return n.id=t.id,n.turningPoints=Point.loadArray(t.turningPoints),n.type=t.type,n.userChanges=t.userChanges,n.solution=t.solution,n.style=Style.load(t.style),n.middleText=Text.load(t.middleText),n.properties=BuilderProperty.loadArray(t.properties),n.endStyle=t.endStyle,n.startStyle=t.startStyle,n.activeConnectionPointId=t.activeConnectionPointId,n},Connector.loadArray=function(t){for(var n=[],i=0;i<t.length;i++)n.push(Connector.load(t[i]));return n},Connector.prototype={constructor:Connector,equals:function(t){if(!t instanceof Connector)return!1;for(var n=0;n<this.turningPoints.length;n++)if(!this.turningPoints[n].equals(t.turningPoints[n]))return!1;for(n=0;n<this.properties.length;n++)if(!this.properties[n].equals(t.properties[n]))return!1;for(n=0;n<this.userChanges.length;n++)if(this.userChanges[n].align!=t.userChanges[n].align||this.userChanges[n].index!=t.userChanges[n].index||this.userChanges[n].delta!=t.userChanges[n].delta)return!1;return!(this.id!=t.id||this.type!=t.type||this.solution!=t.solution||!this.middleText.equals(t.middleText)||this.startStyle!=t.startStyle||this.endStyle!=t.endStyle||this.activeConnectionPointId!=t.activeConnectionPointId)},getArrow:function(t,n){var i=new Point(t,n),e=new Line(i.clone(),Util.getEndPoint(i,Connector.ARROW_SIZE,Math.PI/180*Connector.ARROW_ANGLE)),o=new Line(i.clone(),Util.getEndPoint(i,Connector.ARROW_SIZE,Math.PI/180*-Connector.ARROW_ANGLE)),r=new Path;return r.style=this.style,e.style=this.style,o.style=this.style,r.addPrimitive(e),r.addPrimitive(o),r},getTriangle:function(t,n,i){var e=new Point(t,n),o=Util.getEndPoint(e,Connector.ARROW_SIZE,Math.PI/180*Connector.ARROW_ANGLE),r=Util.getEndPoint(e,Connector.ARROW_SIZE,-Math.PI/180*Connector.ARROW_ANGLE),s=new Polygon;return s.addPoint(e),s.addPoint(o),s.addPoint(r),s.style=this.style.clone(),s.style.fillStyle=i?this.style.strokeStyle:"#FFFFFF",s},paint:function(t){if(!this.areStartEndPointsMatch()){switch(t.save(),this.style.setupContext(t),this.type){case Connector.TYPE_ORGANIC:this.paintOrganic(t);break;case Connector.TYPE_STRAIGHT:case Connector.TYPE_JAGGED:t.beginPath(),t.moveTo(this.turningPoints[0].x,this.turningPoints[0].y);for(var n=1;n<this.turningPoints.length;n++){if(this.startStyle==Connector.STYLE_EMPTY_TRIANGLE&&1==n){var i=Util.getAngle(this.turningPoints[0],this.turningPoints[1]),e=Util.getEndPoint(this.turningPoints[0],Connector.ARROW_SIZE*Math.cos(Math.PI/180*Connector.ARROW_ANGLE),i);t.moveTo(e.x,e.y)}if(this.endStyle==Connector.STYLE_EMPTY_TRIANGLE&&n==this.turningPoints.length-1){i=Util.getAngle(this.turningPoints[n-1],this.turningPoints[n]),e=Util.getEndPoint(this.turningPoints[n],-Connector.ARROW_SIZE*Math.cos(Math.PI/180*Connector.ARROW_ANGLE),i);t.lineTo(e.x,e.y)}else t.lineTo(this.turningPoints[n].x,this.turningPoints[n].y)}t.stroke()}this.paintVisualDebug(t),this.paintStart(t),this.paintEnd(t),this.paintText(t),t.restore()}},paintOrganic:function(t){var n=this.turningPoints;Log.info("Connector:paint() - Number of reduced points: "+n.length+" "+n);var i=new NURBS(n);if(i.style.strokeStyle="rgba(0,100,0,0.5)",DIAGRAMO.debug)for(var e=0;e<i.fragments.length;e++){var o=i.fragments[e].clone();o.style.lineWidth=6,o.style.strokeStyle="rgb("+100*e%255+","+50*e%255+","+20*e%255+")",o.paint(t)}i.paint(t)},paintStart:function(t){var n=null;if(this.startStyle==Connector.STYLE_ARROW&&(n=this.getArrow(this.turningPoints[0].x,this.turningPoints[0].y)),this.startStyle==Connector.STYLE_EMPTY_TRIANGLE&&(n=this.getTriangle(this.turningPoints[0].x,this.turningPoints[0].y,!1)),this.startStyle==Connector.STYLE_FILLED_TRIANGLE&&(n=this.getTriangle(this.turningPoints[0].x,this.turningPoints[0].y,!0)),n){var i=this.turningPoints[0].x,e=this.turningPoints[0].y,o=Util.getAngle(this.turningPoints[0],this.turningPoints[1],0);n.transform(Matrix.translationMatrix(-i,-e)),n.transform(Matrix.rotationMatrix(o)),n.transform(Matrix.translationMatrix(i,e)),t.save(),t.lineJoin="round",t.lineCap="round",n.paint(t),t.restore()}},paintEnd:function(t){var n=null;if(this.endStyle==Connector.STYLE_ARROW&&(n=this.getArrow(this.turningPoints[this.turningPoints.length-1].x,this.turningPoints[this.turningPoints.length-1].y)),this.endStyle==Connector.STYLE_EMPTY_TRIANGLE&&(n=this.getTriangle(this.turningPoints[this.turningPoints.length-1].x,this.turningPoints[this.turningPoints.length-1].y,!1)),this.endStyle==Connector.STYLE_FILLED_TRIANGLE&&(n=this.getTriangle(this.turningPoints[this.turningPoints.length-1].x,this.turningPoints[this.turningPoints.length-1].y,!0)),n){var i=this.turningPoints[this.turningPoints.length-1].x,e=this.turningPoints[this.turningPoints.length-1].y,o=Util.getAngle(this.turningPoints[this.turningPoints.length-1],this.turningPoints[this.turningPoints.length-2],0);n.transform(Matrix.translationMatrix(-i,-e)),n.transform(Matrix.rotationMatrix(o)),n.transform(Matrix.translationMatrix(i,e)),t.save(),t.lineJoin="round",t.lineCap="round",n.paint(t),t.restore()}},paintVisualDebug:function(t){if(DIAGRAMO.debug){t.beginPath();for(var n=0;n<this.turningPoints.length;n++)t.moveTo(this.turningPoints[n].x,this.turningPoints[n].y),t.arc(this.turningPoints[n].x,this.turningPoints[n].y,3,0,2*Math.PI,!1);t.stroke(),t.save();for(n=0;n<this.turningPoints.length;n++)t.fillText("("+Util.round(this.turningPoints[n].x,3)+", "+Util.round(this.turningPoints[n].y,3)+")",this.turningPoints[n].x+5,this.turningPoints[n].y-5);t.restore()}},paintText:function(t){if(""!=this.middleText.str){var n=t.fillStyle;t.beginPath();var i=this.middleText.getBounds();t.moveTo(i[0],i[1]),t.lineTo(i[0],i[3]),t.lineTo(i[2],i[3]),t.lineTo(i[2],i[1]),t.fillStyle="white",t.closePath(),t.fill(),t.fillStyle=n,this.middleText.paint(t)}},transform:function(t){if(-1!=this.activeConnectionPointId)CONNECTOR_MANAGER.connectionPointGetById(this.activeConnectionPointId).transform(t);else for(var n=0;n<this.turningPoints.length;n++)this.turningPoints[n].transform(t)},jagged:function(){this.jaggedReloaded()},jaggedReloaded:function(){var t=this.turningPoints[0],n=null,i=null,e=this.turningPoints[this.turningPoints.length-1],o=CONNECTOR_MANAGER.connectionPointGetAllByParent(this.id)[0],r=CONNECTOR_MANAGER.glueGetByConnectionPointId(o.id)[0];if(null!=r){var s=CONNECTOR_MANAGER.connectionPointGet(r.id1==o.id?r.id2:r.id1),h=STACK.figureGetById(s.parentId),l=Util.getAngle(h.rotationCoords[0],t,Math.PI/2);switch(l){case 0:n=new Point(t.x,h.getBounds()[1]-20);break;case Math.PI/2:n=new Point(h.getBounds()[2]+20,t.y);break;case Math.PI:n=new Point(t.x,h.getBounds()[3]+20);break;case 3*Math.PI/2:n=new Point(h.getBounds()[0]-20,t.y)}}var u=CONNECTOR_MANAGER.connectionPointGetAllByParent(this.id)[1];if(null!=(r=CONNECTOR_MANAGER.glueGetByConnectionPointId(u.id)[0])){var a=CONNECTOR_MANAGER.connectionPointGet(r.id1==u.id?r.id2:r.id1),g=STACK.figureGetById(a.parentId);Util.getAngle(g.rotationCoords[0],e,Math.PI/2);switch(l){case 0:i=new Point(e.x,g.getBounds()[1]-20);break;case Math.PI/2:i=new Point(g.getBounds()[2]+20,e.y);break;case Math.PI:i=new Point(e.x,g.getBounds()[3]+20);break;case 3*Math.PI/2:i=new Point(g.getBounds()[0]-20,e.y)}}alert("jaggedReloaded:Connector has "+this.turningPoints.length+" points"),this.turningPoints.splice(1,0,n,i),alert("jaggedReloaded:Connector has "+this.turningPoints.length+" points")},connect2Points:function(t,n){return t.equals(n),[]},redraw:function(){if("jagged"==this.type)for(var t=!0;1==t;){t=!1;for(var n=1;n<this.turningPoints.length-2;n++)this.turningPoints[n].x==this.turningPoints[n-1].x&&this.turningPoints[n-1].x==this.turningPoints[n+1].x&&(this.turningPoints.splice(n,1),t=!0),this.turningPoints[n].y==this.turningPoints[n-1].y&&this.turningPoints[n-1].y==this.turningPoints[n+1].y&&(this.turningPoints.splice(n,1),t=!0)}},adjust:function(t,n){if(this.type==Connector.TYPE_STRAIGHT){var i=CONNECTOR_MANAGER.connectionPointGetByParentAndCoordinates(this.id,n.x,n.y),e=-1;this.turningPoints[0].equals(n)?e=0:this.turningPoints[1].equals(n)?e=1:Log.error("Connector:adjust() - This should not happend"+this.toString()+" point is "+n),i.transform(t),this.turningPoints[e].x=i.point.x,this.turningPoints[e].y=i.point.y}if(this.type==Connector.TYPE_JAGGED){var o,r,s,h=n.x,l=n.y;(i=CONNECTOR_MANAGER.connectionPointGetByParentAndCoordinates(this.id,n.x,n.y)).transform(t),n.equals(this.turningPoints[0])?(this.turningPoints[0].x=i.point.x,this.turningPoints[0].y=i.point.y,o=1,r=this.turningPoints.length,s=1):n.equals(this.turningPoints[this.turningPoints.length-1])?(this.turningPoints[this.turningPoints.length-1].x=i.point.x,this.turningPoints[this.turningPoints.length-1].y=i.point.y,o=this.turningPoints.length-2,r=-1,s=-1):Log.error("Connector:adjust() - this should never happen for point "+n+" and connector "+this.toString());for(var u=o;u!=r;u+=s)this.turningPoints[u].y!=l&&this.turningPoints[u].x==h&&this.turningPoints[u]!=CONNECTOR_MANAGER.connectionPointGetAllByParent(this.id)[0].point&&this.turningPoints[u]!=CONNECTOR_MANAGER.connectionPointGetAllByParent(this.id)[1].point?(h=this.turningPoints[u].x,l=this.turningPoints[u].y,this.turningPoints[u].x=this.turningPoints[u-s].x):this.turningPoints[u].x!=h&&this.turningPoints[u].y==l&&this.turningPoints[u]!=CONNECTOR_MANAGER.connectionPointGetAllByParent(this.id)[0].point&&this.turningPoints[u]!=CONNECTOR_MANAGER.connectionPointGetAllByParent(this.id)[1].point&&(h=this.turningPoints[u].x,l=this.turningPoints[u].y,this.turningPoints[u].y=this.turningPoints[u-s].y)}},applySolution:function(t){var n=t[0][1];this.solution&&this.solution==n&&this.turningPoints.length==t[0][2].length?(this.turningPoints=Point.cloneArray(t[0][2]),this.applyUserChanges()):(this.solution=n,this.clearUserChanges(),this.turningPoints=Point.cloneArray(t[0][2])),this.updateMiddleText()},applyUserChanges:function(){for(var t,n,i=this.userChanges.length,e=0;e<i;e++)(t=this.userChanges[e]).align==Connector.USER_CHANGE_HORIZONTAL_ALIGN?n=Matrix.translationMatrix(t.delta,0):t.align==Connector.USER_CHANGE_VERTICAL_ALIGN&&(n=Matrix.translationMatrix(0,t.delta)),this.turningPoints[t.index].transform(n)},addUserChange:function(t){for(var n,i=this.userChanges.length,e=0;e<i;e++)if((n=this.userChanges[e]).align==t.align&&n.index==t.index)return void(n.delta+=t.delta);this.userChanges.push(t)},clearUserChanges:function(){this.userChanges=[]},cloneUserChanges:function(){for(var t=[],n=this.userChanges.length,i=0;i<n;i++)t.push({align:this.userChanges[i].align,index:this.userChanges[i].index,delta:this.userChanges[i].delta});return t},areStartEndPointsMatch:function(){return this.turningPoints[0].equals(this.turningPoints[this.turningPoints.length-1])},contains:function(t,n){var i=!1;switch(this.type){case Connector.TYPE_STRAIGHT:case Connector.TYPE_JAGGED:for(var e=0;e<this.turningPoints.length-1;e++){if(new Line(this.turningPoints[e],this.turningPoints[e+1]).contains(t,n)){i=!0;break}}break;case Connector.TYPE_ORGANIC:i=new NURBS(this.turningPoints).contains(t,n)}return i},near:function(t,n,i){var e=!1;switch(this.type){case Connector.TYPE_STRAIGHT:case Connector.TYPE_JAGGED:for(var o=0;o<this.turningPoints.length-1;o++){if(new Line(this.turningPoints[o],this.turningPoints[o+1]).near(t,n,i)){e=!0;break}}break;case Connector.TYPE_ORGANIC:e=new NURBS(this.turningPoints).near(t,n,i)}return e},middle:function(){if(this.type==Connector.TYPE_STRAIGHT)return[(this.turningPoints[0].x+this.turningPoints[1].x)/2,(this.turningPoints[0].y+this.turningPoints[1].y)/2];if(this.type==Connector.TYPE_JAGGED){for(var t=0,n=0;n<this.turningPoints.length-1;n++)t+=Util.getLength(this.turningPoints[n],this.turningPoints[n+1]);var i=-1,e=0;for(n=0;n<this.turningPoints.length-1;n++){i=n;var o=Util.getLength(this.turningPoints[n],this.turningPoints[n+1]);if(!(e+o<t/2))break;e+=o}if(-1!=i){var r=t/2-e;if(Util.round(this.turningPoints[i].x,3)==Util.round(this.turningPoints[i+1].x,3))return[this.turningPoints[i].x,Math.min(this.turningPoints[i].y,this.turningPoints[i+1].y)+r];if(Util.round(this.turningPoints[i].y,3)==Util.round(this.turningPoints[i+1].y,3))return[Math.min(this.turningPoints[i].x,this.turningPoints[i+1].x)+r,this.turningPoints[i].y];Log.error("Connector:middle() - this should never happen "+this.turningPoints[i]+" "+this.turningPoints[i+1]+" nr of points "+this.turningPoints.length)}}else if(this.type===Connector.TYPE_ORGANIC){var s=new NURBS(this.turningPoints).getMiddle();return Log.info("Middle is "+s),[s.x,s.y]}return null},updateMiddleText:function(){var t=this.middle();if(null!=t){var n=Matrix.translationMatrix(t[0]-this.middleText.vector[0].x,t[1]-this.middleText.vector[0].y);this.middleText.transform(n)}},getBounds:function(){for(var t=null,n=null,i=null,e=null,o=0;o<this.turningPoints.length;o++)(this.turningPoints[o].x<t||null==t)&&(t=this.turningPoints[o].x),(this.turningPoints[o].x>i||null==i)&&(i=this.turningPoints[o].x),(this.turningPoints[o].y<n||null==n)&&(n=this.turningPoints[o].y),(this.turningPoints[o].y>e||null==e)&&(e=this.turningPoints[o].y);return[t,n,i,e]},toString:function(){return"Connector : (id = "+this.id+", type = "+this.type+", turningPoints = ["+this.turningPoints+"], userChanges = ["+this.userChanges+"], solution = "+this.solution+", startStyle = "+this.startStyle+", endStyle = "+this.endStyle+", activeConnectionPointId = "+this.activeConnectionPointId+")"},toSVG:function(){for(var t='<polyline points="',n=0;n<this.turningPoints.length;n++)t+=this.turningPoints[n].x+","+this.turningPoints[n].y+" ";t+='"',t+=this.style.toSVG(),t+="/>";var i=null;if(this.startStyle==Connector.STYLE_ARROW&&(i=this.getArrow(this.turningPoints[0].x,this.turningPoints[0].y)),this.startStyle==Connector.STYLE_EMPTY_TRIANGLE&&(i=this.getTriangle(this.turningPoints[0].x,this.turningPoints[0].y,!1)),this.startStyle==Connector.STYLE_FILLED_TRIANGLE&&(i=this.getTriangle(this.turningPoints[0].x,this.turningPoints[0].y,!0)),i){var e=this.turningPoints[0].x,o=this.turningPoints[0].y,r=Util.getAngle(this.turningPoints[0],this.turningPoints[1],0);i.transform(Matrix.translationMatrix(-e,-o)),i.transform(Matrix.rotationMatrix(r)),i.transform(Matrix.translationMatrix(e,o)),t+=i.toSVG()}if(this.endStyle==Connector.STYLE_ARROW&&(i=this.getArrow(this.turningPoints[this.turningPoints.length-1].x,this.turningPoints[this.turningPoints.length-1].y)),this.endStyle==Connector.STYLE_EMPTY_TRIANGLE&&(i=this.getTriangle(this.turningPoints[this.turningPoints.length-1].x,this.turningPoints[this.turningPoints.length-1].y,!1)),this.endStyle==Connector.STYLE_FILLED_TRIANGLE&&(i=this.getTriangle(this.turningPoints[this.turningPoints.length-1].x,this.turningPoints[this.turningPoints.length-1].y,!0)),i){e=this.turningPoints[this.turningPoints.length-1].x,o=this.turningPoints[this.turningPoints.length-1].y,r=Util.getAngle(this.turningPoints[this.turningPoints.length-1],this.turningPoints[this.turningPoints.length-2],0);i.transform(Matrix.translationMatrix(-e,-o)),i.transform(Matrix.rotationMatrix(r)),i.transform(Matrix.translationMatrix(e,o)),t+=i.toSVG()}if(1!=this.middleText.str.length){var s=this.middleText.getBounds(),h=new Polygon;h.addPoint(new Point(s[0],s[1])),h.addPoint(new Point(s[2],s[1])),h.addPoint(new Point(s[2],s[3])),h.addPoint(new Point(s[0],s[3])),h.style.fillStyle="#FFFFFF",t+=h.toSVG(),t+=this.middleText.toSVG()}return t}},ConnectionPoint.NORMAL_COLOR="#FFFF33",ConnectionPoint.OVER_COLOR="#FF9900",ConnectionPoint.CONNECTED_COLOR="#ff0000",ConnectionPoint.RADIUS=4,ConnectionPoint.TYPE_FIGURE="figure",ConnectionPoint.TYPE_CONNECTOR="connector",ConnectionPoint.load=function(t){var n=new ConnectionPoint(0,new Point(0,0),ConnectionPoint.TYPE_FIGURE);return n.id=t.id,n.point=Point.load(t.point),n.parentId=t.parentId,n.type=t.type,n.color=t.color,n.radius=t.radius,n},ConnectionPoint.loadArray=function(t){for(var n=[],i=0;i<t.length;i++)n.push(ConnectionPoint.load(t[i]));return n},ConnectionPoint.cloneArray=function(t){for(var n=[],i=0;i<t.length;i++)n.push(t[i].clone());return n},ConnectionPoint.prototype={constructor:ConnectionPoint,clone:function(){return new ConnectionPoint(this.parentId,this.point.clone(),this.id,this.type)},equals:function(t){return this.id==t.id&&this.point.equals(t.point)&&this.parentId==t.parentId&&this.type==t.type&&this.color==t.color&&this.radius==t.radius},paint:function(t){t.save(),t.fillStyle=this.color,t.strokeStyle="#000000",t.lineWidth=defaultThinLineWidth,t.beginPath(),t.arc(this.point.x,this.point.y,ConnectionPoint.RADIUS,0,Math.PI/180*360,!1),t.stroke(),t.fill(),t.restore()},transform:function(t){this.point.transform(t)},highlight:function(){this.color=ConnectionPoint.OVER_COLOR},unhighlight:function(){this.color=ConnectionPoint.NORMAL_COLOR},contains:function(t,n){return this.near(t,n,ConnectionPoint.RADIUS)},near:function(t,n,i){return new Point(this.point.x,this.point.y).near(t,n,i)},toString:function(){return"ConnectionPoint id = "+this.id+" point = ["+this.point+"] ,type = "+this.type+", parentId = "+this.parentId+")"}},Glue.load=function(t){var n=new Glue(-1,-1,!1);return n.id1=t.id1,n.id2=t.id2,n.type1=t.type1,n.type2=t.type2,n.automatic=!!t.automatic&&t.automatic,n},Glue.loadArray=function(t){for(var n=[],i=0;i<t.length;i++)n.push(Glue.load(t[i]));return n},Glue.cloneArray=function(t){for(var n=[],i=0;i<t.length;i++)n.push(t[i].clone());return n},Glue.prototype={constructor:Glue,clone:function(){return new Glue(this.id1,this.id2,this.automatic)},equals:function(t){return!(!t instanceof Glue)&&(this.id1==t.id1&&this.id2==t.id2&&this.automatic==t.automatic&&this.type1==t.type1&&this.type2==t.type2)},toString:function(){return"Glue : (id1 = "+this.id1+", id2 = "+this.id2+", type1 = "+this.type1+", type2 = "+this.type2+", automatic = "+this.automatic+")"}};

// connectionManagers.js
"use strict";function ConnectorManager(){this.connectors=[],this.connectionPoints=[],this.connectionPointCurrentId=0,this.glues=[],this.connectionMode=ConnectorManager.MODE_DISABLED}ConnectorManager.CLOUD_RADIUS=12,ConnectorManager.CLOUD_LINEWIDTH=3,ConnectorManager.CLOUD_STROKE_STYLE="rgba(255, 153, 0, 0.8)",ConnectorManager.load=function(n){var t=new ConnectorManager;t.connectors=Connector.loadArray(n.connectors);for(var o=0;o<t.connectors.length;o++)"\n"+t.connectors[o].toString();t.connectionPoints=ConnectionPoint.loadArray(n.connectionPoints);for(o=0;o<t.connectionPoints.length;o++)"\n"+t.connectionPoints[o].toString();t.connectionPointCurrentId=n.connectionPointCurrentId,t.glues=Glue.loadArray(n.glues);for(o=0;o<t.glues.length;o++)"\n"+t.glues[o].toString();return t.connectionMode=n.connectionMode,t},ConnectorManager.prototype={constructor:ConnectorManager,equals:function(n){if(!n instanceof ConnectorManager)return!1;for(var t=0;t<this.connectors.length;t++)if(!this.connectors[t].equals(n.connectors[t]))return!1;for(t=0;t<this.connectionPoints.length;t++)if(!this.connectionPoints[t].equals(n.connectionPoints[t]))return!1;for(t=0;t<this.glues.length;t++)if(!this.glues[t].equals(n.glues[t]))return!1;return this.connectionPointCurrentId==n.connectionPointCurrentId&&this.connectionMode==n.connectionMode},toSVG:function(){for(var n="",t=0;t<this.connectors.length;t++)n+=this.connectors[t].toSVG();return n},connectorCreate:function(n,t,o){var i=STACK.generateId();this.connectors.push(new Connector(n,t,o,i)),this.connectionPointCreate(i,n,ConnectionPoint.TYPE_CONNECTOR),this.connectionPointCreate(i,t,ConnectionPoint.TYPE_CONNECTOR);this.connectorGetById(i);return i},connectorRemove:function(n){this.connectorRemoveById(n.id,!0)},connectorRemoveById:function(n,t){if(t){for(var o=this.connectionPointGetAllByParent(n),i=0;i<o.length;i++)this.glueRemoveAllBySecondId(o[i].id);this.connectionPointRemoveAllByParent(n)}for(var e=0;e<this.connectors.length;e++)if(this.connectors[e].id==n){this.connectors.splice(e,1);break}},connectorPaint:function(n,t){for(var o=0;o<this.connectors.length;o++){if(this.connectors[o].id==t){n.save(),null==this.connectors[o].style.lineWidth&&(this.connectors[o].style.lineWidth=1);var i=this.connectors[o].style.clone(),e=this.connectors[o].style.lineWidth;this.connectors[o].style=new Style,this.connectors[o].style.lineWidth=parseInt(e)+2,this.connectors[o].style.strokeStyle="lime",this.connectors[o].paint(n),this.connectors[o].style=i,n.restore()}this.connectors[o].paint(n),this.connectors[o].id==t&&this.connectionPointPaint(n,this.connectors[o].id)}},connectorDisconnect:function(n){this.connectionPointHasGlues(n)&&this.glueRemove(n)},connectorConnect:function(n,t){var o,i;n.color=ConnectionPoint.CONNECTED_COLOR,t.color=ConnectionPoint.CONNECTED_COLOR,n.type==ConnectionPoint.TYPE_FIGURE?(o=n,i=t):(o=t,i=n),i.point.x=o.point.x,i.point.y=o.point.y,this.connectionPointIsConnected(i.id,o.id)||this.glueCreate(i.id,o.id,!1);var e=this.connectorGetById(i.parentId);null!=e&&this.connectionPointHasGlues(this.connectionPointGetAllByParent(e.id)[0].id)&&this.connectionPointHasGlues(this.connectionPointGetAllByParent(e.id)[1].id)&&e.type==Connector.TYPE_JAGGED&&(alert("Problem connector has "+e.turningPoints.length+" points"),e.jaggedReloaded(),e.redraw())},connectorSelectXY:function(n,t){this.connectorSelectedIndex=-1;for(var o=0;o<this.connectors.length;o++)if(this.connectors[o].contains(n,t)){this.connectorSelectedIndex=o;break}},connectorGetSelected:function(){return-1!=this.connectorSelectedIndex?this.connectors[this.connectorSelectedIndex]:null},connectorGetById:function(n){for(var t=0;t<this.connectors.length;t++)if(this.connectors[t].id==n)return this.connectors[t];return null},connectorGetByXY:function(n,t){for(var o=-1,i=0;i<this.connectors.length;i++)if(this.connectors[i].near(n,t,3)){o=this.connectors[i].id;break}return o},connectorGetByTextXY:function(n,t){for(var o=this.connectors.length-1;o>=0;o--){var i=this.connectors[o];if(i.middleText.contains(n,t))return i.id}return-1},connectorAdjustByConnectionPoint:function(n,t,o){var i=this.connectionPointGetById(n);Log.debug("connectorAdjustByConnectionPoint() - Cp is :"+i);var e=this.connectorGetById(i.parentId),c=this.connectionPointGetAllByParent(e.id);if(e.type===Connector.TYPE_STRAIGHT){var s=c[0].point.clone(),r=c[1].point.clone();e.turningPoints=[s,r]}else if(e.type===Connector.TYPE_JAGGED||e.type===Connector.TYPE_ORGANIC){var l=c[0].point.clone(),u=c[1].point.clone(),h=STACK.figureGetAsFirstFigureForConnector(e.id),a=null==h?null:h.getBounds(),P=STACK.figureGetAsSecondFigureForConnector(e.id),d=null==P?null:P.getBounds(),g=this.connector2Points(Connector.TYPE_JAGGED,l,u,a,d);e.applySolution(g),c[0].point=e.turningPoints[0].clone(),c[1].point=e.turningPoints[e.turningPoints.length-1].clone()}},connectionPointGetFirstForConnector:function(n){return this.connectionPointGetAllByParentIdAndType(n,ConnectionPoint.TYPE_CONNECTOR)[0]},connectionPointGetSecondForConnector:function(n){return this.connectionPointGetAllByParentIdAndType(n,ConnectionPoint.TYPE_CONNECTOR)[1]},getClosestPointsOfConnection:function(n,t,o,i,e,c){return n||t?n&&!t?this.closestPointsAuto2Fixed(o,c):!n&&t?this.closestPointsFixed2Auto(i,e):n&&t?this.closestPointsAuto2Auto(o,i,e,c):void 0:this.closestPointsFixed2Fixed(i,c)},closestPointsAuto2Auto:function(n,t,o,i){if(n==o){var e=this.closestPointsAuto2Fixed(n,t,o,i);return e[1]=e[0],e[3]=e[2],e}for(var c,s,r,l=this.connectionPointGetAllByParent(n),u=l.length,h=l[0].point,a=l[0].id,P=this.connectionPointGetAllByParent(o),d=P.length,g=P[0].point,f=P[0].id,y=Util.distance(h,g),p=0;p<u;p++){c=l[p].point;for(var C=0;C<d;C++)s=P[C].point,(r=Util.distance(c,s))<y&&(y=r,h=c,a=l[p].id,g=s,f=P[C].id)}return[h.clone(),g.clone(),a,f]},closestPointsFixed2Auto:function(n,t){for(var o,i,e=this.connectionPointGetAllByParent(t),c=e.length,s=e[0].point,r=e[0].id,l=Util.distance(n,s),u=1;u<c;u++)o=e[u].point,(i=Util.distance(n,o))<l&&(l=i,s=o,r=e[u].id);return[n,s.clone(),-1,r]},closestPointsAuto2Fixed:function(n,t){for(var o,i,e=this.connectionPointGetAllByParent(n),c=e.length,s=e[0].point,r=e[0].id,l=Util.distance(s,t),u=1;u<c;u++)o=e[u].point,(i=Util.distance(o,t))<l&&(l=i,s=o,r=e[u].id);return[s.clone(),t,r,-1]},closestPointsFixed2Fixed:function(n,t){return[n,t,-1,-1]},connector2Points:function(n,t,o,i,e){var c=Log.level;Log.group("connectionManager: connector2Points"),Log.info("ConnectionManager: connector2Points ("+n+", "+t+", "+o+", "+i+", "+e+")");var s=[];switch(n){case Connector.TYPE_STRAIGHT:var r=[t.clone(),o.clone()];s.push(["straight","straight",r]);break;case Connector.TYPE_ORGANIC:case Connector.TYPE_JAGGED:var l=null,u=null;if(null!=i){(a=[]).push(new Point(t.x,i[1]-FIGURE_ESCAPE_DISTANCE)),a.push(new Point(i[2]+FIGURE_ESCAPE_DISTANCE,t.y)),a.push(new Point(t.x,i[3]+FIGURE_ESCAPE_DISTANCE)),a.push(new Point(i[0]-FIGURE_ESCAPE_DISTANCE,t.y)),l=a[0];for(var h=1;h<a.length;h++)Util.distance(t,a[h])<Util.distance(t,l)&&(l=a[h]);null==l&&alert("No way")}if(null!=e){var a;(a=[]).push(new Point(o.x,e[1]-FIGURE_ESCAPE_DISTANCE)),a.push(new Point(e[2]+FIGURE_ESCAPE_DISTANCE,o.y)),a.push(new Point(o.x,e[3]+FIGURE_ESCAPE_DISTANCE)),a.push(new Point(e[0]-FIGURE_ESCAPE_DISTANCE,o.y)),u=a[0];for(h=1;h<a.length;h++)Util.distance(o,a[h])<Util.distance(o,u)&&(u=a[h]);null==u&&alert("No way")}var P=[t],d=0;l&&(P.push(l),d=1),u&&P.push(u),P.push(o);var g=Point.cloneArray(P);s.push(["s0","s0",g]);var f=Point.cloneArray(P),y=Point.cloneArray(f);y.splice(d+1,0,new Point(y[d].x,y[d+1].y)),s.push(["s1","s1_1",y]);var p=Point.cloneArray(f);p.splice(d+1,0,new Point(p[d+1].x,p[d].y)),s.push(["s1","s1_2",p]);var C=Point.cloneArray(P),v=new Point((C[d].x+C[d+1].x)/2,C[d].y),A=new Point((C[d].x+C[d+1].x)/2,C[d+1].y);C.splice(d+1,0,v,A),s.push(["s2","s2_1",C]);var I=Point.cloneArray(P),G=new Point(I[d].x,(I[d].y+I[d+1].y)/2),E=new Point(I[d+1].x,(I[d].y+I[d+1].y)/2);I.splice(d+1,0,G,E),s.push(["s2","s2_2",I]);var S=Point.cloneArray(P),x=[S[d].x+20,S[d+1].x+20];i&&x.push(i[2]+20),e&&x.push(e[2]+20);var B=Util.max(x),_=new Point(B,S[d].y),R=new Point(B,S[d+1].y);S.splice(d+1,0,_,R),s.push(["s2","s2_3",S]);var T=Point.cloneArray(P),O=[T[d].y-20,T[d+1].y-20];i&&O.push(i[1]-20),e&&O.push(e[1]-20);var m=Util.min(O),w=new Point(T[d].x,m),U=new Point(T[d+1].x,m);T.splice(d+1,0,w,U),s.push(["s2","s2_4",T]);var M=Point.cloneArray(P),L=[M[d].x-20,M[d+1].x-20];i&&L.push(i[0]-20),e&&L.push(e[0]-20);var D=Util.min(L),N=new Point(D,M[d].y),F=new Point(D,M[d+1].y);M.splice(d+1,0,N,F),s.push(["s2","s2_5",M]);var Y=Point.cloneArray(P),b=[Y[d].y+20,Y[d+1].y+20];i&&b.push(i[3]+20),e&&b.push(e[3]+20);var k=Util.max(b),H=new Point(Y[d].x,k),K=new Point(Y[d+1].x,k);Y.splice(d+1,0,H,K),s.push(["s2","s2_6",Y]),Log.info("Filter orthogonal solutions. Initial number of solutions = "+s.length);for(var W=[],q=0;q<s.length;q++){var X=s[q][2];Util.orthogonalPath(X)&&W.push(s[q])}if(s=W,Log.info("\n\tOrthogonalSolutions = "+s.length),t.equals(o))Log.info("Start and end point coincide...skip backward solution. I think we will just fall on s0 :)");else{Log.info("Filter backward solutions. Initial number of solutions = "+s.length);var V=[],j="";for(q=0;q<s.length;q++){X=s[q][2];Util.forwardPath(X)?V.push(s[q]):j=j+"\n\t"+X}s=V,Log.info("\n\t ForwardSolutions = "+s.length),0==s.length&&Log.info("Discarded solutions: "+j)}Log.info("Filter non intersecting solutions. Initial number of solutions = "+s.length);var J=[];for(q=0;q<s.length;q++){var z=!1,Q=(X=s[q][2]).slice();(e||i)&&(Q=Q.slice(1,Q.length-1)),i&&(z=z||Util.polylineIntersectsRectangle(Q,i)),e&&(z=z||Util.polylineIntersectsRectangle(Q,e)),z||J.push(s[q])}0!=J.length&&(s=J),Log.info("\n\t nonIntersectionSolutions = "+s.length),Log.info("Get first class of solutions with same nr of points"),0==s.length&&alert("This is not possible");var Z=s[0][2].length,$=[];for(q=0;q<s.length;q++){(X=s[q][2]).length==Z&&$.push(s[q])}s=$,Log.info("pick the first solution with 90 degree angles (less turnarounds)");var nn=0;for(q=0;q<s.length;q++){X=s[q][2];Util.scorePath(s[nn][2])<Util.scorePath(s[q][2])&&(nn=q)}s=[s[nn]]}return n===Connector.TYPE_ORGANIC&&this.smoothOrganic(s),Log.groupEnd(),Log.level=c,s},smoothOrganic:function(n){for(var t=0;t<n.length;t++){if("s1"==n[t][0]){var o=n[t][2],i=Util.collinearReduction(o);n[t][2]=i}}},_scorePath:function(n,t){var o=n.length;if(o<3)return-1;for(var i=0,e=1;e<o-1;e++)if(n[e-1].x==n[e].x&&n[e].x==n[e+1].x){if(signum(n[e+1].y-n[e].y)!=signum(n[e].y-n[e-1].y))return-1;t&&i++}else if(n[e-1].y==n[e].y&&n[e].y==n[e+1].y){if(signum(n[e+1].x-n[e].x)!=signum(n[e].x-n[e-1].x))return-1;t&&i++}else t||i++;return i},_validPath:function(n){var t=n.length;if(t<3)return!1;for(var o=1;o<t-1;o++)if(n[o-1].x==n[o].x&&n[o].x==n[o+1].x){if(signum(n[o+1].y-n[o].y)!=signum(n[o].y-n[o-1].y))return!1}else if(n[o-1].y==n[o].y&&n[o].y==n[o+1].y&&signum(n[o+1].x-n[o].x)!=signum(n[o].x-n[o-1].x))return!1;return!0},reset:function(){this.connectors=[],this.connectorSelectedIndex=-1,this.connectionPoints=[],this.connectionPointSelectedIndex=-1,this.connectionPointCurrentId=0},connectionPointGetSelected:function(){return-1==this.connectionPointSelectedIndex?null:this.connectionPoints[this.connectionPointSelectedIndex]},connectionPointGetByXY:function(n,t,o){for(var i=-1,e=0;e<this.connectionPoints.length;e++)if(this.connectionPoints[e].contains(n,t)&&this.connectionPoints[e].type==o){i=this.connectionPoints[e].id;break}return i},connectionPointGetByXYRadius:function(n,t,o,i,e){var c,s,r,l=-1,u=-1,h=-1;for(c=n-o;c<=n+o;c++)for(s=t-o;s<=t+o;s++)e.contains(c,s)||-1!==(l=this.connectionPointGetByXY(c,s,i))&&(r=Math.sqrt(Math.pow(c-n,2)+Math.pow(s-t,2)),(-1===h||r<h)&&(h=r,u=l));return u},connectionPointsResetColor:function(){for(var n=0;n<this.connectionPoints.length;n++)this.connectionPoints[n].color=ConnectionPoint.NORMAL_COLOR},connectionPointCreate:function(n,t,o){var i=new ConnectionPoint(n,t.clone(),this.connectionPointCurrentId++,o);return this.connectionPoints.push(i),i},connectionPointAdd:function(n){this.connectionPoints.push(n)},connectionPointRemoveAllByParent:function(n){for(var t=0;t<this.connectionPoints.length;t++)this.connectionPoints[t].parentId==n&&(this.connectionPoints.splice(t,1),t--)},connectionPointGetById:function(n){for(var t=0;t<this.connectionPoints.length;t++)if(this.connectionPoints[t].id==n)return this.connectionPoints[t];return null},connectionPointGetByParentAndCoordinates:function(n,t,o){for(var i=0;i<this.connectionPoints.length;i++)if(this.connectionPoints[i].parentId==n&&this.connectionPoints[i].point.x==t&&this.connectionPoints[i].point.y==o)return this.connectionPoints[i];return null},connectionPointGetAllByParent:function(n){var t=[];for(var o in this.connectionPoints)this.connectionPoints[o].parentId==n&&t.push(this.connectionPoints[o]);return t},connectionPointGetAllByParentIdAndType:function(n,t){var o=[];for(var i in this.connectionPoints)this.connectionPoints[i].parentId==n&&this.connectionPoints[i].type==t&&o.push(this.connectionPoints[i]);return o},connectionPointOver:function(n,t,o){var i=null;if("number"==typeof o)if(o<0)for(var e in this.connectionPoints)this.connectionPoints[e].parentId!=-o&&this.connectionPoints[e].contains(n,t)&&(this.connectionPoints[e].color=ConnectionPoint.OVER_COLOR,i=this.connectionPoints[e]);else{var c=this.connectionPointGetAllByParent(o);for(var s in c)c[s].contains(n,t)&&(c[s].color=ConnectionPoint.OVER_COLOR,i=c[s])}else for(var r in this.connectionPoints)this.connectionPoints[r].contains(n,t)&&(this.connectionPoints[r].color=ConnectionPoint.OVER_COLOR,i=this.connectionPoints[r]);return i},connectionPointPaint:function(n,t){var o=this.connectionPointGetAllByParent(t);for(var i in o)o[i].paint(n)},connectionPointTransform:function(n,t){for(var o=this.connectionPointGetAllByParent(n),i=STACK.figureGetById(n),e=0;e<o.length;e++){o[e].transform(t);for(var c=this.glueGetByFirstConnectionPointId(o[e].id),s=c.length,r=0;r<s;r++){var l,u,h,a,P,d,g=this.connectionPointGetById(c[r].id2),f=this.connectorGetById(g.parentId),y=this.connectionPointGetAllByParent(f.id),p=y[0].point,C=y[1].point;if(g.id==y[0].id){y[0].transform(t),l=i;var v=this.glueGetBySecondConnectionPointId(y[1].id)[0],A=v?this.connectionPointGetById(v.id1):null;u=A?STACK.figureGetById(A.parentId):null,P=c[r].automatic,d=v&&v.automatic}else{y[1].transform(t),u=i;var I=this.glueGetBySecondConnectionPointId(y[0].id)[0],G=I?this.connectionPointGetById(I.id1):null;l=G?STACK.figureGetById(G.parentId):null,P=I&&I.automatic,d=c[r].automatic}h=l?l.getBounds():null,a=u?u.getBounds():null;var E=CONNECTOR_MANAGER.getClosestPointsOfConnection(P,d,l?l.id:-1,p,u?u.id:-1,C);DIAGRAMO.debugSolutions=CONNECTOR_MANAGER.connector2Points(f.type,E[0],E[1],h,a),f.applySolution(DIAGRAMO.debugSolutions),y[0].point=f.turningPoints[0].clone(),y[1].point=f.turningPoints[f.turningPoints.length-1].clone()}}},connectionPointIsConnected:function(n,t){for(var o=0;o<this.glues.length;o++)if(n==this.glues[o].id1&&t==this.glues[o].id2||n==this.glues[o].id2&&t==this.glues[o].id1)return!0;return!1},connectionPointHasGlues:function(n){for(var t=0;t<this.glues.length;t++)if(n==this.glues[t].id1||n==this.glues[t].id2)return!0;return!1},glueGetByFirstConnectionPointId:function(n){for(var t,o=[],i=0;i<this.glues.length;i++)(t=this.glues[i]).id1==n&&o.push(t);return o},glueGetBySecondConnectionPointId:function(n){for(var t=[],o=0;o<this.glues.length;o++)this.glues[o].id2==n&&t.push(this.glues[o]);return t},glueCreate:function(n,t,o){var i=new Glue(n,t,o);return this.glues.push(i),i},glueAdd:function(n){this.glues.push(n)},glueRemoveByIds:function(n,t){for(var o=0;o<this.glues.length;o++)n==this.glues[o].id1&&t==this.glues[o].id2&&this.glues.splice(o,1)},glueRemoveAllByFirstId:function(n){for(var t=0;t<this.glues.length;t++)n==this.glues[t].id1&&this.glues.splice(t,1)},glueRemoveAllBySecondId:function(n){for(var t=0;t<this.glues.length;t++)n==this.glues[t].id2&&this.glues.splice(t,1)},glueGetAllByIds:function(n,t){for(var o=[],i=0;i<this.glues.length;i++)this.glues[i].id1==n&&this.glues[i].id2==t&&o.push(this.glues[i]);return o},connectionCloudPaint:function(n){if(DIAGRAMO.visualMagnet&&currentCloud.length){var t=this.connectionPointGetById(currentCloud[0]),o=this.connectionPointGetById(currentCloud[1]),i=(o.point.x+t.point.x)/2,e=(o.point.y+t.point.y)/2,c=ConnectorManager.CLOUD_RADIUS,s=ConnectorManager.CLOUD_RADIUS/2,r=Math.atan((o.point.y-t.point.y)/(o.point.x-t.point.x));if(n.save(),n.beginPath(),n.ellipse)n.ellipse(i,e,c,s,r,0,2*Math.PI,!1);else{var l=4*c/3,u=Math.sin(r)*s,h=Math.cos(r)*s,a=Math.cos(r)*l,P=Math.sin(r)*l,d=i-u,g=e+h,f=d+a,y=g+P,p=d-a,C=g-P,v=i+u,A=e-h,I=v+a,G=A+P,E=v-a,S=A-P;n.moveTo(v,A),n.bezierCurveTo(I,G,f,y,d,g),n.bezierCurveTo(p,C,E,S,v,A)}n.lineWidth=ConnectorManager.CLOUD_LINEWIDTH,n.strokeStyle=ConnectorManager.CLOUD_STROKE_STYLE,n.stroke(),n.closePath(),n.restore()}}};

// handles.js
"use strict";function Handle(a){this.type=a,this.x=0,this.y=0,this.visible=!0}function HandleManager(){}Handle.types=["n","ne","e","se","s","sw","w","nw","r"],Handle.connectorTypes=["ns","ew"],Handle.load=function(a){var n=new Handle(a.type);return n.x=a.x,n.y=a.y,n.visible=a.visible,n},Handle.loadArray=function(a){for(var n=[],e=0;e<a.length;e++)n.push(Handle.load(a[e]));return n},Handle.RADIUS=3,Handle.prototype={constructor:Handle,equals:function(a){return!(!a instanceof Handle)&&(this.type==a.type&&this.x==a.x&&this.y==a.y&&this.visible==a.visible)},actionFigure:function(a,n,e){var t=this.actionShape(a,n,e);if("rotate"==t[0]){var r=new FigureRotateCommand(HandleManager.shape.id,t[1],t[2]);r.execute(),History.addUndo(r)}else if("scale"==t[0]){var i=new FigureScaleCommand(HandleManager.shape.id,t[1],t[2]);i.execute(),History.addUndo(i)}},actionContainer:function(a,n,e){var t=this.actionShape(a,n,e);if("rotate"==t[0])throw"Handles.js -> actionContainer -> rotate should be disabled for Container";if("scale"==t[0]){var r=new ContainerScaleCommand(HandleManager.shape.id,t[1],t[2]);r.execute(),History.addUndo(r)}},actionGroup:function(a,n,e){var t=this.actionShape(a,n,e);if("rotate"==t[0]){var r=new GroupRotateCommand(HandleManager.shape.id,t[1],t[2]);r.execute(),History.addUndo(r)}else if("scale"==t[0]){var i=new GroupScaleCommand(HandleManager.shape.id,t[1],t[2]);i.execute(),History.addUndo(i)}},actionShape:function(a,n,e){var t=[],r=HandleManager.shape.getBounds(),i=0,s=0,l=1,d=1;if("r"==this.type){var o=HandleManager.shape.rotationCoords[0].clone(),g=Util.getAngle(HandleManager.shape.rotationCoords[0],new Point(n,e))-Util.getAngle(HandleManager.shape.rotationCoords[0],HandleManager.shape.rotationCoords[1]);t=["rotate",Matrix.mergeTransformations(Matrix.translationMatrix(-o.x,-o.y),Matrix.rotationMatrix(g),Matrix.translationMatrix(o.x,o.y)),Matrix.mergeTransformations(Matrix.translationMatrix(-o.x,-o.y),Matrix.rotationMatrix(-g),Matrix.translationMatrix(o.x,o.y))]}else{var h=Util.getAngle(HandleManager.shape.rotationCoords[0],HandleManager.shape.rotationCoords[1]),M=HandleManager.shape.rotationCoords[0].clone(),H=new Point(n,e);H.transform(Matrix.translationMatrix(-M.x,-M.y)),H.transform(Matrix.rotationMatrix(-h)),H.transform(Matrix.translationMatrix(M.x,M.y)),n=H.x,e=H.y;var c=new Point(this.x,this.y);switch(c.transform(Matrix.translationMatrix(-M.x,-M.y)),c.transform(Matrix.rotationMatrix(-h)),c.transform(Matrix.translationMatrix(M.x,M.y)),this.type){case"n":s=r[3],e<r[3]-5&&(d=(r[3]-e)/(r[3]-c.y));break;case"s":s=r[1],e>r[1]+5&&(d=(e-r[1])/(c.y-r[1]));break;case"w":i=r[2],n<r[2]-5&&(l=(r[2]-n)/(r[2]-c.x));break;case"e":i=r[0],n>r[0]+5&&(l=(n-r[0])/(c.x-r[0]));break;case"nw":i=r[2],s=r[3],n<r[2]-5&&e<r[3]-5&&(d=(r[3]-e)/(r[3]-c.y),l=(r[2]-n)/(r[2]-c.x));break;case"ne":i=r[0],s=r[3],n>r[0]+5&&e<r[3]-5&&(l=(n-r[0])/(c.x-r[0]),d=(r[3]-e)/(r[3]-c.y));break;case"sw":i=r[2],s=r[1],n<r[2]-5&&e>r[1]+5&&(l=(r[2]-n)/(r[2]-c.x),d=(e-r[1])/(c.y-r[1]));break;case"se":i=r[0],s=r[1],n>r[0]+5&&e>r[1]+5&&(d=(e-r[1])/(c.y-r[1]),l=(n-r[0])/(c.x-r[0]))}SHIFT_PRESSED||0==i||0==s||("w-resize"==this.getCursor()||"e-resize"==this.getCursor()?d=l:l=d);var u=Matrix.mergeTransformations(Matrix.translationMatrix(-M.x,-M.y),Matrix.rotationMatrix(-h),Matrix.translationMatrix(M.x,M.y)),x=Matrix.mergeTransformations(Matrix.translationMatrix(-i,-s),Matrix.scaleMatrix(l,d),Matrix.translationMatrix(i,s)),f=Matrix.mergeTransformations(Matrix.translationMatrix(-i,-s),Matrix.scaleMatrix(1/l,1/d),Matrix.translationMatrix(i,s)),p=Matrix.mergeTransformations(Matrix.translationMatrix(-M.x,-M.y),Matrix.rotationMatrix(h),Matrix.translationMatrix(M.x,M.y));t=["scale",Matrix.mergeTransformations(u,x,p),Matrix.mergeTransformations(u,f,p)]}return t},actionConnector:function(a,n,e){switch(this.type){case"v":for(var t=1;t<HandleManager.shape.turningPoints.length-1;t++)HandleManager.shape.turningPoints[t-1].y==HandleManager.shape.turningPoints[t].y&&HandleManager.shape.turningPoints[t].y==this.y&&Math.min(HandleManager.shape.turningPoints[t].x,HandleManager.shape.turningPoints[t-1].x)<=this.x&&Math.max(HandleManager.shape.turningPoints[t].x,HandleManager.shape.turningPoints[t-1].x)>=this.x&&(s=t);var r=e-a[1],i=Matrix.translationMatrix(0,r);HandleManager.shape.turningPoints[s-1].transform(i),HandleManager.shape.turningPoints[s].transform(i),HandleManager.shape.addUserChange({align:Connector.USER_CHANGE_VERTICAL_ALIGN,delta:r,index:s-1}),HandleManager.shape.addUserChange({align:Connector.USER_CHANGE_VERTICAL_ALIGN,delta:r,index:s});break;case"h":var s;for(t=1;t<HandleManager.shape.turningPoints.length-1;t++)HandleManager.shape.turningPoints[t-1].x==HandleManager.shape.turningPoints[t].x&&HandleManager.shape.turningPoints[t].x==this.x&&Math.min(HandleManager.shape.turningPoints[t].y,HandleManager.shape.turningPoints[t-1].y)<=this.y&&Math.max(HandleManager.shape.turningPoints[t].y,HandleManager.shape.turningPoints[t-1].y)>=this.y&&(s=t);var l=n-a[0];i=Matrix.translationMatrix(l,0);HandleManager.shape.turningPoints[s-1].transform(i),HandleManager.shape.turningPoints[s].transform(i),HandleManager.shape.addUserChange({align:Connector.USER_CHANGE_HORIZONTAL_ALIGN,delta:l,index:s-1}),HandleManager.shape.addUserChange({align:Connector.USER_CHANGE_HORIZONTAL_ALIGN,delta:l,index:s})}HandleManager.shape.updateMiddleText()},action:function(a,n,e){if(null==a||2!=a.length)throw"Handle:action() Last move is wrong";HandleManager.shape instanceof Connector?this.actionConnector(a,n,e):HandleManager.shape instanceof Figure?this.actionFigure(a,n,e):HandleManager.shape instanceof Group?this.actionGroup(a,n,e):HandleManager.shape instanceof Container&&this.actionContainer(a,n,e)},paint:function(a){if(a.save(),a.beginPath(),a.arc(this.x,this.y,Handle.RADIUS,0,2*Math.PI,!1),a.fillStyle="rgb(0,255,0)",a.closePath(),a.fill(),a.beginPath(),a.arc(this.x,this.y,Handle.RADIUS,0,2*Math.PI,!1),a.strokeStyle="rgb(0,0,0)",a.lineWidth=defaultThinLineWidth,a.closePath(),a.stroke(),"r"==this.type){var n=new Line(new Point(this.x,this.y),new Point(HandleManager.handles[1].x,HandleManager.handles[1].y));n.style.dashLength=3,n.style.strokeStyle="grey",n.style.lineWidth=defaultThinLineWidth,n.paint(a)}a.restore()},contains:function(a,n){return new Point(this.x,this.y).near(a,n,Handle.RADIUS)},getBounds:function(){return[this.x-Handle.RADIUS,this.y-Handle.RADIUS,this.x+Handle.RADIUS,this.y+Handle.RADIUS]},transform:function(a){var n=new Point(this.x,this.y);n.transform(a),this.x=n.x,this.y=n.y},getCursor:function(){if(HandleManager.shape instanceof Connector)return 0==this.visible?"":"v"==this.type?"ns-resize":"ew-resize";if(HandleManager.shape instanceof Figure){if(0==this.visible)return"";if("r"==this.type)return"move";for(var a=HandleManager.shape.getBounds(),n=new Point(a[0]+(a[2]-a[0])/2,a[1]+(a[3]-a[1])/2),e=-1,t=2*Math.PI,r=0;r<HandleManager.handles.length-1;r++){var i=new Point(HandleManager.handles[r].x,HandleManager.handles[r].y);(l=Util.getAngle(n,i))<=Math.PI?l<t&&(t=l,e=r):2*Math.PI-l<t&&(t=2*Math.PI-l,e=r)}for(var s=0;s<8;s++)if(HandleManager.handles[(e+s)%8]==this)return Handle.types[s]+"-resize"}else if(HandleManager.shape instanceof Container){if(0==this.visible)return"";if("r"==this.type)return"move";for(a=HandleManager.shape.getBounds(),n=new Point(a[0]+(a[2]-a[0])/2,a[1]+(a[3]-a[1])/2),e=-1,t=2*Math.PI,r=0;r<HandleManager.handles.length-1;r++){var l;i=new Point(HandleManager.handles[r].x,HandleManager.handles[r].y);(l=Util.getAngle(n,i))<=Math.PI?l<t&&(t=l,e=r):2*Math.PI-l<t&&(t=2*Math.PI-l,e=r)}for(s=0;s<8;s++)if(HandleManager.handles[(e+s)%8]==this)return Handle.types[s]+"-resize"}else if(HandleManager.shape instanceof Group){if(0==this.visible)return"";if("r"==this.type)return"move"}return""}},HandleManager.shape=null,HandleManager.handles=[],HandleManager.connectorHandles=[],HandleManager.selectRect=null,HandleManager.handleSelectedIndex=-1,HandleManager.handleOffset=0,HandleManager.handleGetSelected=function(){return-1!=HandleManager.handleSelectedIndex?HandleManager.handles[HandleManager.handleSelectedIndex]:null},HandleManager.shapeSet=function(a){if(HandleManager.shape=a,HandleManager.handles=[],a instanceof Connector){HandleManager.selectRect=null;for(var n=1;n<a.turningPoints.length-2;n++){var e;(Util.collinearity(HandleManager.shape.turningPoints[n-1],HandleManager.shape.turningPoints[n],HandleManager.shape.turningPoints[n+1])||Util.collinearity(HandleManager.shape.turningPoints[n],HandleManager.shape.turningPoints[n+1],HandleManager.shape.turningPoints[n+2])&&!HandleManager.shape.turningPoints[n+1].equals(HandleManager.shape.turningPoints[n+2]))&&(Util.collinearity(HandleManager.shape.turningPoints[n-1],HandleManager.shape.turningPoints[n],HandleManager.shape.turningPoints[n+1])&&!HandleManager.shape.turningPoints[n-1].equals(HandleManager.shape.turningPoints[n])||Util.collinearity(HandleManager.shape.turningPoints[n],HandleManager.shape.turningPoints[n+1],HandleManager.shape.turningPoints[n+2]))||(a.turningPoints[n].x===a.turningPoints[n+1].x?((e=new Handle("h")).x=HandleManager.shape.turningPoints[n].x,e.y=(HandleManager.shape.turningPoints[n].y+HandleManager.shape.turningPoints[n+1].y)/2):a.turningPoints[n].y===a.turningPoints[n+1].y&&((e=new Handle("v")).x=(HandleManager.shape.turningPoints[n].x+HandleManager.shape.turningPoints[n+1].x)/2,e.y=HandleManager.shape.turningPoints[n].y),e&&(e.visible=!0,HandleManager.handles.push(e)))}}else if(a instanceof Figure||a instanceof Group){var t=Util.getAngle(HandleManager.shape.rotationCoords[0],HandleManager.shape.rotationCoords[1]);HandleManager.shape.transform(Matrix.rotationMatrix(-t),!1),HandleManager.selectRect=new Polygon;var r=HandleManager.shape.getBounds();if(HandleManager.selectRect.points=[],HandleManager.selectRect.addPoint(new Point(r[0]-HandleManager.handleOffset,r[1]-HandleManager.handleOffset)),HandleManager.selectRect.addPoint(new Point(r[2]+HandleManager.handleOffset,r[1]-HandleManager.handleOffset)),HandleManager.selectRect.addPoint(new Point(r[2]+HandleManager.handleOffset,r[3]+HandleManager.handleOffset)),HandleManager.selectRect.addPoint(new Point(r[0]-HandleManager.handleOffset,r[3]+HandleManager.handleOffset)),r=HandleManager.selectRect.getBounds(),(i=new Handle("nw")).x=r[0],i.y=r[1],HandleManager.handles.push(i),(i=new Handle("n")).x=r[0]+(r[2]-r[0])/2,i.y=r[1],HandleManager.handles.push(i),(i=new Handle("ne")).x=r[2],i.y=r[1],HandleManager.handles.push(i),(i=new Handle("e")).x=r[2],i.y=r[1]+(r[3]-r[1])/2,HandleManager.handles.push(i),(i=new Handle("se")).x=r[2],i.y=r[3],HandleManager.handles.push(i),(i=new Handle("s")).x=r[0]+(r[2]-r[0])/2,i.y=r[3],HandleManager.handles.push(i),(i=new Handle("sw")).x=r[0],i.y=r[3],HandleManager.handles.push(i),(i=new Handle("w")).x=r[0],i.y=r[1]+(r[3]-r[1])/2,HandleManager.handles.push(i),(i=new Handle("r")).x=r[0]+(r[2]-r[0])/2,0!=HandleManager.handleOffset?i.y=r[1]-1.5*HandleManager.handleOffset:i.y=r[1]-15,HandleManager.handles.push(i),HandleManager.selectRect.transform(Matrix.rotationMatrix(t)),HandleManager.shape.transform(Matrix.rotationMatrix(t),!1),a instanceof Figure&&a.primitives[0]instanceof Text&&1==a.primitives.length)for(n=0;n<HandleManager.handles.length-1;n++)HandleManager.handles[n].visible=!1;for(n=0;n<HandleManager.handles.length;n++)HandleManager.handles[n].transform(Matrix.rotationMatrix(t))}else if(a instanceof Container){var i;r=HandleManager.shape.getBounds();HandleManager.selectRect=new Polygon,HandleManager.selectRect.points=[],HandleManager.selectRect.addPoint(new Point(r[0]-HandleManager.handleOffset,r[1]-HandleManager.handleOffset)),HandleManager.selectRect.addPoint(new Point(r[2]+HandleManager.handleOffset,r[1]-HandleManager.handleOffset)),HandleManager.selectRect.addPoint(new Point(r[2]+HandleManager.handleOffset,r[3]+HandleManager.handleOffset)),HandleManager.selectRect.addPoint(new Point(r[0]-HandleManager.handleOffset,r[3]+HandleManager.handleOffset)),r=HandleManager.selectRect.getBounds(),(i=new Handle("nw")).x=r[0],i.y=r[1],HandleManager.handles.push(i),(i=new Handle("n")).x=r[0]+(r[2]-r[0])/2,i.y=r[1],HandleManager.handles.push(i),(i=new Handle("ne")).x=r[2],i.y=r[1],HandleManager.handles.push(i),(i=new Handle("e")).x=r[2],i.y=r[1]+(r[3]-r[1])/2,HandleManager.handles.push(i),(i=new Handle("se")).x=r[2],i.y=r[3],HandleManager.handles.push(i),(i=new Handle("s")).x=r[0]+(r[2]-r[0])/2,i.y=r[3],HandleManager.handles.push(i),(i=new Handle("sw")).x=r[0],i.y=r[3],HandleManager.handles.push(i),(i=new Handle("w")).x=r[0],i.y=r[1]+(r[3]-r[1])/2,HandleManager.handles.push(i)}},HandleManager.handleGetAll=function(){return HandleManager.handles},HandleManager.handleGet=function(a,n){for(var e=0;e<HandleManager.handles.length;e++)if(HandleManager.handles[e].contains(a,n))return HandleManager.handles[e];return null},HandleManager.handleSelectXY=function(a,n){HandleManager.handleSelectedIndex=-1;for(var e=0;e<HandleManager.handles.length;e++)HandleManager.handles[e].contains(a,n)&&(HandleManager.handleSelectedIndex=e)},HandleManager.clear=function(){HandleManager.handleSelectedIndex=-1,HandleManager.shape=null,HandleManager.handles=[]},HandleManager.paint=function(a){var n=HandleManager.handleGetAll();a.save(),null!=HandleManager.selectRect&&(HandleManager.selectRect.style.strokeStyle="grey",HandleManager.selectRect.style.lineWidth=defaultThinLineWidth,HandleManager.selectRect.paint(a));for(var e=0;e<n.length;e++)1==n[e].visible&&n[e].paint(a);a.restore()};

// builder.js
"use strict";function Builder(){}function BuilderProperty(e,t,r){this.name=e,this.property=t,this.type=r}Builder.IMAGE_BASE_PATH="./assets/images/",Builder.IMAGE_FILL_ICON_PATH=Builder.IMAGE_BASE_PATH+"prop-icon-fill.png",Builder.IMAGE_STROKE_ICON_PATH=Builder.IMAGE_BASE_PATH+"prop-icon-stroke.png",Builder.IMAGE_LINEWIDTH_ICON_PATH=Builder.IMAGE_BASE_PATH+"prop-icon-linewidth.png",Builder.IMAGE_LINESTYLE_ICON_PATH=Builder.IMAGE_BASE_PATH+"prop-icon-linestyle.png",Builder.IMAGE_STARTSTYLE_ICON_PATH=Builder.IMAGE_BASE_PATH+"prop-icon-startstyle.png",Builder.IMAGE_ENDSTYLE_ICON_PATH=Builder.IMAGE_BASE_PATH+"prop-icon-endstyle.png",Builder.IMAGE_WIDTH_ICON_PATH=Builder.IMAGE_BASE_PATH+"prop-icon-h-resize.png",Builder.IMAGE_HEIGHT_ICON_PATH=Builder.IMAGE_BASE_PATH+"prop-icon-v-resize.png",Builder.IMAGE_URL_ICON_PATH=Builder.IMAGE_BASE_PATH+"prop-icon-url.png",Builder.IMAGE_TEXT_ICON_PATH=Builder.IMAGE_BASE_PATH+"prop-icon-text.png",Builder.constructPropertiesPanel=function(e,t){for(var r=0;r<t.properties.length;r++)!1===/(primitives\.\d+|middleText)\.(str|size|font|align|underlined|style\.fillStyle)/g.test(t.properties[r].property)&&t.properties[r].injectInputArea(e,t.id)},Builder.constructTextPropertiesPanel=function(e,t,r,i){return(e=new TextEditorPopup(e,t,r,i)).init(),e},Builder.constructCanvasPropertiesPanel=function(e,t){},BuilderProperty.TYPE_COLOR="Color",BuilderProperty.TYPE_TEXT="Text",BuilderProperty.TYPE_SINGLE_TEXT="SingleText",BuilderProperty.TYPE_TEXT_FONT_SIZE="TextFontSize",BuilderProperty.TYPE_TEXT_FONT_FAMILY="TextFontFamily",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT="TextFontAlignment",BuilderProperty.TYPE_TEXT_UNDERLINED="TextUnderlined",BuilderProperty.TYPE_BOOLEAN="Boolean",BuilderProperty.TYPE_LINE_WIDTH="LineWidth",BuilderProperty.TYPE_LINE_STYLE="LineStyle",BuilderProperty.TYPE_IMAGE_FILL="ImageFill",BuilderProperty.TYPE_IMAGE_UPLOAD="ImageUpload",BuilderProperty.TYPE_CONNECTOR_END="ConnectorEnd",BuilderProperty.TYPE_URL="URL";var userLanguage=window.navigator.userLanguage||window.navigator.language;"es"==userLanguage.substring(0,2)?(BuilderProperty.LINE_WIDTHS=[{Text:"Borde con ancho de 1px",Value:"1"},{Text:"Borde con ancho de 2px",Value:"2"},{Text:"Borde con ancho de 3px",Value:"3"},{Text:"Borde con ancho de 4px",Value:"4"},{Text:"Borde con ancho de 5px",Value:"5"},{Text:"Borde con ancho de 6px",Value:"6"},{Text:"Borde con ancho de 7px",Value:"7"},{Text:"Borde con ancho de 8px",Value:"8"},{Text:"Borde con ancho de 9px",Value:"9"},{Text:"Borde con ancho de 10px",Value:"10"}],BuilderProperty.LINE_STYLES=[{Text:"Borde continuo",Value:"continuous"},{Text:"Borde punteado",Value:"dotted"},{Text:"Borde interlineado",Value:"dashed"}]):(BuilderProperty.LINE_WIDTHS=[{Text:"1px width border",Value:"1"},{Text:"2px width border",Value:"2"},{Text:"3px width border",Value:"3"},{Text:"4px width border",Value:"4"},{Text:"5px width border",Value:"5"},{Text:"6px width border",Value:"6"},{Text:"7px width border",Value:"7"},{Text:"8px width border",Value:"8"},{Text:"9px width border",Value:"9"},{Text:"10px width border",Value:"10"}],BuilderProperty.LINE_STYLES=[{Text:"Continuous border",Value:"continuous"},{Text:"Dotted border",Value:"dotted"},{Text:"Dashed border",Value:"dashed"}]),BuilderProperty.FONT_SIZES=[];for(var i=6;i<73;i++)BuilderProperty.FONT_SIZES.push({Text:i,Value:i});function TextEditorPopup(e,t,r,i){var o;this.editor=e,this.tools=t,this.shape=r,this.textPrimitiveId=i,o=this.shapeIsAConnector()?"middleText.":"primitives."+this.textPrimitiveId+".",this.stringPropertyName=o+TextEditorPopup.STRING_PROPERTY_ENDING,this.sizePropertyName=o+TextEditorPopup.SIZE_PROPERTY_ENDING,this.fontPropertyName=o+TextEditorPopup.FONT_PROPERTY_ENDING,this.alignPropertyName=o+TextEditorPopup.ALIGN_PROPERTY_ENDING,this.colorPropertyName=o+TextEditorPopup.COLOR_PROPERTY_ENDING,this.underlinedPropertyName=o+TextEditorPopup.UNDERLINED_PROPERTY_ENDING}"es"==userLanguage.substring(0,2)?BuilderProperty.CONNECTOR_ENDS=[{Text:"Lnea",Value:"Normal"},{Text:"Flecha",Value:"Filled"}]:BuilderProperty.CONNECTOR_ENDS=[{Text:"Line",Value:"Normal"},{Text:"Arrow",Value:"Filled"}],BuilderProperty.SEPARATOR="SEPARATOR",BuilderProperty.BUTTON_CHECKER_CLASS="button-checker",BuilderProperty.BUTTON_CHECKED_ATTRIBUTE="button-checked",BuilderProperty.TEXT_UNDERLINED_LABEL="U",BuilderProperty.load=function(e){var t=new BuilderProperty;return t.name=e.name,t.property=e.property,t.type=e.type,t},BuilderProperty.loadArray=function(e){for(var t=[],r=0;r<e.length;r++)t.push(BuilderProperty.load(e[r]));return t},BuilderProperty.prototype={constructor:BuilderProperty,toString:function(){return"Propery type: "+this.type+" name: "+this.name+" property: "+this.property},equals:function(e){return this.type==e.type&&this.name==e.name&&this.property==e.property},injectInputArea:function(e,t){this.name!==BuilderProperty.SEPARATOR?this.type===BuilderProperty.TYPE_COLOR?this.generateColorCode(e,t):this.type===BuilderProperty.TYPE_TEXT?this.generateTextCode(e,t):this.type===BuilderProperty.TYPE_SINGLE_TEXT?this.generateSingleTextCode(e,t):this.type===BuilderProperty.TYPE_TEXT_FONT_SIZE?this.generateArrayCode(e,t,BuilderProperty.FONT_SIZES):this.type===BuilderProperty.TYPE_TEXT_FONT_FAMILY?this.generateArrayCode(e,t,Text.FONTS):this.type===BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT?this.generateArrayCode(e,t,Text.ALIGNMENTS):this.type===BuilderProperty.TYPE_TEXT_UNDERLINED?this.generateButtonCheckerCode(e,t):this.type===BuilderProperty.TYPE_CONNECTOR_END?this.generateArrayCode(e,t,BuilderProperty.CONNECTOR_ENDS):this.type===BuilderProperty.TYPE_LINE_WIDTH?this.generateArrayCode(e,t,BuilderProperty.LINE_WIDTHS):this.type===BuilderProperty.TYPE_LINE_STYLE?this.generateArrayCode(e,t,BuilderProperty.LINE_STYLES):this.type===BuilderProperty.TYPE_URL&&this.generateURLCode(e,t):e.appendChild(document.createElement("hr"))},generateBooleanCode:function(e,t){(new Date).getTime();var r=this.getValue(t),i=document.createElement("div"),o=document.createElement("div");o.className="label",o.textContent=this.name,i.appendChild(o);var a,n,l=document.createElement("input");l.type="checkbox",l.className="text",l.checked=r,i.children[0].appendChild(l),l.onclick=(a=t,n=this.property,function(){setUndo(!0),updateShape(a,n,this.checked)}),e.appendChild(i)},generateTextCode:function(e,t){(new Date).getTime();var r=this.getValue(t),i=document.createElement("div");i.className="textLine";var o=document.createElement("div");o.className="label",o.textContent=this.name,i.appendChild(o);var a=document.createElement("textarea");a.className="text",a.value=r,a.spellcheck=!1,a.style.width="100%",i.appendChild(document.createElement("br")),i.appendChild(a);var n,l,d,s=!0;a.onchange=(this.property,function(){}),a.onblur=(n=t,l=this.property,d=a.value,function(){1==s&&(d!=this.value&&(setUndo(!0),updateShape(n,l,this.value,!0)),s=!1)}),a.onmouseout=a.onchange,a.onkeyup=a.onchange,e.appendChild(i)},generateSingleTextCode:function(e,t){(new Date).getTime();var r=this.getValue(t),i=document.createElement("div");i.className="line";var o=document.createElement("div");o.className="label",o.textContent=this.name;var a=new Image;a.className="prop-icon",a.src=Builder.IMAGE_TEXT_ICON_PATH,o.appendChild(a),i.appendChild(o);var n,l,d=document.createElement("input");d.type="text",d.className="text",d.value=r,i.appendChild(d),d.onchange=(n=t,l=this.property,function(){Log.info("Builder.generateSingleTextCode() value: "+this.value),setUndo(!0),updateShape(n,l,this.value)}),d.onmouseout=d.onchange,d.onkeyup=d.onchange,e.appendChild(i)},generateURLCode:function(e,t){(new Date).getTime();var r=this.getValue(t),i=this.property,o=t,a=document.createElement("div");a.className="line";var n=document.createElement("div");n.className="labelpic",a.appendChild(n);var l=document.createElement("input");l.setAttribute("type","button"),l.className="labelsubmit",l.value=STRING_CHANGEIMAGE;var d=document.createElement("input");d.setAttribute("type","button"),d.className="labelsubmit",d.value=STRING_DOWNLOADIMAGE,a.appendChild(l),a.appendChild(d);var s=document.createElement("input");s.setAttribute("type","file"),s.style.display="none",a.appendChild(s);var p=document.createElement("div");p.className="labelpic2",a.appendChild(p);var u=document.createElement("textarea");u.style.display="none",u.className="labelpictext",u.value=r,p.appendChild(u),l.onclick=function(){s.click()},d.onclick=function(){var e=STACK.figureGetById(t).primitives[0].url,r=e.split(";")[0].split("/")[1],i=document.createElement("img");i.src=e;var o=document.createElement("canvas");o.width=i.width,o.height=i.height,o.getContext("2d").drawImage(i,0,0);var a=o.toDataURL("image/"+r),n=document.createElement("a");n.style.display="none",document.body.appendChild(n),n.href=a,n.download="Image."+r,n.click()},s.onchange=function(e){try{var t=s.files[0].name.split(".").pop().toLowerCase();if("jpg"==t|"jpeg"==t|"png"==t){var r=new FileReader;r.readAsDataURL(s.files[0]),r.onload=function(){setUndo(!0),u.value=r.result,updateShape(o,i,u.value)}}else alert(STRING_CHANGEIMAGE_ERROR)}catch(e){}},u.onmouseout=u.onchange,u.onkeyup=u.onchange,e.appendChild(a)},generateArrayCode:function(e,t,r){(new Date).getTime();var i=this.getValue(t),o=document.createElement("div");o.className="line";var a=document.createElement("select");a.className="selectbox",a.id=this.property,o.appendChild(a);for(var n=0;n<r.length;n++){var l=document.createElement("option");l.value=r[n].Value,l.text=r[n].Text,a.options.add(l),l.value==i&&(l.selected=!0)}var d=this.property;a.onchange=function(){setUndo(!0),updateShape(t,d,this.options[this.selectedIndex].value)},e.appendChild(o)},generateColorCode:function(e,t){var r=this.getValue(t),i=(new Date).getTime(),o=document.createElement("div");o.className="line";var a=document.createElement("div");a.className="label","style.fillStyle"==this.property?a.textContent=STRING_BACKGROUND_COLOR:"style.strokeStyle"==this.property&&(a.textContent=STRING_BORDER_COLOR);this.property.split(".").pop();o.appendChild(a);var n=document.createElement("div");n.id="colorSelector"+i,n.className="color-selector";var l=document.createElement("input");l.type="text",l.id="colorpickerHolder"+i,l.value=r,n.appendChild(l),o.appendChild(n),e.appendChild(o);var d=document.getElementById("colorpickerHolder"+i);$(d).colorPicker();var s=this.property;d.onchange=function(){Log.info("generateColorCode(): figureId: "+t+"type: "+this.type+" name: "+this.name+" property: "+this.property),setUndo(!0),updateShape(t,s,d.value)}},generateButtonCheckerCode:function(e,t){var r=this.getValue(t),i=document.createElement("div");i.className="line";var o,a,n=document.createElement("input");n.type="button",n.id=this.property,n.className=BuilderProperty.BUTTON_CHECKER_CLASS,n.value=BuilderProperty.TEXT_UNDERLINED_LABEL,n.setAttribute(BuilderProperty.BUTTON_CHECKED_ATTRIBUTE,r),i.appendChild(n),n.onclick=(o=t,a=this.property,function(){var e="true"!=this.getAttribute(BuilderProperty.BUTTON_CHECKED_ATTRIBUTE);this.setAttribute(BuilderProperty.BUTTON_CHECKED_ATTRIBUTE,e),Log.info("Builder.generateButtonCheckerCode() value: "+e),setUndo(!0),updateShape(o,a,e)}),e.appendChild(i)},getValue:function(e){var t=STACK.figureGetById(e);null==t&&(t=CONNECTOR_MANAGER.connectorGetById(e)),null==t&&"canvas"==e&&(t=canvas),null==t&&(t=STACK.containerGetById(e)),Log.debug("Unsplit property: "+this.property);for(var r=this.property.split("."),i=0;i<r.length-1;i++)t=t[r[i]];var o=r[r.length-1],a="get"+Util.capitaliseFirstLetter(o);return a in t?t[a]():t[r[r.length-1]]}},TextEditorPopup.STRING_PROPERTY_ENDING="str",TextEditorPopup.SIZE_PROPERTY_ENDING="size",TextEditorPopup.FONT_PROPERTY_ENDING="font",TextEditorPopup.ALIGN_PROPERTY_ENDING="align",TextEditorPopup.COLOR_PROPERTY_ENDING="style.fillStyle",TextEditorPopup.UNDERLINED_PROPERTY_ENDING="underlined",TextEditorPopup.prototype={constructor:TextEditorPopup,shapeIsAConnector:function(){return"Connector"===this.shape.oType},init:function(){for(var e,t=0;t<this.shape.properties.length;t++){if(null!=(i=this.shape.properties[t].property)){var r=this.shape.properties[t].getValue(this.shape.id);switch(i){case this.stringPropertyName:this.shape.properties[t].injectInputArea(this.editor,this.shape.id),e=this.editor.getElementsByTagName("textarea")[0],removeNodeList(this.editor.getElementsByTagName("br")),this.setProperty(i,r)}}}for(t=0;t<this.shape.properties.length;t++){if(null!=(i=this.shape.properties[t].property)){r=this.shape.properties[t].getValue(this.shape.id);switch(i){case this.fontPropertyName:this.shape.properties[t].injectInputArea(this.tools,this.shape.id),this.setProperty(i,r)}}}for(t=0;t<this.shape.properties.length;t++){var i;if(null!=(i=this.shape.properties[t].property)){r=this.shape.properties[t].getValue(this.shape.id);switch(i){case this.sizePropertyName:case this.colorPropertyName:this.shape.properties[t].injectInputArea(this.tools,this.shape.id),this.setProperty(i,r)}}}this.editor.className="active",this.tools.className="active",this.placeAndAutoSize(),setSelectionRange(e,0,e.value.length)},setProperty:function(e,t){var r=this.editor.getElementsByTagName("textarea")[0];switch(e){case this.sizePropertyName:r.style.fontSize=t+"px",document.getElementById(e).value=t;break;case this.fontPropertyName:r.style.fontFamily=t,document.getElementById(e).value=t.toLowerCase();break;case this.alignPropertyName:r.style.textAlign=t,Browser.msie&&(r.value=r.value),document.getElementById(e).value=t;break;case this.underlinedPropertyName:r.style.textDecoration=1==t?"underline":"",document.getElementById(e).setAttribute(BuilderProperty.BUTTON_CHECKED_ATTRIBUTE,t);break;case this.colorPropertyName:r.style.color=t;var i=this.tools.getElementsByClassName("color_picker")[0];i.style["background-color"]=t,i.previousSibling.value=t}this.placeAndAutoSize()},placeAndAutoSize:function(){var e,t=this.editor.getElementsByTagName("textarea")[0],r=(e=this.shapeIsAConnector()?this.shape.middleText.getBounds():this.shape.primitives[this.textPrimitiveId].getBounds())[0]-defaultEditorBorderWidth-defaultEditorPadding,i=e[1]-defaultEditorBorderWidth-defaultEditorPadding,o=e[2]-e[0],a=e[3]-e[1];if(Browser.mozilla&&(a+=2*defaultEditorPadding,i-=defaultEditorPadding,o+=2*defaultEditorPadding,r-=defaultEditorPadding),Browser.msie){var n=parseInt(t.style["font-size"],10);o+=n/2,r-=n/4}this.editor.style.left=r+"px",this.editor.style.top=i+"px",this.tools.style.visibility="hidden",this.tools.style.left="0px",this.tools.style.top="0px";var l=this.tools.offsetHeight,d=this.tools.offsetWidth,s=r,p=getWorkAreaContainer().offsetWidth;s+d>=p-scrollBarWidth&&(s=p-d-scrollBarWidth);var u=i-l;u<=0&&(u=i+l+defaultEditorBorderWidth+defaultEditorPadding),this.tools.style.left=s+"px",this.tools.style.top=u+"px",this.tools.style.visibility="visible",t.style.width=o+"px",t.style.height=a+"px"},destroy:function(){this.editor.className="",this.editor.style.cssText="",this.editor.innerHTML="",this.tools.className="",this.tools.style.cssText="",this.tools.innerHTML=""},mouseClickedInside:function(e){var t=e.target;return t.id===this.editor.id||t.parentNode.id===this.editor.id||t.parentNode.parentNode.id===this.editor.id||t.id===this.tools.id||t.parentNode.id===this.tools.id||t.parentNode.parentNode.id===this.tools.id||"color_picker"===t.className||"color_selector"===t.id||"color_selector"===t.parentNode.id||"color_selector"===t.parentNode.parentNode.id},refersTo:function(e,t){var r=this.shape.equals(e);return null!=t&&(r&=this.textPrimitiveId===t),r},blurTextArea:function(){this.editor.getElementsByTagName("textarea")[0].onblur()}};

// text.js
"use strict";function Text(t,e,i,r,s,n,o){this.str=t,this.font=r,this.size=s,this.lineSpacing=.25*s,this.align=o||Text.ALIGN_CENTER,this.underlined=!1,this.vector=[new Point(e,i),new Point(e,i-20)],this.style=new Style,n||(this.bounds=this.getNormalBounds()),this.oType="Text"}Text.load=function(t){var e=new Text(t.str,t.x,t.y,t.font,t.size,!1,t.align);return e.underlined=t.underlined,e.vector=Point.loadArray(t.vector),e.style=Style.load(t.style),e},Text.ALIGN_LEFT="left",Text.ALIGN_CENTER="center",Text.ALIGN_RIGHT="right","es"==userLanguage.substring(0,2)?Text.ALIGNMENTS=[{Value:Text.ALIGN_LEFT,Text:"Izquierda"},{Value:Text.ALIGN_CENTER,Text:"Centro"},{Value:Text.ALIGN_RIGHT,Text:"Derecha"}]:Text.ALIGNMENTS=[{Value:Text.ALIGN_LEFT,Text:"Left"},{Value:Text.ALIGN_CENTER,Text:"Center"},{Value:Text.ALIGN_RIGHT,Text:"Right"}],Text.FONTS=[{Value:"arial",Text:"Arial"},{Value:"arial narrow",Text:"Arial Narrow"},{Value:"courier new",Text:"Courier New"},{Value:"tahoma",Text:"Tahoma"}],Text.SPACE_BETWEEN_CHARACTERS=2,Text.DEFAULT_SIZE=10,Text.UNDERLINE_THICKNESS_DIVIDER=16,Text.prototype={constructor:Text,getTextSize:function(){return this.size},setTextSize:function(t){this.getNormalBounds().getBounds(),this.size;this.size=t;this.getNormalBounds().getBounds()},getTextStr:function(){return this.str},setTextStr:function(t){this.getNormalBounds().getBounds();this.str=t;this.getNormalBounds().getBounds()},_getContext:function(){return document.getElementById("a").getContext("2d")},transform:function(t){this.vector[0].transform(t),this.vector[1].transform(t)},getAngle:function(){return Util.getAngle(this.vector[0],this.vector[1])},getNormalWidth:function(){var t=this.str.split("\n"),e=[],i=0;this._getContext().save(),this._getContext().font=this.size+"px "+this.font;for(var r in t){var s=this._getContext().measureText(t[r]);e[r]=s.width}for(this._getContext().restore(),r=0;r<e.length;r++)i<e[r]&&(i=e[r]);return i},getNormalHeight:function(){var t=this.str.split("\n").length,e=0;return t>0&&(e=t*this.size+(t-1)*this.lineSpacing),e},paint:function(t){t.save();var e=this.str.split("\n");this.lineSpacing=.25*this.size;var i=0;this.align==Text.ALIGN_LEFT?i=-this.getNormalWidth()/2:this.align==Text.ALIGN_RIGHT&&(i=this.getNormalWidth()/2);var r=.5*this.size,s=Util.getAngle(this.vector[0],this.vector[1]);if(DIAGRAMO.debug){t.beginPath(),t.moveTo(this.vector[0].x,this.vector[0].y),t.lineTo(this.vector[1].x,this.vector[1].y),t.closePath(),t.stroke();var n=this.getNormalBounds();n.transform(Matrix.translationMatrix(-this.vector[0].x,-this.vector[0].y)),n.transform(Matrix.rotationMatrix(s)),n.transform(Matrix.translationMatrix(this.vector[0].x,this.vector[0].y)),n.style.strokeStyle="rgb(250, 34, 35)",n.paint(t),t.save(),t.strokeStyle="rgb(30, 204, 35)";var o=n.getBounds();t.beginPath(),t.moveTo(o[0],o[1]),t.lineTo(o[2],o[1]),t.lineTo(o[2],o[3]),t.lineTo(o[0],o[3]),t.closePath(),t.stroke(),t.restore()}t.translate(this.vector[0].x,this.vector[0].y),t.rotate(s),t.translate(-this.vector[0].x,-this.vector[0].y),t.fillStyle=this.style.fillStyle,t.font=this.size+"px "+this.font,t.textAlign=this.align,t.textBaseline="middle";for(var a=0;a<e.length;a++){var h=this.vector[0].x+i,l=this.vector[0].y-this.getNormalHeight()/2+a*this.size+a*this.lineSpacing+r;t.fillText(e[a],h,l),this.underlined&&this.paintUnderline(t,e[a],h,l)}t.restore()},paintUnderline:function(t,e,i,r){var s=t.measureText(e).width;switch(this.align){case"center":i-=s/2;break;case"right":i-=s}r+=this.size/2,t.save(),t.beginPath(),t.strokeStyle=this.style.fillStyle,t.lineWidth=this.size/Text.UNDERLINE_THICKNESS_DIVIDER,t.moveTo(i,r),t.lineTo(i+s,r),t.stroke(),t.restore()},getBounds:function(){var t=Util.getAngle(this.vector[0],this.vector[1]),e=this.getNormalBounds();return e.transform(Matrix.translationMatrix(-this.vector[0].x,-this.vector[0].y)),e.transform(Matrix.rotationMatrix(t)),e.transform(Matrix.translationMatrix(this.vector[0].x,this.vector[0].y)),e.getBounds()},getNormalBounds:function(){this.str.split("\n");var t=new Polygon;return t.addPoint(new Point(this.vector[0].x-this.getNormalWidth()/2,this.vector[0].y-this.getNormalHeight()/2)),t.addPoint(new Point(this.vector[0].x+this.getNormalWidth()/2,this.vector[0].y-this.getNormalHeight()/2)),t.addPoint(new Point(this.vector[0].x+this.getNormalWidth()/2,this.vector[0].y+this.getNormalHeight()/2)),t.addPoint(new Point(this.vector[0].x-this.getNormalWidth()/2,this.vector[0].y+this.getNormalHeight()/2)),t},getPoints:function(){return[]},contains:function(t,e){var i=Util.getAngle(this.vector[0],this.vector[1]),r=this.getNormalBounds();return r.transform(Matrix.translationMatrix(-this.vector[0].x,-this.vector[0].y)),r.transform(Matrix.rotationMatrix(i)),r.transform(Matrix.translationMatrix(this.vector[0].x,this.vector[0].y)),r.contains(t,e,!0)},near:function(t,e,i){var r=Util.getAngle(this.vector[0],this.vector[1]),s=this.getNormalBounds();return s.transform(Matrix.translationMatrix(-this.vector[0].x,-this.vector[0].y)),s.transform(Matrix.rotationMatrix(r)),s.transform(Matrix.translationMatrix(this.vector[0].x,this.vector[0].y)),s.near(t,e,i)},equals:function(t){if(!t instanceof Text)return!1;if(this.str!=t.str||this.font!=t.font||this.size!=t.size||this.lineSpacing!=t.lineSpacing||this.size!=t.size)return!1;for(var e=0;e<this.vector.length;e++)if(!this.vector[e].equals(t.vector[e]))return!1;return!!this.style.equals(t.style)},clone:function(){var t=new Text(this.str,this.x,this.y,this.font,this.size,this.outsideCanvas);return t.align=this.align,t.vector=Point.cloneArray(this.vector),t.style=this.style.clone(),t.outsideCanvas||(t.bounds=this.bounds.clone()),t},toString:function(){return"Text: "+this.str+" x:"+this.vector[0].x+" y:"+this.vector[0].y},escapeString:function(t){var e=new String(t),i=[];i.push(["<","&lt;"]);for(var r=0;r<i.length;r++)e=e.replace(i[r][0],i[r][1]);return e},toSVG:function(){var t=180*this.getAngle()/Math.PI,e=this.getNormalHeight(),i=0,r="middle";this.align==Text.ALIGN_LEFT?(i=-this.getNormalWidth()/2,r="start"):this.align==Text.ALIGN_RIGHT&&(i=this.getNormalWidth()/2,r="end");var s="\n"+repeat("\t",INDENTATION)+'<text y="'+(this.vector[0].y-e/2)+'" ';s+=' transform="rotate('+t+" "+this.vector[0].x+" ,"+this.vector[0].y+')" ',s+=' font-family="'+this.font+'" ',s+=' font-size="'+this.size+'" ',null!=this.style.fillStyle&&(s+=' fill=" '+this.style.fillStyle+'" '),s+=' text-anchor="'+r+'" ',s+=">",INDENTATION++;for(var n=this.str.split("\n"),o=0;o<n.length;o++){var a=parseFloat(this.size);o>0&&(a+=parseFloat(this.lineSpacing)),s+="\n"+repeat("\t",INDENTATION)+'<tspan x="'+(this.vector[0].x+i)+'" dy="'+a+'">'+this.escapeString(n[o])+"</tspan>"}return INDENTATION--,s+="\n"+repeat("\t",INDENTATION)+"</text>",this.debug&&(s+="\n"+repeat("\t",INDENTATION)+'<circle cx="'+this.vector[0].x+'" cy="'+this.vector[0].y+'" r="3" style="stroke: #FF0000; fill: yellow;"  transform="rotate('+t+" "+this.vector[0].x+" ,"+this.vector[0].y+')" />',s+="\n"+repeat("\t",INDENTATION)+'<circle cx="'+this.vector[0].x+'" cy="'+(this.vector[0].y-e/2)+'" r="3" style="stroke: #FF0000; fill: green;"  transform="rotate('+t+" "+this.vector[0].x+" ,"+this.vector[0].y+')"  />'),s}};

// log.js
"use strict";var Log={LOG_LEVEL_NONE:0,LOG_LEVEL_DEBUG:1,LOG_LEVEL_INFO:2,LOG_LEVEL_ERROR:3,level:this.LOG_LEVEL_ERROR,debug:function(o){"undefined"!=typeof console&&this.level<=this.LOG_LEVEL_DEBUG&&"function"==typeof console.debug&&console.debug(o)},info:function(o){"undefined"!=typeof console&&this.level<=this.LOG_LEVEL_INFO&&console.info(o)},error:function(o){"undefined"!=typeof console&&this.level<=this.LOG_LEVEL_ERROR&&console.error(o)},group:function(o){this.level<=this.LOG_LEVEL_INFO&&"undefined"!=typeof console&&"function"==typeof console.group&&console.group(o)},groupEnd:function(){this.level<=this.LOG_LEVEL_INFO&&"undefined"!=typeof console&&"function"==typeof console.groupEnd&&console.groupEnd()}};Log.level=Log.LOG_LEVEL_ERROR;

// browserReady.js
"use strict";function isBrowserReady(){var e=!0;return e&=checkHTML5(),e&=checkEventSystem()}function checkHTML5(){var e,t,o=!0,r="";try{"getContext"in(e=document.createElement("canvas"))?(t=e.getContext("2d"),r="We have support for canvas\n"):(o=!1,r="No  HTML5 ( canvas.getContext() function missing) support\n")}catch(e){o=!1,r="No  HTML5 (<canvas> tag) support\n"}if(o){var a=["fill","arc","beginPath","moveTo","lineTo","stroke","bezierCurveTo","quadraticCurveTo","closePath","save","restore","translate","rotate","drawImage","strokeText","fillText","measureText"];for(var n in a)"function"!=typeof t[a[n]]&&(r=r+a[n]+" function missing\n",o=!1)}return o}function checkEventSystem(){var e=!0,t="",o=["addEventListener","removeEventListener"];for(var r in o)o[r]in window&&"function"==typeof window[o[r]]||(t=t+o[r]+" function missing\n",e=!1);return e}function modal(){$.modal('<div style="background-color: #EDEDED; border:1px dotted gray; padding: 5px;" >                    <h1>Browser problem</h1>                    <div>Your browser does not fully support HTML5</div>                    <div>Please use one of the following browsers for best experience</div>                    <ul>                         <li> <a href="http://www.mozilla.com/firefox/" target="_blank">Firefox</a></li>                         <li> <a href="www.google.com/chrome/" target="_blank">Chrome</a></li>                         <li> <a href="http://www.opera.com" target="_blank">Opera</a></li>                         <li> <a href="http://www.apple.com/safari" target="_blank">Safari</a></li>                     </ul>                    Press <span style="color:red;">Escape</span> to close this message</div>',{closeHTML:"Close"})}

// containers.js
"use strict";function Container(t,i,e){this.id=null==t?STACK.generateId():t,this.topLeft=i.clone(),this.bottomRight=e.clone(),this.primitives=[],this.properties=[],this.style=new Style,this.style.strokeStyle="#000000",this.style.fillStyle="#F9F8F6",this.style.lineStyle=Style.LINE_STYLE_CONTINOUS,this.style.gradientBounds=this.getBounds(),this.rotationCoords=[new Point((this.topLeft.x+this.bottomRight.x)/2,(this.topLeft.y+this.bottomRight.y)/2),new Point((this.topLeft.x+this.bottomRight.x)/2,this.topLeft.y)];var o=new Path,r=new Point(this.bottomRight.x,this.topLeft.y+20),n=10,s=new Line(new Point(this.topLeft.x,r.y),new Point(this.topLeft.x,this.topLeft.y+n));o.addPrimitive(s);var h=new QuadCurve(new Point(this.topLeft.x,this.topLeft.y+n),new Point(this.topLeft.x,this.topLeft.y),new Point(this.topLeft.x+n,this.topLeft.y));o.addPrimitive(h);var a=new Line(new Point(this.topLeft.x+n,this.topLeft.y),new Point(r.x-n,this.topLeft.y));o.addPrimitive(a);var p=new QuadCurve(new Point(r.x-n,this.topLeft.y),new Point(r.x,this.topLeft.y),new Point(r.x,this.topLeft.y+n));o.addPrimitive(p);var l=new Line(new Point(r.x,this.topLeft.y+n),new Point(r.x,r.y));o.addPrimitive(l);var u=new Line(new Point(this.topLeft.x,this.topLeft.y+20),new Point(this.bottomRight.x,this.topLeft.y+20));o.addPrimitive(u),u=new Line(new Point(this.bottomRight.x,this.topLeft.y+20),new Point(this.bottomRight.x,this.bottomRight.y-n)),o.addPrimitive(u);var d=new QuadCurve(new Point(this.bottomRight.x,this.bottomRight.y-n),new Point(this.bottomRight.x,this.bottomRight.y),new Point(this.bottomRight.x-n,this.bottomRight.y));o.addPrimitive(d),u=new Line(new Point(this.bottomRight.x-n,this.bottomRight.y),new Point(this.topLeft.x+n,this.bottomRight.y)),o.primitives.push(u),d=new QuadCurve(new Point(this.topLeft.x+n,this.bottomRight.y),new Point(this.topLeft.x,this.bottomRight.y),new Point(this.topLeft.x,this.bottomRight.y-n)),o.addPrimitive(d),u=new Line(new Point(this.topLeft.x,this.bottomRight.y-n),new Point(this.topLeft.x,this.topLeft.y+20)),o.primitives.push(u),this.addPrimitive(o),this.properties.push(new BuilderProperty("Stroke Style","style.strokeStyle",BuilderProperty.TYPE_COLOR)),this.properties.push(new BuilderProperty("Fill Style","style.fillStyle",BuilderProperty.TYPE_COLOR)),this.properties.push(new BuilderProperty("Line Width","style.lineWidth",BuilderProperty.TYPE_LINE_WIDTH)),this.properties.push(new BuilderProperty("Line Style","style.lineStyle",BuilderProperty.TYPE_LINE_STYLE));var f=new Text("Container",(this.topLeft.x+this.bottomRight.x)/2,this.topLeft.y+Text.DEFAULT_SIZE,Text.FONTS[0].Text,Text.DEFAULT_SIZE,!1);f.style.fillStyle="#000000",this.addPrimitive(f),this.properties.push(new BuilderProperty("Text","primitives.1.str",BuilderProperty.TYPE_TEXT)),this.properties.push(new BuilderProperty("Text Size","primitives.1.size",BuilderProperty.TYPE_TEXT_FONT_SIZE)),this.properties.push(new BuilderProperty("Font","primitives.1.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY)),this.properties.push(new BuilderProperty("Alignment","primitives.1.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT)),this.properties.push(new BuilderProperty("Text Underlined","primitives.1.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED)),this.properties.push(new BuilderProperty("Text Color","primitives.1.style.fillStyle",BuilderProperty.TYPE_COLOR)),this.oType="Container"}function ContainerFigure(t,i){this.containerId=t,this.figureId=i}function ContainerFigureManager(){this.data=[]}Container.loadArray=function(t){for(var i=[],e=t.length,o=0;o<e;o++)i.push(Container.load(t[o]));return i},Container.load=function(t){var i=Point.load(t.topLeft),e=Point.load(t.bottomRight),o=new Container(Number(t.id),i,e);o.primitives=[];for(var r=0;r<t.primitives.length;r++){var n=Util.loadPrimitive(t.primitives[r]);null!=n&&o.addPrimitive(n)}return o.style=Style.load(t.style),o.properties=BuilderProperty.loadArray(t.properties),o.rotationCoords=Point.loadArray(t.rotationCoords),o},Container.prototype={constructor:Container,paint:function(t){this.style&&this.style.setupContext(t);for(var i=0;i<this.primitives.length;i++){t.save();var e=this.primitives[i],o=null;e.style&&(o=e.style.clone()),null==e.style?e.style=this.style.clone():e.style.merge(this.style),e.paint(t),e.style=o,t.restore()}},transform:function(t){null!=this.style&&this.style.transform(t),this.bottomRight.transform(t),this.topLeft.transform(t);for(var i=0;i<this.primitives.length;i++)this.primitives[i].transform(t);0!=this.rotationCoords.length&&(this.rotationCoords[0].transform(t),this.rotationCoords[1].transform(t))},contains:function(t,i){var e=new Point(this.bottomRight.x,this.topLeft.y),o=new Point(this.topLeft.x,this.bottomRight.y);return Util.isPointInside(new Point(t,i),[this.topLeft,e,this.bottomRight,o])},equals:function(t){if(!(t instanceof Container))return Log.info("Container:equals() 0"),!1;if(this.primitives.length!=t.primitives.length)return Log.info("Container:equals() 2"),!1;for(var i=0;i<this.primitives.length;i++)if(!this.primitives[i].equals(t.primitives[i]))return Log.info("Container:equals() 1"),!1;if(this.rotationCoords.length!=t.rotationCoords.length)return!1;for(var i in this.rotationCoords)if(!this.rotationCoords[i].equals(t.rotationCoords[i]))return!1;return!!this.style.equals(t.style)},toString:function(){return"Container "+this.id+" topLeft: "+this.topLeft+" bottomRight:"+this.bottomRight},clone:function(){throw"container:clone() Not implemented"},getBounds:function(){return Util.getBounds([this.bottomRight,this.topLeft])},onEdge:function(t,i){var e=new Point(this.bottomRight.x,this.topLeft.y),o=new Point(this.topLeft.x,this.bottomRight.y),r=new Polygon;return r.points=[this.topLeft,e,this.bottomRight,o],r.near(t,i,3)},near:function(){throw"container:near() Not implemented"},getPoints:function(){throw"container:getPoints() Not implemented"},addPrimitive:function(t){t.id=this.primitives.length,this.primitives.push(t)}},ContainerFigure.prototype={constructor:ContainerFigure},ContainerFigureManager.prototype={constructor:ContainerFigure,addFigure:function(t,i){var e,o=!1;for(e in this.data)if(this.data[e][1]===i){o=!0;break}o||this.data.push([t,i])},removeFigure:function(t,i){var e,o,r=-1;for(e in this.data)if((o=this.data[e])[0]===t&&o[1]===i){r=e;break}-1!==r&&this.data.splice(r,1)},getAllFigures:function(t){var i,e=[];for(i in this.data){var o=this.data[i];o[0]===t&&e.push(o[1])}return e},isFigureInContainer:function(t,i){var e,o,r=!1;for(e in this.data)if((o=this.data[e])[0]===t&&o[1]===i){r=!0;break}return r},getContainerForFigure:function(t){var i,e,o=-1;for(i in this.data)if((e=this.data[i])[1]===t){o=e[0];break}return o},equals:function(t){if(!(t instanceof ContainerFigureManager))return Log.info("ContainerFigureManager:equals() 0"),!1;if(this.data.length!==t.data.length)return Log.info("ContainerFigureManager:equals() 2"),!1;for(var i=0;i<this.data.length;i++)if(this.data[i][0]!==t.data[i][0]||this.data[i][1]!==t.data[i][1])return Log.info("ContainerFigureManager:equals() 1"),!1;return!0}},ContainerFigureManager.load=function(t){var i=new ContainerFigureManager;i.data=[];for(var e=t.data.length,o=0;o<e;o++){var r=[Number(t.data[o][0]),Number(t.data[o][1])];i.data.push(r)}return i};

// importer.js
"use strict";var Importer={fileVersions:{1:"This version did not have any version number. \n        Originally used on Diagramo.com\n        File extension named .dia",2:"This version did not have any version number.\n        Originally used on version 2.3beta\n        ",3:"Started to be used beginning with version 2.3 final",4:"Started to be used beginning with version 2.4 final"},importDiagram:function(e){"v"in e||this.patch3(e);for(var r=e.v+1;r<=DIAGRAMO.fileVersion;r++)try{this["patch"+r](e)}catch(e){Log.error("Importer.importDiagram exception: "+e)}return e},patch3:function(e){if("s"in e){var r=e.s;if("containers"in r||(r.containers=[]),"figures"in r)for(var t="textSize",n=r.figures,i=n.length,o=0;o<i;o++)for(var l=(B=n[o].properties).length,s=0;s<l;s++)B[s].property&&-1!=B[s].property.indexOf(t)&&(B[s].property=B[s].property.replace(t,"size"))}if("p"in e||(e.p=new ContainerFigureManager),"m"in e){var d=e.m;if("connectors"in d){var a,p,u,y,c,f=new BuilderProperty("Line Style","style.lineStyle",BuilderProperty.TYPE_LINE_STYLE),v=new BuilderProperty("Text Size","middleText.size",BuilderProperty.TYPE_TEXT_FONT_SIZE),g=new BuilderProperty("Font","middleText.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY),T=new BuilderProperty("Alignment","middleText.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT),h=new BuilderProperty("Text Color","middleText.style.fillStyle",BuilderProperty.TYPE_COLOR),m=d.connectors,P=m.length;for(o=0;o<P;o++){m[o].middleText.style.fillStyle||(m[o].middleText.style.fillStyle=connector_defaultConnectorTextFillStyle),a=!1,p=!1,u=!1,y=!1,c=!1;var B;for(l=(B=m[o].properties).length,s=0;s<l;s++)f.equals(B[s])&&(a=!0),v.equals(B[s])&&(p=!0),g.equals(B[s])&&(u=!0),T.equals(B[s])&&(y=!0),h.equals(B[s])&&(c=!0);a||B.push(f),p||B.push(v),u||B.push(g),y||B.push(T),c||B.push(h)}}}return e.v=3,e},patch4:function(e){return e.v=4,function(e){if("s"in e){for(var r=e.s,t=0;t<r.containers.length;t++)for(var n=r.containers[t],i=n.primitives,o=0;o<i.length;o++)if("Text"===(d=i[o]).oType){d.underlined=!1;var l=new BuilderProperty("Text Underlined","primitives."+o+".underlined",BuilderProperty.TYPE_TEXT_UNDERLINED);n.properties.push(l)}for(t=0;t<r.figures.length;t++){var s=r.figures[t];for(i=s.primitives,o=0;o<i.length;o++){var d;"Text"===(d=i[o]).oType&&(d.underlined=!1,l=new BuilderProperty("Text Underlined","primitives."+o+".underlined",BuilderProperty.TYPE_TEXT_UNDERLINED),s.properties.push(l))}}}if("m"in e){var a=e.m;for(l=new BuilderProperty("Text Underlined","middleText.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED),t=0;t<a.connectors.length;t++){var p=a.connectors[t];p.middleText.underlined=!1,p.properties.push(l)}}}(e),function(e){if("s"in e){for(var r=e.s,t=0;t<r.containers.length;t++){var n=r.containers[t];n.style.gradientBounds=[],n.style.colorStops=[];for(var i=n.primitives,o=0;o<i.length;o++)(s=i[o]).style.gradientBounds=[],s.style.colorStops=[]}for(t=0;t<r.figures.length;t++){var l=r.figures[t];for(l.style.gradientBounds=[],l.style.colorStops=[],i=l.primitives,o=0;o<i.length;o++){var s;(s=i[o]).style.gradientBounds=[],s.style.colorStops=[];var d=s.points||s.vector;if(d)for(var a=0;a<d.length;a++){var p=d[a];p.style.gradientBounds=[],p.style.colorStops=[]}}var u=l.rotationCoords;for(o=0;o<u.length;o++){var y=u[o];y.style.gradientBounds=[],y.style.colorStops=[]}}}if("m"in e){var c=e.m;for(t=0;t<c.connectors.length;t++){var f=c.connectors[t];f.style.gradientBounds=[],f.style.colorStops=[];var v=f.turningPoints;for(o=0;o<v.length;o++){var g=v[o];g.style.gradientBounds=[],g.style.colorStops=[]}}for(t=0;t<c.connectionPoints.length;t++){var T=c.connectionPoints[t];T.point.style.gradientBounds=[],T.point.style.colorStops=[]}}}(e),e}};

// main.js
"use strict";var DIAGRAMO={debug:!1,debugSolutions:[],visualMagnet:!0,gradientFill:!1,CANVAS_FIT_PADDING:10,switchDebug:function(e){DIAGRAMO.debug=void 0==e?!DIAGRAMO.debug:e;var t=document.getElementById("iconDebug");DIAGRAMO.debug?t.src="./assets/images/icon_debug_true.gif":t.src="./assets/images/icon_debug_false.gif",draw()},fileVersion:4},doUndo=!0,currentMoveUndo=null,CONNECTOR_MANAGER=new ConnectorManager,CONTAINER_MANAGER=new ContainerFigureManager,currentCloud=[],GRIDWIDTH=30,SNAP_DISTANCE=5,gradientLightStep=.06,fillColor=null,strokeColor="#000000",currentText=null,Browser=new Browser,defaultEditorPadding=6,defaultEditorBorderWidth=1,scrollBarWidth=19,FIGURE_ESCAPE_DISTANCE=30,FIGURE_CLOUD_DISTANCE=4,createFigureFunction=null,CNTRL_PRESSED=!1,SHIFT_PRESSED=!1,connector=null,connectorType="",figureSets=[],INDENTATION=0;function toSVG(){return""}function stopselection(e){return"text"==e.target.className}var STACK=new Stack,mousePressed=!1,STATE_NONE="none",STATE_FIGURE_CREATE="figure_create",STATE_FIGURE_SELECTED="figure_selected",STATE_CONNECTOR_PICK_FIRST="connector_pick_first",STATE_CONNECTOR_PICK_SECOND="connector_pick_second",STATE_CONNECTOR_SELECTED="connector_selected",STATE_CONNECTOR_MOVE_POINT="connector_move_point",STATE_SELECTING_MULTIPLE="selecting_multiple",STATE_GROUP_SELECTED="group_selected",STATE_CONTAINER_SELECTED="container_selected",STATE_TEXT_EDITING="text_editing",state=STATE_NONE,selectionArea=new Polygon;selectionArea.points.push(new Point(0,0)),selectionArea.points.push(new Point(0,0)),selectionArea.points.push(new Point(0,0)),selectionArea.points.push(new Point(0,0)),selectionArea.style.strokeStyle="grey",selectionArea.style.gradientBounds=[],selectionArea.style.lineWidth="1";var gridVisible=!1,snapTo=!1,lastClick=[],defaultLineWidth=2,defaultThinLineWidth=1,currentTextEditor=null,selectedFigureId=-1,selectedFigureThumb=null,selectedGroupId=-1,selectedConnectorId=-1,selectedContainerId=-1,selectedConnectionPointId=-1,dragging=!1,insertedImageFileName=null,canvasProps=null,clipboardBuffer=[];function getCanvas(){return document.getElementById("a")}function getWorkAreaContainer(){return document.getElementById("container")}function getContext(){var e=getCanvas();if(e.getContext)return e.getContext("2d");alert("You need a HTML5 web browser. Any Safari,Firefox, Chrome or Explorer supports this.")}var currentSetId="basic";function setFigureSet(e){Log.info("main.js id = "+e);var t=document.getElementById(e);if(null!=t){if(null!=currentSetId)Log.info("main.js currentSetId = "+currentSetId),document.getElementById(currentSetId).style.display="none";t.style.display="block",currentSetId=e}}function updateShape(e,t,n,o,r){o=o||!1;var d=STACK.figureGetById(e);d||(d=CONNECTOR_MANAGER.connectorGetById(e)),d||(d=STACK.containerGetById(e));for(var a=d,s=t.split("."),i=0;i<s.length-1;i++)d=d[s[i]];var c=s[s.length-1],u="set"+Util.capitaliseFirstLetter(c),l="get"+Util.capitaliseFirstLetter(c);if(u in d){if(void 0!==r&&r!=d[l]||void 0===r&&n!=d[l]())(E=new ShapeChangePropertyCommand(e,t,n,r)).execute(),o||History.addUndo(E);d[u](n)}else{var E;if(void 0!==r&&d[c]!=r||void 0===r&&d[c]!=n)(E=new ShapeChangePropertyCommand(e,t,n,r)).execute(),o||History.addUndo(E),d[c]=n}a instanceof Connector&&"str"==c&&a.updateMiddleText(),draw()}function setUpEditPanel(e){var t=document.getElementById("edit");if(t.innerHTML="",null==e);else switch(e.oType){case"Group":break;case"Container":Builder.constructPropertiesPanel(t,e);break;case"CanvasProps":Builder.constructCanvasPropertiesPanel(t,e);break;default:Builder.constructPropertiesPanel(t,e)}}function setUpTextEditorPopup(e,t){var n=document.getElementById("text-editor"),o=document.getElementById("text-editor-tools");currentTextEditor=Builder.constructTextPropertiesPanel(n,o,e,t)}function createFigure(e,t){createFigureFunction=e,selectedFigureThumb=t,selectedFigureId=-1,selectedConnectorId=-1,selectedConnectionPointId=-1,state==STATE_TEXT_EDITING&&(currentTextEditor.destroy(),currentTextEditor=null),state=STATE_FIGURE_CREATE,draw()}function resetToNoneState(){(state==STATE_TEXT_EDITING&&(currentTextEditor.destroy(),currentTextEditor=null),selectedFigureId=-1,selectedConnectionPointId=-1,selectedConnectorId=-1,selectedContainerId=-1,state==STATE_GROUP_SELECTED)&&(STACK.groupGetById(selectedGroupId).permanent||STACK.groupDestroy(selectedGroupId),selectedGroupId=-1);state=STATE_NONE}var uploadImageErrorDivId="upload-image-error";function showInsertImageDialog(){resetToNoneState(),draw(),setUploadedImagesList();var e=document.getElementById("insert-image-dialog");$.modal(e,{minWidth:"380px",containerId:"upload-image-dialog",overlayClose:!0}),$.modal.setPosition(),document.getElementById(uploadImageErrorDivId).innerHTML=""}function setUploadedImagesList(){$.post("./common/controller.php",{action:"getUploadedImageFileNames"},function(e){var t=document.getElementById("insert-image-reuse"),n=document.getElementById("insert-image-reuse-group");if(null!=(e=JSON.parse(e))&&e.length){var o,r,d=e.length;for(o=0;o<d;o++)(r=document.createElement("option")).value=e[o],r.textContent=e[o],t.appendChild(r);t.disabled=!1,n.disabled=!1}else t.disabled=!0,n.disabled=!0})}function insertImage(e,t){t?(document.getElementById(uploadImageErrorDivId).innerHTML=t,$.modal.setPosition()):($.modal.close(),insertedImageFileName=e,action("insertImage"))}function snapToGrid(){Log.info("snapToGrid called;"),(snapTo=!snapTo)&&(gridVisible||(gridVisible=!0,backgroundImage=null,document.getElementById("gridCheckbox").checked=!0,draw()))}function showGrid(){gridVisible&&snapTo&&(snapTo=!1,document.getElementById("snapCheckbox").checked=!1),gridVisible=!gridVisible,backgroundImage=null,draw()}function onClick(e){var t=getCanvasXY(e);t[0],t[1]}function onDoubleClick(e){var t=getCanvasXY(e),n=(getCanvas(),t[0]),o=t[1];lastClick=[n,o],alert("Double click triggered")}function onMouseDown(e){var t=getCanvasXY(e),n=getCanvas(),o=t[0],r=t[1];switch(lastClick=[o,r],mousePressed=!0,state){case STATE_TEXT_EDITING:if(currentTextEditor.mouseClickedInside(e))break;(Browser.msie||Browser.mozilla)&&currentTextEditor.blurTextArea(),currentTextEditor.destroy(),currentTextEditor=null,state=STATE_NONE;case STATE_NONE:switch(snapMonitor=[0,0],(g=Util.getObjectByXY(o,r)).type){case"Connector":selectedConnectorId=g.id,state=STATE_CONNECTOR_SELECTED,setUpEditPanel(CONNECTOR_MANAGER.connectorGetById(selectedConnectorId)),Log.info("onMouseDown() + STATE_NONE  - change to STATE_CONNECTOR_SELECTED"),redraw=!0;break;case"Group":selectedGroupId=g.id,state=STATE_GROUP_SELECTED,setUpEditPanel(null),Log.info("onMouseDown() + STATE_NONE + group selected  =>  change to STATE_GROUP_SELECTED");break;case"Figure":selectedFigureId=g.id,state=STATE_FIGURE_SELECTED,setUpEditPanel(STACK.figureGetById(selectedFigureId)),Log.info("onMouseDown() + STATE_NONE + lonely figure => change to STATE_FIGURE_SELECTED"),redraw=!0;break;case"Container":selectedContainerId=g.id,state=STATE_CONTAINER_SELECTED,setUpEditPanel(STACK.containerGetById(selectedContainerId)),Log.info("onMouseDown() + STATE_NONE  - change to STATE_CONTAINER_SELECTED"),redraw=!0}break;case STATE_FIGURE_CREATE:throw"canvas> onMouseDown> STATE_FIGURE_CREATE> : this should not happen";case STATE_FIGURE_SELECTED:if(snapMonitor=[0,0],null!=HandleManager.handleGet(o,r))Log.info("onMouseDown() + STATE_FIGURE_SELECTED - handle selected"),HandleManager.handleSelectXY(o,r);else switch((g=Util.getObjectByXY(o,r)).type){case"Connector":state=STATE_CONNECTOR_SELECTED,selectedConnectorId=g.id,selectedFigureId=-1;var d=CONNECTOR_MANAGER.connectorGetById(selectedConnectorId);HandleManager.shapeSet(d),setUpEditPanel(d),Log.info("onMouseDown() + STATE_FIGURE_SELECTED  - change to STATE_CONNECTOR_SELECTED"),redraw=!0;break;case"Group":if(SHIFT_PRESSED){var a=[];-1!=selectedFigureId&&a.push(selectedFigureId);for(var s=STACK.figureGetByGroupId(g.id),i=0;i<s.length;i++)a.push(s[i].id);selectedGroupId=STACK.groupCreate(a),Log.info("onMouseDown() + STATE_FIGURE_SELECTED + SHIFT + another group => STATE_GROUP_SELECTED")}else selectedGroupId=g.id,Log.info("onMouseDown() + STATE_FIGURE_SELECTED + group figure => change to STATE_GROUP_SELECTED");selectedFigureId=-1,state=STATE_GROUP_SELECTED,setUpEditPanel(null),redraw=!0;break;case"Figure":if(SHIFT_PRESSED){a=[];-1!=selectedFigureId&&a.push(selectedFigureId),a.push(g.id),selectedFigureId=-1,selectedGroupId=STACK.groupCreate(a),state=STATE_GROUP_SELECTED,setUpEditPanel(null),Log.info("onMouseDown() + STATE_FIGURE_SELECTED + SHIFT  + min. 2 figures => STATE_GROUP_SELECTED")}else selectedFigureId=g.id,HandleManager.clear(),setUpEditPanel(STACK.figureGetById(selectedFigureId)),Log.info("onMouseDown() + STATE_FIGURE_SELECTED + single figure => change to STATE_FIGURE_SELECTED (different figure)");redraw=!0;break;case"Container":selectedFigureId=-1,selectedContainerId=g.id,state=STATE_CONTAINER_SELECTED,Log.info("onMouseDown() + STATE_FIGURE_SELECTED + single container  - change to STATE_CONTAINER_SELECTED"),setUpEditPanel(STACK.containerGetById(selectedContainerId)),redraw=!0;break;default:SHIFT_PRESSED||(selectedFigureId=-1,state=STATE_NONE,setUpEditPanel(canvasProps),Log.info("onMouseDown() + STATE_FIGURE_SELECTED  - change to STATE_NONE")),redraw=!0}break;case STATE_GROUP_SELECTED:var c=STACK.groupGetById(selectedGroupId);if(null!=HandleManager.handleGet(o,r))HandleManager.handleSelectXY(o,r),redraw=!0,Log.info("onMouseDown() + STATE_GROUP_SELECTED  + handle selected => STATE_GROUP_SELECTED");else switch((g=Util.getObjectByXY(o,r)).type){case"Connector":c.permanent||STACK.groupDestroy(selectedGroupId),selectedGroupId=-1,selectedConnectorId=g.id,state=STATE_CONNECTOR_SELECTED,redraw=!0,Log.info("onMouseDown() + STATE_GROUP_SELECTED  + handle selected => STATE_CONNECTOR_SELECTED");break;case"Group":if(g.id!=selectedGroupId){if(SHIFT_PRESSED){for(a=[],s=STACK.figureGetByGroupId(selectedGroupId),i=0;i<s.length;i++)a.push(s[i].id);s=STACK.figureGetByGroupId(g.id);for(i=0;i<s.length;i++)a.push(s[i].id);c.permanent||STACK.groupDestroy(selectedGroupId),selectedGroupId=STACK.groupCreate(a)}else c.permanent||STACK.groupDestroy(selectedGroupId),selectedGroupId=g.id;redraw=!0,Log.info("onMouseDown() + STATE_GROUP_SELECTED  + (different) group figure => STATE_GROUP_SELECTED")}break;case"Figure":if(SHIFT_PRESSED){for(a=[],s=STACK.figureGetByGroupId(selectedGroupId),i=0;i<s.length;i++)a.push(s[i].id);a.push(g.id),c.permanent||STACK.groupDestroy(selectedGroupId),selectedGroupId=STACK.groupCreate(a),Log.info("onMouseDown() + STATE_GROUP_SELECTED + SHIFT  + add lonely figure to other")}else c.permanent||STACK.groupDestroy(selectedGroupId),selectedGroupId=-1,state=STATE_FIGURE_SELECTED,selectedFigureId=g.id,Log.info("onMouseDown() + STATE_GROUP_SELECTED  + lonely figure => STATE_FIGURE_SELECTED"),setUpEditPanel(STACK.figureGetById(selectedFigureId)),redraw=!0;break;case"Container":c.permanent||STACK.groupDestroy(selectedGroupId),selectedGroupId=-1,state=STATE_CONTAINER_SELECTED,selectedContainerId=g.id,Log.info("onMouseDown() + STATE_GROUP_SELECTED  + container => STATE_CONTAINER_SELECTED"),setUpEditPanel(STACK.containerGetById(selectedContainerId)),redraw=!0;break;default:SHIFT_PRESSED||(c.permanent||STACK.groupDestroy(selectedGroupId),selectedGroupId=-1,state=STATE_NONE,setUpEditPanel(canvasProps),redraw=!0,Log.info("onMouseDown() + STATE_GROUP_SELECTED  + mouse on empty => STATE_NONE"))}break;case STATE_CONNECTOR_PICK_FIRST:connectorPickFirst(o,r,e);break;case STATE_CONNECTOR_PICK_SECOND:state=STATE_NONE;break;case STATE_CONNECTOR_SELECTED:var u,l=CONNECTOR_MANAGER.connectionPointGetAllByParent(selectedConnectorId),E=l[0],T=l[1];if(E.point.near(o,r,3)){Log.info("Picked the start point"),selectedConnectionPointId=E.id,state=STATE_CONNECTOR_MOVE_POINT,n.style.cursor="default";var _=new ConnectorAlterCommand(selectedConnectorId);History.addUndo(_),-1!==(u=CONNECTOR_MANAGER.connectionPointGetByXYRadius(o,r,FIGURE_CLOUD_DISTANCE,ConnectionPoint.TYPE_FIGURE,T))&&(currentCloud=[selectedConnectionPointId,u])}else if(T.point.near(o,r,3)){Log.info("Picked the end point"),selectedConnectionPointId=T.id,state=STATE_CONNECTOR_MOVE_POINT,n.style.cursor="default";_=new ConnectorAlterCommand(selectedConnectorId);History.addUndo(_),-1!==(u=CONNECTOR_MANAGER.connectionPointGetByXYRadius(o,r,FIGURE_CLOUD_DISTANCE,ConnectionPoint.TYPE_FIGURE,E))&&(currentCloud=[selectedConnectionPointId,u])}else if(null!=HandleManager.handleGet(o,r)){Log.info("onMouseDown() + STATE_CONNECTOR_SELECTED - handle selected"),HandleManager.handleSelectXY(o,r);_=new ConnectorAlterCommand(selectedConnectorId);History.addUndo(_)}else{switch((g=Util.getObjectByXY(o,r)).type){case"Connector":g.id!=selectedConnectorId&&(selectedConnectorId=g.id,setUpEditPanel(CONNECTOR_MANAGER.connectorGetById(selectedConnectorId)),redraw=!0);break;case"Group":selectedConnectorId=-1,selectedGroupId=g.id,state=STATE_GROUP_SELECTED,setUpEditPanel(null),redraw=!0;break;case"Figure":selectedConnectorId=-1,selectedFigureId=g.id,state=STATE_FIGURE_SELECTED,setUpEditPanel(STACK.figureGetById(selectedFigureId)),redraw=!0;break;case"Container":selectedConnectorId=-1,selectedContainerId=g.id,state=STATE_CONTAINER_SELECTED,setUpEditPanel(STACK.containerGetById(selectedContainerId)),redraw=!0;break;default:selectedConnectorId=-1,state=STATE_NONE,setUpEditPanel(canvasProps),redraw=!0}}break;case STATE_CONTAINER_SELECTED:var g;if(null!=HandleManager.handleGet(o,r))Log.info("onMouseDown() + STATE_CONTAINER_SELECTED - handle selected"),HandleManager.handleSelectXY(o,r);else switch((g=Util.getObjectByXY(o,r)).type){case"Connector":selectedContainerId=-1,selectedConnectorId=g.id,state=STATE_CONNECTOR_SELECTED,Log.info("onMouseDown() + STATE_CONTAINER_SELECTED  - change to STATE_CONNECTOR_SELECTED"),setUpEditPanel(CONNECTOR_MANAGER.connectorGetById(selectedConnectorId)),redraw=!0;break;case"Group":selectedContainerId=-1,selectedGroupId=g.id,state=STATE_GROUP_SELECTED,Log.info("onMouseDown() + STATE_CONTAINER_SELECTED + group selected  =>  change to STATE_GROUP_SELECTED"),setUpEditPanel(null),redraw=!0;break;case"Figure":selectedContainerId=-1,selectedFigureId=g.id,state=STATE_FIGURE_SELECTED,Log.info("onMouseDown() + STATE_CONTAINER_SELECTED + lonely figure => change to STATE_FIGURE_SELECTED"),setUpEditPanel(STACK.figureGetById(selectedFigureId)),redraw=!0;break;case"Container":g.id!=selectedContainerId&&(selectedContainerId=g.id,Log.info("onMouseDown() + STATE_NONE  - change to STATE_CONTAINER_SELECTED"),setUpEditPanel(STACK.containerGetById(selectedContainerId)),redraw=!0);break;default:selectedContainerId=-1,state=STATE_NONE,setUpEditPanel(canvasProps),HandleManager.clear(),Log.info("onMouseDown() + STATE_CONTAINER_SELECTED + click on nothing - change to STATE_NONE"),redraw=!0}}return draw(),!1}function onMouseUp(e){Log.info("main.js>onMouseUp()");var t=getCanvasXY(e);t[0],t[1];switch(lastClick=[],mousePressed=!0,UndoRedoCheckerFirstMovement=!0,state){case STATE_NONE:createFigureFunction=null,selectedFigureId=-1,selectedConnectionPointId=-1,selectedConnectorId=-1,null!=currentTextEditor&&(currentTextEditor.destroy(),currentTextEditor=null),state=STATE_NONE,setUpEditPanel(null),draw(),document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_disabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_enabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_disabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_enabled");break;case STATE_FIGURE_SELECTED:case STATE_CONTAINER_SELECTED:mousePressed=!1,HandleManager.handleSelectedIndex=-1,document.getElementById("buttonFront").classList.add("menubar_button_front_enabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_disabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_enabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_disabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_enabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_disabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_enabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_disabled");break;case STATE_GROUP_SELECTED:Log.info("onMouseUp() + STATE_GROUP_SELECTED ..."),mousePressed=!1,HandleManager.handleSelectedIndex=-1,document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_enabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_disabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_enabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_disabled");break;case STATE_SELECTING_MULTIPLE:Log.info("onMouseUp() + STATE_SELECTING_MULTIPLE => STATE_NONE"),Log.info("onMouseUp() selection area: "+selectionArea),state=STATE_NONE;for(var n=[],o=0;o<STACK.figures.length;o++)if(-1==STACK.figures[o].groupId){var r=STACK.figures[o].getPoints();0==r.length&&(r.push(new Point(STACK.figures[o].getBounds()[0],STACK.figures[o].getBounds()[1])),r.push(new Point(STACK.figures[o].getBounds()[2],STACK.figures[o].getBounds()[3])),r.push(new Point(STACK.figures[o].getBounds()[0],STACK.figures[o].getBounds()[3])),r.push(new Point(STACK.figures[o].getBounds()[2],STACK.figures[o].getBounds()[1])));for(var d=!1,a=0;a<r.length;a++)if(Util.isPointInside(r[a],selectionArea.getPoints())){n.push(STACK.figures[o].id),d=!0;break}d||(d=Util.polylineIntersectsRectangle(r,selectionArea.getBounds(),!0)),d&&n.push(STACK.figures[o].id)}if(-1!=selectedGroupId)STACK.groupGetById(selectedGroupId).permanent||STACK.groupDestroy(selectedGroupId);n.length>=4?(selectedGroupId=STACK.groupCreate(n),state=STATE_GROUP_SELECTED,setUpEditPanel(null),Log.info("onMouseUp() + STATE_SELECTING_MULTIPLE  + min. 2 figures => STATE_GROUP_SELECTED")):2==n.length&&(selectedFigureId=n[0],selectedGroupId=-1,state=STATE_FIGURE_SELECTED,Log.info("onMouseUp() + STATE_SELECTING_MULTIPLE  + 1 figure => STATE_FIGURE_SELECTED")),n.length>=4?(document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_enabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_disabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_enabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_disabled")):n.length>0&&n.length<3?(document.getElementById("buttonFront").classList.add("menubar_button_front_enabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_disabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_enabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_disabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_enabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_disabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_enabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_disabled")):(document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_disabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_enabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_disabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_enabled"));break;case STATE_CONNECTOR_PICK_SECOND:var s=new ConnectorCreateCommand(selectedConnectorId);History.addUndo(s),CONNECTOR_MANAGER.connectionPointsResetColor(),currentCloud=[],state=STATE_CONNECTOR_SELECTED,setUpEditPanel(CONNECTOR_MANAGER.connectorGetById(selectedConnectorId)),redraw=!0,document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_enabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_disabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_enabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_disabled");break;case STATE_CONNECTOR_MOVE_POINT:CONNECTOR_MANAGER.connectionPointsResetColor(),currentCloud=[],state=STATE_CONNECTOR_SELECTED,selectedConnectionPointId=-1,redraw=!0,document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_enabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_disabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_enabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_disabled");break;case STATE_CONNECTOR_SELECTED:document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_enabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_disabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_enabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_disabled")}currentMoveUndo=null,mousePressed=!1,draw()}var UndoRedoCheckerFirstMovement=!0,lastMove=null,snapMonitor=[0,0];function onMouseMove(e){var t=!1,n=getCanvasXY(e);if(null!=n){var o=n[0],r=n[1],d=getCanvas();switch(Log.debug("onMouseMoveCanvas: test if over a figure: "+o+","+r),state){case STATE_NONE:mousePressed?(state=STATE_SELECTING_MULTIPLE,selectionArea.points[0]=new Point(o,r),selectionArea.points[1]=new Point(o,r),selectionArea.points[2]=new Point(o,r),selectionArea.points[3]=new Point(o,r),Log.debug("onMouseMove() - STATE_NONE + mousePressed = STATE_SELECTING_MULTIPLE"),document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_disabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_enabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_disabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_enabled")):STACK.figureIsOver(o,r)?(d.style.cursor="move",Log.debug("onMouseMove() - STATE_NONE - mouse cursor = move (over figure)")):-1!=CONNECTOR_MANAGER.connectorGetByXY(o,r)?(d.style.cursor="move",Log.debug("onMouseMove() - STATE_NONE - mouse cursor = move (over connector)")):-1!=STACK.containerGetByXY(o,r)?(d.style.cursor="move",Log.debug("onMouseMove() - STATE_NONE - mouse cursor = move (over container)")):(d.style.cursor="default",Log.debug("onMouseMove() - STATE_NONE - mouse cursor = default"));break;case STATE_SELECTING_MULTIPLE:selectionArea.points[1].x=o,selectionArea.points[2].x=o,selectionArea.points[2].y=r,selectionArea.points[3].y=r,t=!0;break;case STATE_FIGURE_CREATE:createFigureFunction&&(d.style.cursor="crosshair");break;case STATE_FIGURE_SELECTED:if(mousePressed){if(1==UndoRedoCheckerFirstMovement&&(setUndo(!0),UndoRedoCheckerFirstMovement=!1),null!=lastMove)if(null!=(S=HandleManager.handleGetSelected()))d.style.cursor=S.getCursor(),S.action(lastMove,o,r),t=!0,Log.info("onMouseMove() - STATE_FIGURE_SELECTED + drag - mouse cursor = "+d.style.cursor);else if(SHIFT_PRESSED)state=STATE_SELECTING_MULTIPLE,selectionArea.points[0]=new Point(o,r),selectionArea.points[1]=new Point(o,r),selectionArea.points[2]=new Point(o,r),selectionArea.points[3]=new Point(o,r),t=!0,Log.info("onMouseMove() - STATE_GROUP_SELECTED + mousePressed + SHIFT => STATE_SELECTING_MULTIPLE");else{d.style.cursor="move";var a=generateMoveMatrix(STACK.figureGetById(selectedFigureId),o,r);Log.info("onMouseMove() + STATE_FIGURE_SELECTED : translation matrix"+a);var s=new FigureTranslateCommand(selectedFigureId,a);History.addUndo(s),s.execute();var i=STACK.figureGetById(selectedFigureId).getBounds(),c=CONTAINER_MANAGER.getContainerForFigure(selectedFigureId);if(-1!==c){var u=STACK.containerGetById(c).getBounds();Util.areBoundsInBounds(i,u)||CONTAINER_MANAGER.removeFigure(c,selectedFigureId)}else{for(var l=-1,E=0;E<STACK.containers.length;E++){var T=STACK.containers[E];if(Util.areBoundsInBounds(i,T.getBounds())){l=STACK.containers[E].id;break}}-1!==l&&CONTAINER_MANAGER.addFigure(l,selectedFigureId)}t=!0,Log.info("onMouseMove() + STATE_FIGURE_SELECTED + drag - move selected figure")}}else if(null!=(S=HandleManager.handleGet(o,r)))d.style.cursor=S.getCursor(),Log.info("onMouseMove() - STATE_FIGURE_SELECTED + over a Handler = change cursor to: "+d.style.cursor);else-1!=STACK.figureGetByXY(o,r)?(d.style.cursor="move",Log.info("onMouseMove() + STATE_FIGURE_SELECTED + over a figure = change cursor")):(d.style.cursor="default",Log.info("onMouseMove() + STATE_FIGURE_SELECTED + over nothin = change cursor to default"));break;case STATE_TEXT_EDITING:if(mousePressed)throw"main:onMouseMove() - this should never happen";null!=(S=HandleManager.handleGet(o,r))?(d.style.cursor=S.getCursor(),Log.info("onMouseMove() - STATE_TEXT_EDITING + over a Handler = change cursor to: "+d.style.cursor)):-1!=STACK.figureGetByXY(o,r)?(d.style.cursor="move",Log.info("onMouseMove() + STATE_TEXT_EDITING + over a figure = change cursor")):(d.style.cursor="default",Log.info("onMouseMove() + STATE_TEXT_EDITING + over nothin = change cursor to default"));break;case STATE_CONTAINER_SELECTED:if(mousePressed){if(1==UndoRedoCheckerFirstMovement&&(setUndo(!0),UndoRedoCheckerFirstMovement=!1),null!=lastMove)if(null!=(S=HandleManager.handleGetSelected()))d.style.cursor=S.getCursor(),S.action(lastMove,o,r),t=!0,Log.info("onMouseMove() - STATE_CONTAINER_SELECTED + drag - mouse cursor = "+d.style.cursor);else{d.style.cursor="move";a=generateMoveMatrix(STACK.containerGetById(selectedContainerId),o,r);Log.info("onMouseMove() + STATE_CONTAINER_SELECTED : translation matrix"+a);var _=new ContainerTranslateCommand(selectedContainerId,a);History.addUndo(_),_.execute(),t=!0,Log.info("onMouseMove() + STATE_CONTAINER_SELECTED + drag - move selected container")}}else null!=(S=HandleManager.handleGet(o,r))?(d.style.cursor=S.getCursor(),Log.info("onMouseMove() - STATE_CONTAINER_SELECTED + over a Handler = change cursor to: "+d.style.cursor)):-1!==STACK.containerGetByXY(o,r)?(d.style.cursor="move",Log.info("onMouseMove() + STATE_CONTAINER_SELECTED + over a container's edge = change cursor")):(d.style.cursor="default",Log.debug("onMouseMove() + STATE_CONTAINER_SELECTED + over nothing = change cursor to default"));break;case STATE_GROUP_SELECTED:if(mousePressed){if(1==UndoRedoCheckerFirstMovement&&(setUndo(!0),UndoRedoCheckerFirstMovement=!1),null!=lastMove)if(null!=(S=HandleManager.handleGetSelected()))Log.info("onMouseMove() - STATE_GROUP_SELECTED + mouse pressed  + over a Handle"),d.style.cursor=S.getCursor(),S.action(lastMove,o,r),t=!0;else if(SHIFT_PRESSED)state=STATE_SELECTING_MULTIPLE,selectionArea.points[0]=new Point(o,r),selectionArea.points[1]=new Point(o,r),selectionArea.points[2]=new Point(o,r),selectionArea.points[3]=new Point(o,r),t=!0,Log.info("onMouseMove() - STATE_GROUP_SELECTED + mousePressed + SHIFT => STATE_SELECTING_MULTIPLE");else{Log.info("onMouseMove() - STATE_GROUP_SELECTED + mouse pressed + NOT over a Handle"),d.style.cursor="move";var g=generateMoveMatrix(STACK.groupGetById(selectedGroupId),o,r),C=new GroupTranslateCommand(selectedGroupId,g);C.execute(),History.addUndo(C),t=!0}}else Log.debug("onMouseMove() - STATE_GROUP_SELECTED + mouse NOT pressed"),null!=HandleManager.handleGet(o,r)?d.style.cursor=HandleManager.handleGet(o,r).getCursor():-1!=CONNECTOR_MANAGER.connectorGetByXY(o,r)||(STACK.figureIsOver(o,r)?d.style.cursor="move":d.style.cursor="default");break;case STATE_CONNECTOR_PICK_FIRST:var m=CONNECTOR_MANAGER.connectionPointGetByXY(o,r,ConnectionPoint.TYPE_FIGURE);if(-1!=m)CONNECTOR_MANAGER.connectionPointGetById(m).color=ConnectionPoint.OVER_COLOR,selectedConnectionPointId=m;else if(-1!=selectedConnectionPointId)CONNECTOR_MANAGER.connectionPointGetById(selectedConnectionPointId).color=ConnectionPoint.NORMAL_COLOR,selectedConnectionPointId=-1;t=!0;break;case STATE_CONNECTOR_PICK_SECOND:connectorPickSecond(o,r,e),t=!0;break;case STATE_CONNECTOR_SELECTED:var b=CONNECTOR_MANAGER.connectionPointGetAllByParent(selectedConnectorId),I=b[0],A=b[1];if(I.point.near(o,r,3)||A.point.near(o,r,3)?d.style.cursor="move":null!=HandleManager.handleGet(o,r)?d.style.cursor=HandleManager.handleGet(o,r).getCursor():d.style.cursor="default",1==mousePressed&&null!=lastMove&&null!=HandleManager.handleGetSelected()){Log.info("onMouseMove() + STATE_CONNECTOR_SELECTED - trigger a handler action");for(var S=HandleManager.handleGetSelected(),p=CONNECTOR_MANAGER.connectorGetById(selectedConnectorId).turningPoints,N=[p.length],y=0;y<p.length;y++)N[y]=p[y].clone();S.action(lastMove,o,r);var f=[(p=CONNECTOR_MANAGER.connectorGetById(selectedConnectorId).turningPoints).length];for(y=0;y<p.length;y++)f[y]=p[y].clone();for(var R=0;R<f.length;R++)f[R].equals(N[R])||!0;t=!0}break;case STATE_CONNECTOR_MOVE_POINT:Log.info("Easy easy easy....it's fragile"),mousePressed&&(1==UndoRedoCheckerFirstMovement&&(setUndo(!0),UndoRedoCheckerFirstMovement=!1),connectorMovePoint(selectedConnectionPointId,o,r,e),t=!0)}return lastMove=[o,r],t&&draw(),!1}Log.error("main.js onMouseMove() null coordinates")}function onDblClick(e){var t=getCanvasXY(e),n=t[0],o=t[1];lastClick=[n,o];var r=null,d=-1,a=CONNECTOR_MANAGER.connectorGetByXY(n,o);if(-1!=a)r=CONNECTOR_MANAGER.connectorGetById(a),d=0;else if(-1!=(a=CONNECTOR_MANAGER.connectorGetByTextXY(n,o)))r=CONNECTOR_MANAGER.connectorGetById(a),d=0;else{var s=STACK.figureGetByXY(n,o);if(-1!=s){var i=STACK.figureGetById(s);-1!==(u=STACK.textGetByFigureXY(s,n,o))&&(r=i,d=u)}else{var c=STACK.containerGetByXY(n,o);if(-1!==c){var u,l=STACK.containerGetById(c);-1!==(u=STACK.textGetByContainerXY(c,n,o))&&(r=l,d=u)}}}if(-1!=d){if(state==STATE_GROUP_SELECTED)STACK.groupGetById(selectedGroupId).permanent||STACK.groupDestroy(selectedGroupId),selectedGroupId=-1;selectedFigureId=-1,selectedContainerId=-1,selectedConnectorId=-1,state=STATE_TEXT_EDITING,setUpTextEditorPopup(r,d),redraw=!0}return draw(),!1}function connectorPickFirst(e,t,n){Log.group("connectorPickFirst");var o=CONNECTOR_MANAGER.connectorCreate(new Point(e,t),new Point(e+10,t+10),connectorType);selectedConnectorId=o;var r=CONNECTOR_MANAGER.connectorGetById(o),d=CONNECTOR_MANAGER.connectionPointGetAllByParent(o),a=CONNECTOR_MANAGER.connectionPointGetByXY(e,t,ConnectionPoint.TYPE_FIGURE);if(-1!=a){var s=CONNECTOR_MANAGER.connectionPointGetById(a);d[0].point.x=s.point.x,d[0].point.y=s.point.y,r.turningPoints[0].x=s.point.x,r.turningPoints[0].y=s.point.y;var i=CONNECTOR_MANAGER.glueCreate(s.id,d[0].id,!1);Log.info("First glue created : "+i)}else{}state=STATE_CONNECTOR_PICK_SECOND,Log.groupEnd()}function connectorPickSecond(e,t,n){Log.group("main: connectorPickSecond");var o=CONNECTOR_MANAGER.connectorGetById(selectedConnectorId),r=CONNECTOR_MANAGER.connectionPointGetAllByParent(o.id),d=CONNECTOR_MANAGER.connectionPointGetByXY(e,t,ConnectionPoint.TYPE_FIGURE),a=o.turningPoints[0].clone(),s=CONNECTOR_MANAGER.glueGetBySecondConnectionPointId(r[0].id),i=STACK.figureGetAsFirstFigureForConnector(o.id);i?Log.info(":) WE HAVE A START FIGURE id = "+i.id):Log.info(":( WE DO NOT HAVE A START FIGURE");var c=new Point(e,t),u=null;if(-1!=d){var l=CONNECTOR_MANAGER.connectionPointGetById(d);Log.info("End Figure's ConnectionPoint present id = "+d),c=l.point.clone(),u=STACK.figureGetById(l.parentId),Log.info(":) WE HAVE AN END FIGURE id = "+u.id)}else Log.info(":( WE DO NOT HAVE AN END FIGURE ");var E=i?i.getBounds():null,T=u?u.getBounds():null,_=s.length>0&&s[0].automatic,g=CONNECTOR_MANAGER.getClosestPointsOfConnection(_,!1,i?i.id:-1,a,u?u.id:-1,c);DIAGRAMO.debugSolutions=CONNECTOR_MANAGER.connector2Points(o.type,g[0],g[1],E,T),r[1].color=-1!=d?ConnectionPoint.OVER_COLOR:ConnectionPoint.NORMAL_COLOR;var C=CONNECTOR_MANAGER.connectionPointGetFirstForConnector(selectedConnectorId),m=CONNECTOR_MANAGER.connectionPointGetSecondForConnector(selectedConnectorId);Log.info("connectorPickSecond() -> Solution: "+DIAGRAMO.debugSolutions[0][2]),o.turningPoints=Point.cloneArray(DIAGRAMO.debugSolutions[0][2]),C.point=o.turningPoints[0].clone(),m.point=o.turningPoints[o.turningPoints.length-1].clone(),o.updateMiddleText(),currentCloud=[],CONNECTOR_MANAGER.glueRemoveAllBySecondId(m.id),-1!=d?CONNECTOR_MANAGER.glueCreate(d,CONNECTOR_MANAGER.connectionPointGetSecondForConnector(selectedConnectorId).id,!1):-1!==(d=CONNECTOR_MANAGER.connectionPointGetByXYRadius(e,t,FIGURE_CLOUD_DISTANCE,ConnectionPoint.TYPE_FIGURE,C))&&(currentCloud=[d,m.id]),Log.groupEnd()}function connectorMovePoint(e,t,n,o){Log.group("main: connectorMovePoint");var r=CONNECTOR_MANAGER.connectorGetById(selectedConnectorId),d=CONNECTOR_MANAGER.connectionPointGetAllByParent(r.id),a=CONNECTOR_MANAGER.connectionPointGetByXY(t,n,ConnectionPoint.TYPE_FIGURE);r.updateMiddleText(),-1!=a?d[0].id==selectedConnectionPointId?d[0].color=ConnectionPoint.OVER_COLOR:d[1].color=ConnectionPoint.OVER_COLOR:d[0].id==selectedConnectionPointId?d[0].color=ConnectionPoint.NORMAL_COLOR:d[1].color=ConnectionPoint.NORMAL_COLOR;var s=r.turningPoints[0].clone(),i=null,c=r.turningPoints[r.turningPoints.length-1].clone(),u=null,l=CONNECTOR_MANAGER.glueGetBySecondConnectionPointId(d[0].id),E=CONNECTOR_MANAGER.glueGetBySecondConnectionPointId(d[1].id);if(currentCloud=[],d[0].id==e){if(-1!=a)s=(A=CONNECTOR_MANAGER.connectionPointGetById(a)).point.clone(),i=STACK.figureGetById(A.parentId);else s=new Point(t,n);u=STACK.figureGetAsSecondFigureForConnector(r.id);var T=i?i.getBounds():null,_=u?u.getBounds():null,g=E.length&&E[0].automatic,C=!1,m=CONNECTOR_MANAGER.getClosestPointsOfConnection(C,g,i?i.id:-1,s,u?u.id:-1,c);DIAGRAMO.debugSolutions=CONNECTOR_MANAGER.connector2Points(r.type,m[0],m[1],T,_);var b=CONNECTOR_MANAGER.connectionPointGetFirstForConnector(selectedConnectorId),I=CONNECTOR_MANAGER.connectionPointGetSecondForConnector(selectedConnectorId);Log.info("connectorMovePoint() -> Solution: "+DIAGRAMO.debugSolutions[0][2]),r.turningPoints=Point.cloneArray(DIAGRAMO.debugSolutions[0][2]),b.point=r.turningPoints[0].clone(),I.point=r.turningPoints[r.turningPoints.length-1].clone(),CONNECTOR_MANAGER.glueRemoveAllBySecondId(b.id),-1!=a?CONNECTOR_MANAGER.glueCreate(a,b.id,!1):-1!==(a=CONNECTOR_MANAGER.connectionPointGetByXYRadius(t,n,FIGURE_CLOUD_DISTANCE,ConnectionPoint.TYPE_FIGURE,I))&&(currentCloud=[a,b.id])}else{if(d[1].id!=e)throw"main:connectorMovePoint() - this should never happen";var A;-1!=a?(c=(A=CONNECTOR_MANAGER.connectionPointGetById(a)).point.clone(),u=STACK.figureGetById(A.parentId)):c=new Point(t,n);T=(i=STACK.figureGetAsFirstFigureForConnector(r.id))?i.getBounds():null,_=u?u.getBounds():null,C=l.length&&l[0].automatic,g=!1,m=CONNECTOR_MANAGER.getClosestPointsOfConnection(C,g,i?i.id:-1,s,u?u.id:-1,c);DIAGRAMO.debugSolutions=CONNECTOR_MANAGER.connector2Points(r.type,m[0],m[1],T,_);b=CONNECTOR_MANAGER.connectionPointGetFirstForConnector(selectedConnectorId),I=CONNECTOR_MANAGER.connectionPointGetSecondForConnector(selectedConnectorId);Log.info("connectorMovePoint() -> Solution: "+DIAGRAMO.debugSolutions[0][2]),r.turningPoints=Point.cloneArray(DIAGRAMO.debugSolutions[0][2]),b.point=r.turningPoints[0].clone(),I.point=r.turningPoints[r.turningPoints.length-1].clone(),CONNECTOR_MANAGER.glueRemoveAllBySecondId(I.id),-1!=a?CONNECTOR_MANAGER.glueCreate(a,I.id,!1):-1!==(a=CONNECTOR_MANAGER.connectionPointGetByXYRadius(t,n,FIGURE_CLOUD_DISTANCE,ConnectionPoint.TYPE_FIGURE,b))&&(currentCloud=[a,I.id])}Log.groupEnd()}function generateMoveMatrix(e,t,n){if(void 0===t)throw"Exception in generateMoveMatrix, x is undefined";if(void 0===n)throw"Exception in generateMoveMatrix,  is undefined";Log.info("main.js --\x3e generateMoveMatrix x:"+t+" y:"+n+" lastMove=["+lastMove+"]");var o=t-lastMove[0],r=n-lastMove[1],d=null;if(snapTo){d=[[1,0,0],[0,1,0],[0,0,1]],snapMonitor[0]+=o,snapMonitor[1]+=r;var a=GRIDWIDTH/2;if(0!=o){var s=(Math.floor((e.getBounds()[0]+snapMonitor[0])/a)+1)*a,i=s-e.getBounds()[0],c=(Math.floor((e.getBounds()[2]+snapMonitor[0])/a)+1)*a,u=c-e.getBounds()[2];i<u?e.getBounds()[0]+snapMonitor[0]>=s-SNAP_DISTANCE?(d[0][2]=i,snapMonitor[0]-=i):e.getBounds()[2]+snapMonitor[0]>=c-SNAP_DISTANCE&&(d[0][2]=u,snapMonitor[0]-=u):e.getBounds()[2]+snapMonitor[0]>=c-SNAP_DISTANCE?(d[0][2]=u,snapMonitor[0]-=u):e.getBounds()[0]+snapMonitor[0]>=s-SNAP_DISTANCE&&(d[0][2]=i,snapMonitor[0]-=i)}if(0!=r){var l=(Math.floor((e.getBounds()[1]+snapMonitor[1])/a)+1)*a,E=l-e.getBounds()[1],T=(Math.floor((e.getBounds()[3]+snapMonitor[1])/a)+1)*a,_=T-e.getBounds()[3];E<_?e.getBounds()[1]+snapMonitor[1]>=l-SNAP_DISTANCE?(d[1][2]=E,snapMonitor[1]-=E):e.getBounds()[3]+snapMonitor[1]>=T-SNAP_DISTANCE&&(d[1][2]=_,snapMonitor[1]-=_):e.getBounds()[3]+snapMonitor[1]>=T-SNAP_DISTANCE?(d[1][2]=_,snapMonitor[1]-=_):e.getBounds()[1]+snapMonitor[1]>=l-SNAP_DISTANCE&&(d[1][2]=E,snapMonitor[1]-=E)}}else d=[[1,0,o],[0,1,r],[0,0,1]];return Log.groupEnd(),d}function getCanvasBounds(){var e=$("#a").offset().left,t=e+$("#a").width(),n=$("#a").offset().top;return[e,n,t,n+$("#a").height()]}function getBodyXY(e){return[e.pageX,e.pageY]}function getCanvasXY(e){var t=null,n=getCanvasBounds();Log.debug("Canvas bounds: ["+n+"]");var o=null,r=null;return e.touches?e.touches.length>0&&(o=e.touches[0].pageX,r=e.touches[0].pageY):(o=e.pageX,r=e.pageY,Log.debug("ev.pageX:"+e.pageX+" ev.pageY:"+e.pageY)),n[0]<=o&&o<=n[2]&&n[1]<=r&&r<=n[3]&&(t=[o-$("#a").offset().left,r-$("#a").offset().top]),t}var backgroundImage=null,minimap;function addBackground(e){Log.info("addBackground: called");var t=e.getContext("2d");if(backgroundImage)t.drawImage(backgroundImage,0,0);else{if(t.rect(0,0,e.width,e.height),t.fillStyle=canvasProps.getFillColor(),t.fill(),gridVisible)for(var n=Math.floor(e.width/GRIDWIDTH)+1,o=Math.floor(e.height/GRIDWIDTH)+1,r=0;r<o;r++)for(var d=0;d<n;d++)t.beginPath(),t.strokeStyle="#C0C0C0",t.moveTo(d*GRIDWIDTH-2,r*GRIDWIDTH),t.lineTo(d*GRIDWIDTH+2,r*GRIDWIDTH),t.moveTo(d*GRIDWIDTH,r*GRIDWIDTH-2),t.lineTo(d*GRIDWIDTH,r*GRIDWIDTH+2),t.moveTo(d*GRIDWIDTH+GRIDWIDTH/2-1,r*GRIDWIDTH+GRIDWIDTH/2),t.lineTo(d*GRIDWIDTH+GRIDWIDTH/2+1,r*GRIDWIDTH+GRIDWIDTH/2),t.stroke();(backgroundImage=new Image).src=e.toDataURL()}}function reset(e){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.fillStyle="#FFFFFF",t.fillRect(0,0,e.width,e.height)}function draw(){var e=getContext();reset(getCanvas()),addBackground(getCanvas()),STACK.paint(e),minimap.updateMinimap()}function renderedCanvas(){var e=getCanvas(),t=document.getElementById("tempCanvas");return null===t&&((t=document.createElement("canvas")).setAttribute("id","tempCanvas"),t.style.display="none"),t.setAttribute("width",e.width),t.setAttribute("height",e.height),reset(t),addBackground(t),STACK.paint(t.getContext("2d"),!0),t.toDataURL()}function linkMap(){var e="",t=!0;for(f in STACK.figures){var n=STACK.figures[f];if(""!=n.url){var o=n.getBounds();t?t=!1:e+="\n",e+=o[0]+","+o[1]+","+o[2]+","+o[3]+","+n.url}}return Log.info("editor.php->linkMap()->csv bounds: "+e),e}function save(){var e={c:canvasProps,s:STACK,m:CONNECTOR_MANAGER,p:CONTAINER_MANAGER,v:DIAGRAMO.fileVersion},t=JSON.stringify(e);saveString(t,"Diagram.dgm")}function newDiagramFile(){try{var tempDiagramData='{"c":{"width":1920,"height":1080,"fillColor":"#ffffff","id":"canvasProps","oType":"CanvasProps"},"s":{"figures":[],"groups":[],"containers":[],"currentId":0,"idToIndex":[],"oType":"Stack"},"m":{"connectors":[],"connectionPoints":[],"connectionPointCurrentId":0,"glues":[]},"p":{"data":[]},"v":4}',obj=eval("("+tempDiagramData+")");"v"in obj&&obj.v==DIAGRAMO.fileVersion||Importer.importDiagram(obj),STACK=Stack.load(obj.s),canvasProps=CanvasProps.load(obj.c),canvasProps.sync(),CONNECTOR_MANAGER=ConnectorManager.load(obj.m),CONTAINER_MANAGER=ContainerFigureManager.load(obj.p),createFigureFunction=null,selectedFigureId=-1,selectedConnectionPointId=-1,selectedConnectorId=-1,null!=currentTextEditor&&(currentTextEditor.destroy(),currentTextEditor=null),state=STATE_NONE,setUpEditPanel(null),draw();var myDiv=document.getElementById("container");myDiv.scrollTop=0,myDiv.scrollLeft=0,document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_disabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_enabled"),document.getElementById("buttonUndo").classList.add("menubar_button_undo_disabled"),document.getElementById("buttonUndo").classList.remove("menubar_button_undo_enabled"),document.getElementById("buttonRedo").classList.add("menubar_button_redo_disabled"),document.getElementById("buttonRedo").classList.remove("menubar_button_redo_enabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_disabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_enabled"),sceneUndo01=-1,sceneUndo02=-1,sceneUndo03=-1,sceneUndo04=-1,sceneUndo05=-1,sceneUndo06=-1,sceneUndo07=-1,sceneUndo08=-1,sceneUndo09=-1,sceneUndo10=-1,sceneRedo01=-1,sceneRedo02=-1,sceneRedo03=-1,sceneRedo04=-1,sceneRedo05=-1,sceneRedo06=-1,sceneRedo07=-1,sceneRedo08=-1,sceneRedo09=-1,sceneRedo10=-1,History.clear()}catch(e){alert("main.js:load() Exception: "+e)}}function loadDiagramFile(tempDiagramData,UndoRedoChecker){try{var obj=eval("("+tempDiagramData+")");if("v"in obj&&obj.v==DIAGRAMO.fileVersion||Importer.importDiagram(obj),STACK=Stack.load(obj.s),canvasProps=CanvasProps.load(obj.c),canvasProps.sync(),CONNECTOR_MANAGER=ConnectorManager.load(obj.m),CONTAINER_MANAGER=ContainerFigureManager.load(obj.p),createFigureFunction=null,selectedFigureId=-1,selectedConnectionPointId=-1,selectedConnectorId=-1,null!=currentTextEditor&&(currentTextEditor.destroy(),currentTextEditor=null),state=STATE_NONE,setUpEditPanel(null),draw(),1==UndoRedoChecker){var myDiv=document.getElementById("container");myDiv.scrollTop=0,myDiv.scrollLeft=0}document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_disabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_enabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_disabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_enabled"),1==UndoRedoChecker&&(document.getElementById("buttonUndo").classList.add("menubar_button_undo_disabled"),document.getElementById("buttonUndo").classList.remove("menubar_button_undo_enabled"),document.getElementById("buttonRedo").classList.add("menubar_button_redo_disabled"),document.getElementById("buttonRedo").classList.remove("menubar_button_redo_enabled"),sceneUndo01=-1,sceneUndo02=-1,sceneUndo03=-1,sceneUndo04=-1,sceneUndo05=-1,sceneUndo06=-1,sceneUndo07=-1,sceneUndo08=-1,sceneUndo09=-1,sceneUndo10=-1,sceneRedo01=-1,sceneRedo02=-1,sceneRedo03=-1,sceneRedo04=-1,sceneRedo05=-1,sceneRedo06=-1,sceneRedo07=-1,sceneRedo08=-1,sceneRedo09=-1,sceneRedo10=-1),History.clear()}catch(e){alert("main.js:load() Exception: "+e)}}function deleteObject(){switch(state){case STATE_FIGURE_SELECTED:if(-1!=selectedFigureId)if(1==confirm(STRING_DELETE_WARNING)){setUndo(!0);var e=new FigureDeleteCommand(selectedFigureId);e.execute(),History.addUndo(e),document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_disabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_enabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_disabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_enabled")}break;case STATE_GROUP_SELECTED:if(-1!=selectedGroupId)if(1==confirm(STRING_DELETE_WARNING)){setUndo(!0);var t=new GroupDeleteCommand(selectedGroupId);t.execute(),History.addUndo(t),document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_disabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_enabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_disabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_enabled")}break;case STATE_CONNECTOR_SELECTED:if(Log.group("Delete connector"),-1!=selectedConnectorId)if(1==confirm(STRING_DELETE_WARNING)){setUndo(!0);var n=new ConnectorDeleteCommand(selectedConnectorId);n.execute(),History.addUndo(n),document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_disabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_enabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_disabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_enabled")}Log.groupEnd();break;case STATE_CONTAINER_SELECTED:if(Log.group("Delete container"),-1!=selectedContainerId)if(1==confirm(STRING_DELETE_WARNING)){setUndo(!0);var o=new ContainerDeleteCommand(selectedContainerId);o.execute(),History.addUndo(o),document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_disabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_enabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_disabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_enabled")}Log.groupEnd()}draw()}function addListeners(){var e=getCanvas();document.addEventListener("selectstart",stopselection,!1),e.addEventListener("mousemove",onMouseMove,!1),e.addEventListener("mousedown",onMouseDown,!1),e.addEventListener("mouseup",onMouseUp,!1),e.addEventListener("dblclick",onDblClick,!1)}$(document).mouseup(function(){minimap.selected=!1}),window.onresize=function(){minimap.initMinimap(),minimap.updateMinimap()};var currentDiagramId=null;function init(e){var t=getCanvas();(minimap=new Minimap(t,document.getElementById("minimap"),115)).updateMinimap(),null==canvasProps&&(canvasProps=new CanvasProps(CanvasProps.DEFAULT_WIDTH,CanvasProps.DEFAULT_HEIGHT,CanvasProps.DEFAULT_FILL_COLOR)),canvasProps.setWidth(canvasProps.getWidth()),canvasProps.setHeight(canvasProps.getHeight()),0==isBrowserReady()&&modal(),setUpEditPanel(canvasProps),isNumeric(e)?(currentDiagramId=e,load(e)):e.substring&&"tmp"===e.substring(0,3)?loadTempDiagram(e):"quickstart"===e&&loadQuickStartDiagram(),addListeners(),window.addEventListener("mousedown",documentOnMouseDown,!1),window.addEventListener("mousemove",documentOnMouseMove,!1),window.addEventListener("mouseup",documentOnMouseUp,!1)}var redraw=!1;function action(e){switch(redraw=!1,e){case"insertImage":Log.info("main.js->action()->insertImage. Nr of actions in the STACK: "+History.COMMANDS.length),state==STATE_TEXT_EDITING&&(currentTextEditor.destroy(),currentTextEditor=null);var t=new InsertedImageFigureCreateCommand(insertedImageFileName,100,100);t.execute(),History.addUndo(t),redraw=!0;break;case"connector-straight":state==STATE_TEXT_EDITING&&(currentTextEditor.destroy(),currentTextEditor=null),selectedFigureId=-1,state=STATE_CONNECTOR_PICK_FIRST,connectorType=Connector.TYPE_STRAIGHT,redraw=!0;break;case"connector-organic":state==STATE_TEXT_EDITING&&(currentTextEditor.destroy(),currentTextEditor=null),selectedFigureId=-1,state=STATE_CONNECTOR_PICK_FIRST,connectorType=Connector.TYPE_ORGANIC,redraw=!0;break;case"rotate90":case"rotate90A":if(selectedFigureId){var n=[[1,0,-1*(b=(m=(C=STACK.figureGetById(selectedFigureId)).getBounds())[0]+(m[2]-m[0])/2)],[0,1,-1*(I=m[1]+(m[3]-m[1])/2)],[0,0,1]],o=[[1,0,b],[0,1,I],[0,0,1]];C.transform(n),"rotate90"==e?C.transform(R90):C.transform(R90A),C.transform(o),redraw=!0}break;case"up":switch(state){case STATE_FIGURE_SELECTED:var r=new FigureTranslateCommand(selectedFigureId,Matrix.UP);History.addUndo(r),r.execute(),redraw=!0;break;case STATE_GROUP_SELECTED:var d=new GroupTranslateCommand(selectedGroupId,Matrix.UP);History.addUndo(d),d.execute(),redraw=!0;break;case STATE_CONTAINER_SELECTED:var a=new ContainerTranslateCommand(selectedContainerId,Matrix.UP);History.addUndo(a),a.execute(),redraw=!0}break;case"down":switch(state){case STATE_FIGURE_SELECTED:var s=new FigureTranslateCommand(selectedFigureId,Matrix.DOWN);History.addUndo(s),s.execute(),redraw=!0;break;case STATE_GROUP_SELECTED:var i=new GroupTranslateCommand(selectedGroupId,Matrix.DOWN);History.addUndo(i),i.execute(),redraw=!0;break;case STATE_CONTAINER_SELECTED:var c=new ContainerTranslateCommand(selectedContainerId,Matrix.DOWN);History.addUndo(c),c.execute(),redraw=!0}break;case"right":switch(state){case STATE_FIGURE_SELECTED:var u=new FigureTranslateCommand(selectedFigureId,Matrix.RIGHT);History.addUndo(u),u.execute(),redraw=!0;break;case STATE_GROUP_SELECTED:var l=new GroupTranslateCommand(selectedGroupId,Matrix.RIGHT);History.addUndo(l),l.execute(),redraw=!0;break;case STATE_CONTAINER_SELECTED:var E=new ContainerTranslateCommand(selectedContainerId,Matrix.RIGHT);History.addUndo(E),E.execute(),redraw=!0}break;case"left":switch(state){case STATE_FIGURE_SELECTED:var T=new FigureTranslateCommand(selectedFigureId,Matrix.LEFT);History.addUndo(T),T.execute(),redraw=!0;break;case STATE_GROUP_SELECTED:var _=new GroupTranslateCommand(selectedGroupId,Matrix.LEFT);History.addUndo(_),_.execute(),redraw=!0;break;case STATE_CONTAINER_SELECTED:var g=new ContainerTranslateCommand(selectedContainerId,Matrix.LEFT);History.addUndo(g),g.execute(),redraw=!0}break;case"grow":if(-1!=selectedFigureId){n=[[1,0,-1*(b=(m=(C=STACK.figureGetById(selectedFigureId)).getBounds())[0]+(m[2]-m[0])/2)],[0,1,-1*(I=m[1]+(m[3]-m[1])/2)],[0,0,1]],o=[[1,0,b],[0,1,I],[0,0,1]];C.transform(n),C.transform([[1.2,0,0],[0,1.2,0],[0,0,1]]),C.transform(o),redraw=!0}break;case"shrink":if(-1!=selectedFigureId){var C,m,b,I;n=[[1,0,-1*(b=(m=(C=STACK.figureGetById(selectedFigureId)).getBounds())[0]+(m[2]-m[0])/2)],[0,1,-1*(I=m[1]+(m[3]-m[1])/2)],[0,0,1]],o=[[1,0,b],[0,1,I],[0,0,1]];C.transform(n),C.transform([[.8,0,0],[0,.8,0],[0,0,1]]),C.transform(o),redraw=!0}break;case"duplicate":var A;if(-1!=selectedFigureId)(A=new FigureCloneCommand(selectedFigureId)).execute(),History.addUndo(A);if(-1!=selectedGroupId)(A=new GroupCloneCommand(selectedGroupId)).execute(),History.addUndo(A);getCanvas().style.cursor="default",redraw=!0;break;case"undo":Log.info("main.js->action()->Undo. Nr of actions in the STACK: "+History.COMMANDS.length),History.undo(),redraw=!0;break;case"redo":Log.info("main.js->action()->Redo. Nr of actions in the STACK: "+History.COMMANDS.length),History.redo(),redraw=!0}redraw&&draw()}var lastMousePosition=null;function documentOnMouseDown(e){}var draggingFigure=null;function documentOnMouseMove(e){switch(state){case STATE_FIGURE_CREATE:draggingFigure||((draggingFigure=document.createElement("img")).setAttribute("id","draggingThumb"),draggingFigure.style.position="absolute",draggingFigure.style.zIndex=3,body.appendChild(draggingFigure)),draggingFigure.setAttribute("src",selectedFigureThumb),draggingFigure.style.width="100px",draggingFigure.style.height="100px",draggingFigure.style.left=e.pageX-50+"px",draggingFigure.style.top=e.pageY-50+"px",draggingFigure.style.display="block",draggingFigure.addEventListener("mousedown",function(e){},!1),draggingFigure.addEventListener("mouseup",function(t){var n=getCanvasXY(t);if(null!=n){n[0],n[1];state,e.stopPropagation()}},!1)}}function documentOnMouseUp(e){switch(Log.info("documentOnMouseUp"),state){case STATE_FIGURE_CREATE:"a"!=document.elementFromPoint(e.clientX,e.clientY).id&&draggingFigure&&(draggingFigure.parentNode.removeChild(draggingFigure),state=STATE_NONE,draggingFigure=null)}}function linkMap(){var e="",t=!0;for(var n in STACK.figures){var o=STACK.figures[n];if(""!=o.url){var r=o.getBounds();t?t=!1:e+="\n",e+=r[0]+","+r[1]+","+r[2]+","+r[3]+","+o.url}}return Log.info("editor.php->linkMap()->csv bounds: "+e),e}function touchStart(e){e.preventDefault(),onMouseDown(e)}function touchMove(e){e.preventDefault(),onMouseMove(e)}function touchEnd(e){onMouseUp(e)}function touchCancel(e){}function moveBack(){if(-1!=selectedFigureId){setUndo(!0);var e=new FigureZOrderCommand(selectedFigureId,STACK.idToIndex[selectedFigureId]-1);e.execute(),History.addUndo(e),redraw=!0,draw()}}function moveFront(){if(-1!=selectedFigureId){setUndo(!0);var e=new FigureZOrderCommand(selectedFigureId,STACK.idToIndex[selectedFigureId]+1);e.execute(),History.addUndo(e),redraw=!0,draw()}}function copyObject(){if(-1!=selectedFigureId?(clipboardBuffer[0]="figure",clipboardBuffer[1]=selectedFigureId):-1!=selectedGroupId?(clipboardBuffer[0]="group",clipboardBuffer[1]=selectedGroupId):(clipboardBuffer[0]="",clipboardBuffer[1]=-1),clipboardBuffer[0])switch(setUndo(!0),state){case STATE_NONE:"figure"==clipboardBuffer[0]?(selectedFigureId=clipboardBuffer[1],action("duplicate")):"group"==clipboardBuffer[0]&&(selectedGroupId=clipboardBuffer[1],STACK.groupGetById(selectedGroupId)&&action("duplicate"));break;case STATE_FIGURE_SELECTED:if("figure"==clipboardBuffer[0])if(clipboardBuffer[1]==selectedFigureId)action("duplicate"),clipboardBuffer[1]=selectedFigureId;else{var e=STACK.figureGetById(clipboardBuffer[1]);STACK.figureGetById(selectedFigureId).applyAnotherFigureStyle(e)}break;case STATE_GROUP_SELECTED:if(clipboardBuffer[1]==selectedGroupId)action("duplicate"),clipboardBuffer[1]=selectedGroupId;else if("figure"==clipboardBuffer[0]){e=STACK.figureGetById(clipboardBuffer[1]);for(var t=STACK.figureGetByGroupId(selectedGroupId),n=0;n<t.length;n++)t[n].applyAnotherFigureStyle(e)}}else if(-1!=selectedConnectorId){var o=CONNECTOR_MANAGER.connectorGetById(selectedConnectorId),r=CONNECTOR_MANAGER.connectionPointGetAllByParent(selectedConnectorId),d=r[0].point.x,a=r[0].point.y+20,s=r[1].point.x,i=r[1].point.y+20;selectedFigureId=-1,state=STATE_CONNECTOR_PICK_FIRST,connectorType=Connector.TYPE_STRAIGHT,redraw=!0,connectorPickFirst(d,a,Connector.TYPE_STRAIGHT),draw(),state=STATE_CONNECTOR_PICK_SECOND,redraw=!0,connectorPickSecond(s,i,Connector.TYPE_STRAIGHT),state=STATE_CONNECTOR_SELECTED;var c=new ConnectorCreateCommand(selectedConnectorId);History.addUndo(c),draw();var u=CONNECTOR_MANAGER.connectorGetById(selectedConnectorId);u.style=o.style,u.endStyle=o.endStyle,draw(),setUpEditPanel(u),document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_enabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_disabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_enabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_disabled")}}

// shapes.js
"use strict";figureSets.basic={name:"Basic",description:"A basic set of figures",figures:[{figureFunction:"Square",image:"square.png"},{figureFunction:"Circle",image:"circle.png"},{figureFunction:"RoundedRectangle",image:"rounded_rectangle.png"},{figureFunction:"Diamond",image:"diamond.png"},{figureFunction:"Parallelogram",image:"parallelogram.png"},{figureFunction:"RightTriangle",image:"right_triangle.png"},{figureFunction:"Pentagon",image:"pentagon.png"},{figureFunction:"Hexagon",image:"hexagon.png"},{figureFunction:"Octogon",image:"octogon.png"},{figureFunction:"Text",image:"text.png"},{figureFunction:"Picture",image:"picture.png"},{figureFunction:"Arrow",image:"arrow.png"}]};var FigureDefaults={segmentSize:70,segmentShortSize:40,radiusSize:35,parallelsOffsetSize:40,corner:15,cornerRoundness:10,strokeStyle:"#000000",fillStyle:"#ffffff",textSize:12,textStr:"Text",textFont:"Arial",textColor:"#000000"};function figure_Square(e,t){var i=new Polygon;i.addPoint(new Point(e,t)),i.addPoint(new Point(e+FigureDefaults.segmentSize,t)),i.addPoint(new Point(e+FigureDefaults.segmentSize,t+FigureDefaults.segmentSize)),i.addPoint(new Point(e,t+FigureDefaults.segmentSize));var r=new Figure("Square");r.style.fillStyle=FigureDefaults.fillStyle,r.style.strokeStyle=FigureDefaults.strokeStyle,r.properties.push(new BuilderProperty("Text","primitives.1.str",BuilderProperty.TYPE_TEXT)),r.properties.push(new BuilderProperty("Text Size ","primitives.1.size",BuilderProperty.TYPE_TEXT_FONT_SIZE)),r.properties.push(new BuilderProperty("Font ","primitives.1.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY)),r.properties.push(new BuilderProperty("Alignment ","primitives.1.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT)),r.properties.push(new BuilderProperty("Text Underlined","primitives.1.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED)),r.properties.push(new BuilderProperty("Text Color","primitives.1.style.fillStyle",BuilderProperty.TYPE_COLOR)),r.properties.push(new BuilderProperty(STRING_BACKGROUND_COLOR,"style.fillStyle",BuilderProperty.TYPE_COLOR)),r.properties.push(new BuilderProperty(STRING_BORDER_COLOR,"style.strokeStyle",BuilderProperty.TYPE_COLOR)),r.properties.push(new BuilderProperty(STRING_BORDER_WIDTH,"style.lineWidth",BuilderProperty.TYPE_LINE_WIDTH)),r.properties.push(new BuilderProperty(STRING_BORDER_STYLE,"style.lineStyle",BuilderProperty.TYPE_LINE_STYLE)),r.addPrimitive(i);var n=new Text(STRING_TEXT,e+FigureDefaults.segmentSize/2,t+FigureDefaults.segmentSize/2,FigureDefaults.textFont,FigureDefaults.textSize);return n.style.fillStyle=FigureDefaults.textColor,r.addPrimitive(n),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e+FigureDefaults.segmentSize/2-10,t),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e+FigureDefaults.segmentSize/2,t),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e+FigureDefaults.segmentSize/2+10,t),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e+FigureDefaults.segmentSize/2-10,t+FigureDefaults.segmentSize),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e+FigureDefaults.segmentSize/2,t+FigureDefaults.segmentSize),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e+FigureDefaults.segmentSize/2+10,t+FigureDefaults.segmentSize),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e+FigureDefaults.segmentSize,t+FigureDefaults.segmentSize/2-10),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e+FigureDefaults.segmentSize,t+FigureDefaults.segmentSize/2),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e+FigureDefaults.segmentSize,t+FigureDefaults.segmentSize/2+10),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e,t+FigureDefaults.segmentSize/2-10),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e,t+FigureDefaults.segmentSize/2),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e,t+FigureDefaults.segmentSize/2+10),ConnectionPoint.TYPE_FIGURE),r.finalise(),r}function figure_Circle(e,t){var i=new Figure("Circle");i.style.fillStyle=FigureDefaults.fillStyle,i.style.strokeStyle=FigureDefaults.strokeStyle,i.properties.push(new BuilderProperty("Text","primitives.1.str",BuilderProperty.TYPE_TEXT)),i.properties.push(new BuilderProperty("Text Size ","primitives.1.size",BuilderProperty.TYPE_TEXT_FONT_SIZE)),i.properties.push(new BuilderProperty("Font ","primitives.1.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY)),i.properties.push(new BuilderProperty("Alignment ","primitives.1.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT)),i.properties.push(new BuilderProperty("Text Underlined","primitives.1.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED)),i.properties.push(new BuilderProperty("Text Color","primitives.1.style.fillStyle",BuilderProperty.TYPE_COLOR)),i.properties.push(new BuilderProperty(STRING_BACKGROUND_COLOR,"style.fillStyle",BuilderProperty.TYPE_COLOR)),i.properties.push(new BuilderProperty(STRING_BORDER_COLOR,"style.strokeStyle",BuilderProperty.TYPE_COLOR)),i.properties.push(new BuilderProperty(STRING_BORDER_WIDTH,"style.lineWidth",BuilderProperty.TYPE_LINE_WIDTH)),i.properties.push(new BuilderProperty(STRING_BORDER_STYLE,"style.lineStyle",BuilderProperty.TYPE_LINE_STYLE));var r=new Arc(e,t,FigureDefaults.radiusSize,0,360,!1,0);i.addPrimitive(r);var n=new Text(STRING_TEXT,e,t,FigureDefaults.textFont,FigureDefaults.textSize);return n.style.fillStyle=FigureDefaults.textColor,i.addPrimitive(n),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+FigureDefaults.radiusSize,t),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e,t+FigureDefaults.radiusSize),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e-FigureDefaults.radiusSize,t),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e,t-FigureDefaults.radiusSize),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e,t),ConnectionPoint.TYPE_FIGURE),i.finalise(),i}function figure_Diamond(e,t){var i=new Polygon;i.addPoint(new Point(e,t-FigureDefaults.segmentSize/2)),i.addPoint(new Point(e+FigureDefaults.segmentShortSize/3*2,t)),i.addPoint(new Point(e,t+FigureDefaults.segmentSize/2)),i.addPoint(new Point(e-FigureDefaults.segmentShortSize/3*2,t));var r=new Figure("Diamond");r.style.fillStyle=FigureDefaults.fillStyle,r.style.strokeStyle=FigureDefaults.strokeStyle,r.properties.push(new BuilderProperty("Text","primitives.1.str",BuilderProperty.TYPE_TEXT)),r.properties.push(new BuilderProperty("Text Size ","primitives.1.size",BuilderProperty.TYPE_TEXT_FONT_SIZE)),r.properties.push(new BuilderProperty("Font ","primitives.1.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY)),r.properties.push(new BuilderProperty("Alignment ","primitives.1.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT)),r.properties.push(new BuilderProperty("Text Underlined","primitives.1.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED)),r.properties.push(new BuilderProperty("Text Color","primitives.1.style.fillStyle",BuilderProperty.TYPE_COLOR)),r.properties.push(new BuilderProperty(STRING_BACKGROUND_COLOR,"style.fillStyle",BuilderProperty.TYPE_COLOR)),r.properties.push(new BuilderProperty(STRING_BORDER_COLOR,"style.strokeStyle",BuilderProperty.TYPE_COLOR)),r.properties.push(new BuilderProperty(STRING_BORDER_WIDTH,"style.lineWidth",BuilderProperty.TYPE_LINE_WIDTH)),r.properties.push(new BuilderProperty(STRING_BORDER_STYLE,"style.lineStyle",BuilderProperty.TYPE_LINE_STYLE)),r.addPrimitive(i);var n=new Text(STRING_TEXT,e,t,FigureDefaults.textFont,FigureDefaults.textSize);return n.style.fillStyle=FigureDefaults.textColor,r.addPrimitive(n),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e,t),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e,t-FigureDefaults.segmentSize/2),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e+FigureDefaults.segmentShortSize/3*2,t),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e,t+FigureDefaults.segmentSize/2),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e-FigureDefaults.segmentShortSize/3*2,t),ConnectionPoint.TYPE_FIGURE),r.finalise(),r}function figure_Parallelogram(e,t){var i=new Figure("Diamond");i.style.fillStyle=FigureDefaults.fillStyle,i.style.strokeStyle=FigureDefaults.strokeStyle,i.properties.push(new BuilderProperty("Text","primitives.1.str",BuilderProperty.TYPE_TEXT)),i.properties.push(new BuilderProperty("Text Size ","primitives.1.size",BuilderProperty.TYPE_TEXT_FONT_SIZE)),i.properties.push(new BuilderProperty("Font ","primitives.1.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY)),i.properties.push(new BuilderProperty("Alignment ","primitives.1.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT)),i.properties.push(new BuilderProperty("Text Underlined","primitives.1.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED)),i.properties.push(new BuilderProperty("Text Color","primitives.1.style.fillStyle",BuilderProperty.TYPE_COLOR)),i.properties.push(new BuilderProperty(STRING_BACKGROUND_COLOR,"style.fillStyle",BuilderProperty.TYPE_COLOR)),i.properties.push(new BuilderProperty(STRING_BORDER_COLOR,"style.strokeStyle",BuilderProperty.TYPE_COLOR)),i.properties.push(new BuilderProperty(STRING_BORDER_WIDTH,"style.lineWidth",BuilderProperty.TYPE_LINE_WIDTH)),i.properties.push(new BuilderProperty(STRING_BORDER_STYLE,"style.lineStyle",BuilderProperty.TYPE_LINE_STYLE));var r=new Polygon;r.addPoint(new Point(e+10,t)),r.addPoint(new Point(e+FigureDefaults.segmentSize+10,t)),r.addPoint(new Point(e+FigureDefaults.segmentSize+FigureDefaults.parallelsOffsetSize,t+FigureDefaults.segmentShortSize)),r.addPoint(new Point(e+FigureDefaults.parallelsOffsetSize,t+FigureDefaults.segmentShortSize)),i.addPrimitive(r);var n=new Text(STRING_TEXT,e+FigureDefaults.segmentSize/2+FigureDefaults.parallelsOffsetSize/2+5,t+FigureDefaults.segmentShortSize/2,FigureDefaults.textFont,FigureDefaults.textSize);return n.style.fillStyle=FigureDefaults.textColor,i.addPrimitive(n),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+10,t),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+FigureDefaults.segmentSize+10,t),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+FigureDefaults.segmentSize+FigureDefaults.parallelsOffsetSize,t+FigureDefaults.segmentShortSize),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+FigureDefaults.parallelsOffsetSize,t+FigureDefaults.segmentShortSize),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+FigureDefaults.segmentSize+FigureDefaults.parallelsOffsetSize/2+5,t+FigureDefaults.segmentShortSize/2),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+FigureDefaults.parallelsOffsetSize/2+5,t+FigureDefaults.segmentShortSize/2),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+FigureDefaults.segmentSize/2+FigureDefaults.parallelsOffsetSize,t+FigureDefaults.segmentShortSize),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+FigureDefaults.segmentSize/2+10,t),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+FigureDefaults.segmentSize/2+FigureDefaults.parallelsOffsetSize/2+2,t+FigureDefaults.segmentShortSize/2),ConnectionPoint.TYPE_FIGURE),i.finalise(),i}function figure_Picture(e,t){var i=new Figure("FamilyCard");i.style.fillStyle=FigureDefaults.fillStyle,i.style.strokeStyle=FigureDefaults.strokeStyle;var r=new ImageFrame("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAKL2lDQ1BJQ0MgcHJvZmlsZQAASMedlndUVNcWh8+9d3qhzTDSGXqTLjCA9C4gHQRRGGYGGMoAwwxNbIioQEQREQFFkKCAAaOhSKyIYiEoqGAPSBBQYjCKqKhkRtZKfHl57+Xl98e939pn73P32XuftS4AJE8fLi8FlgIgmSfgB3o401eFR9Cx/QAGeIABpgAwWempvkHuwUAkLzcXerrICfyL3gwBSPy+ZejpT6eD/0/SrFS+AADIX8TmbE46S8T5Ik7KFKSK7TMipsYkihlGiZkvSlDEcmKOW+Sln30W2VHM7GQeW8TinFPZyWwx94h4e4aQI2LER8QFGVxOpohvi1gzSZjMFfFbcWwyh5kOAIoktgs4rHgRm4iYxA8OdBHxcgBwpLgvOOYLFnCyBOJDuaSkZvO5cfECui5Lj25qbc2ge3IykzgCgaE/k5XI5LPpLinJqUxeNgCLZ/4sGXFt6aIiW5paW1oamhmZflGo/7r4NyXu7SK9CvjcM4jW94ftr/xS6gBgzIpqs+sPW8x+ADq2AiB3/w+b5iEAJEV9a7/xxXlo4nmJFwhSbYyNMzMzjbgclpG4oL/rfzr8DX3xPSPxdr+Xh+7KiWUKkwR0cd1YKUkpQj49PZXJ4tAN/zzE/zjwr/NYGsiJ5fA5PFFEqGjKuLw4Ubt5bK6Am8Kjc3n/qYn/MOxPWpxrkSj1nwA1yghI3aAC5Oc+gKIQARJ5UNz13/vmgw8F4psXpjqxOPefBf37rnCJ+JHOjfsc5xIYTGcJ+RmLa+JrCdCAACQBFcgDFaABdIEhMANWwBY4AjewAviBYBAO1gIWiAfJgA8yQS7YDApAEdgF9oJKUAPqQSNoASdABzgNLoDL4Dq4Ce6AB2AEjIPnYAa8AfMQBGEhMkSB5CFVSAsygMwgBmQPuUE+UCAUDkVDcRAPEkK50BaoCCqFKqFaqBH6FjoFXYCuQgPQPWgUmoJ+hd7DCEyCqbAyrA0bwwzYCfaGg+E1cBycBufA+fBOuAKug4/B7fAF+Dp8Bx6Bn8OzCECICA1RQwwRBuKC+CERSCzCRzYghUg5Uoe0IF1IL3ILGUGmkXcoDIqCoqMMUbYoT1QIioVKQ21AFaMqUUdR7age1C3UKGoG9QlNRiuhDdA2aC/0KnQcOhNdgC5HN6Db0JfQd9Dj6DcYDIaG0cFYYTwx4ZgEzDpMMeYAphVzHjOAGcPMYrFYeawB1g7rh2ViBdgC7H7sMew57CB2HPsWR8Sp4sxw7rgIHA+XhyvHNeHO4gZxE7h5vBReC2+D98Oz8dn4Enw9vgt/Az+OnydIE3QIdoRgQgJhM6GC0EK4RHhIeEUkEtWJ1sQAIpe4iVhBPE68QhwlviPJkPRJLqRIkpC0k3SEdJ50j/SKTCZrkx3JEWQBeSe5kXyR/Jj8VoIiYSThJcGW2ChRJdEuMSjxQhIvqSXpJLlWMkeyXPKk5A3JaSm8lLaUixRTaoNUldQpqWGpWWmKtKm0n3SydLF0k/RV6UkZrIy2jJsMWyZf5rDMRZkxCkLRoLhQWJQtlHrKJco4FUPVoXpRE6hF1G+o/dQZWRnZZbKhslmyVbJnZEdoCE2b5kVLopXQTtCGaO+XKC9xWsJZsmNJy5LBJXNyinKOchy5QrlWuTty7+Xp8m7yifK75TvkHymgFPQVAhQyFQ4qXFKYVqQq2iqyFAsVTyjeV4KV9JUCldYpHVbqU5pVVlH2UE5V3q98UXlahabiqJKgUqZyVmVKlaJqr8pVLVM9p/qMLkt3oifRK+g99Bk1JTVPNaFarVq/2ry6jnqIep56q/ojDYIGQyNWo0yjW2NGU1XTVzNXs1nzvhZei6EVr7VPq1drTltHO0x7m3aH9qSOnI6XTo5Os85DXbKug26abp3ubT2MHkMvUe+A3k19WN9CP16/Sv+GAWxgacA1OGAwsBS91Hopb2nd0mFDkqGTYYZhs+GoEc3IxyjPqMPohbGmcYTxbuNe408mFiZJJvUmD0xlTFeY5pl2mf5qpm/GMqsyu21ONnc332jeaf5ymcEyzrKDy+5aUCx8LbZZdFt8tLSy5Fu2WE5ZaVpFW1VbDTOoDH9GMeOKNdra2Xqj9WnrdzaWNgKbEza/2BraJto22U4u11nOWV6/fMxO3Y5pV2s3Yk+3j7Y/ZD/ioObAdKhzeOKo4ch2bHCccNJzSnA65vTC2cSZ79zmPOdi47Le5bwr4urhWuja7ybjFuJW6fbYXd09zr3ZfcbDwmOdx3lPtKe3527PYS9lL5ZXo9fMCqsV61f0eJO8g7wrvZ/46Pvwfbp8Yd8Vvnt8H67UWslb2eEH/Lz89vg98tfxT/P/PgAT4B9QFfA00DQwN7A3iBIUFdQU9CbYObgk+EGIbogwpDtUMjQytDF0Lsw1rDRsZJXxqvWrrocrhHPDOyOwEaERDRGzq91W7109HmkRWRA5tEZnTdaaq2sV1iatPRMlGcWMOhmNjg6Lbor+wPRj1jFnY7xiqmNmWC6sfaznbEd2GXuKY8cp5UzE2sWWxk7G2cXtiZuKd4gvj5/munAruS8TPBNqEuYS/RKPJC4khSW1JuOSo5NP8WR4ibyeFJWUrJSBVIPUgtSRNJu0vWkzfG9+QzqUvia9U0AV/Uz1CXWFW4WjGfYZVRlvM0MzT2ZJZ/Gy+rL1s3dkT+S453y9DrWOta47Vy13c+7oeqf1tRugDTEbujdqbMzfOL7JY9PRzYTNiZt/yDPJK817vSVsS1e+cv6m/LGtHlubCyQK+AXD22y31WxHbedu799hvmP/jk+F7MJrRSZF5UUfilnF174y/ariq4WdsTv7SyxLDu7C7OLtGtrtsPtoqXRpTunYHt897WX0ssKy13uj9l4tX1Zes4+wT7hvpMKnonO/5v5d+z9UxlfeqXKuaq1Wqt5RPXeAfWDwoOPBlhrlmqKa94e4h+7WetS212nXlR/GHM44/LQ+tL73a8bXjQ0KDUUNH4/wjowcDTza02jV2Nik1FTSDDcLm6eORR67+Y3rN50thi21rbTWouPguPD4s2+jvx064X2i+yTjZMt3Wt9Vt1HaCtuh9uz2mY74jpHO8M6BUytOdXfZdrV9b/T9kdNqp6vOyJ4pOUs4m3924VzOudnzqeenL8RdGOuO6n5wcdXF2z0BPf2XvC9duex++WKvU++5K3ZXTl+1uXrqGuNax3XL6+19Fn1tP1j80NZv2d9+w+pG503rm10DywfODjoMXrjleuvyba/b1++svDMwFDJ0dzhyeOQu++7kvaR7L+9n3J9/sOkh+mHhI6lH5Y+VHtf9qPdj64jlyJlR19G+J0FPHoyxxp7/lP7Th/H8p+Sn5ROqE42TZpOnp9ynbj5b/Wz8eerz+emCn6V/rn6h++K7Xxx/6ZtZNTP+kv9y4dfiV/Kvjrxe9rp71n/28ZvkN/NzhW/l3x59x3jX+z7s/cR85gfsh4qPeh+7Pnl/eriQvLDwG/eE8/vMO7xsAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAN11AADddQGsh8ODAAAAB3RJTUUH4goXBxYcHfCYswAAACZpVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVAgb24gYSBNYWOV5F9bAAANDklEQVR42t2beZBdRRXGf2+ZLTEaQgVKFCm2wgtCIaIIFETxGlaBNFjKLouEEMAIgTQkWoILLYYlYV9lBxFaRZDFQcEqikJ2RKdkRyVaoBQIYZJ5m3/cr9/0e5l93gzCrXr1XjLvvu6v+5zvnPOdvjBZl3GN79nn+Rh31pDf+UBcMTDjcvo8F+Nqen3/vVqE/KSA9zYAKuJtDePmAZcA7wKrgSXRIuSa7pnQqzCJ4NvxtoRx3wLOB1YBHZpDH7ALSdqFt90kaRtJWq3f29P9PlyANcH3YdxC4BygDBSb5lEGdiZJZ+DtnSRpJ0lanuhFyE2C7xfxtoxxJwFnye2qg9xR02JcjLfHYlwHsLq+CN6+Txag33dz8vnjgOUarzqCOeWAC/H2OIwrAJWJWoTchJh94/8dCVwxAuADEfS5eHviGlGhhYvQWg4Ifhp81rhDgJ+K5EYbcSrAjiRpJz3d99HTDUn6PrCAfh+fq1C3WoQ3lrHKQLuI8zS8Xd1qN8i3zN/7wRc0wYP1jeog41S1y+VhSBHg68BH6lbbwmQp3xKfzyZSwNsMVJbtfRX4PdClmJ+LQPXJKtq0w0Wg1LQQZeUJLwF74e1rGFfE2wqQx7hcK5Klwrh9Puy8t1WMS4FXxP5vk6T3AtsAmwp0QbveATwNXA/8Qf+3cbRANS3OK8B+ePsExrUpnO4GvAj0c8I48oTWWEAG/hTgt4DD24om/E/gQIHs0CL0AXsDOwCnAd8FdgM+K8DIIl4F9sXbxzEuZJHfBH4DXCtrq9UtYdJIMDb7MLBxxwIXivA6gKV4e7JMtoxxM4FfAlsCW9WBelvT/TlZRx54BJgJ7Iq3f9JCljDuGOAiuUYbcBXeHjneEJkfN/jselygOuTvCzFuqcDn8PZ14AhgI+BvdfDGzcS4mXhbw9tAhtsCewt8YRDwb8uqaLCAMXBCYdzgs0n+nSR9ENgVWFuWsBNJOg24jyTN4e2/SdLeOlkatxdwOzCPJP0HPd1/pqe7qu++inGBV44FLhAvFIGVwHy8vVbWUWngo1FyQm4MIS9MzAIrNJGpeLsS4z4L3AasL19vBxbh7VlKaYuK5fsDN+jvIek5Gm+vwrgiUNUYewJ3CHwImUfi7Y0Y9yG8fQfjZgF7KE+ojDZPyI8R/HeAM4FLMe5QgZ+Kt48A+wArBO4vwN36hQ6BPxC4RqZc0isrgIybK1cIC/Ok7g8bdZDAdwn8dsB1wCnAZRjX1ZAnjHsBmpOcDPyWwBna4U4NfIgWoQNvnwC+DNwDzMbbpzFuCt6+q9T4EmCK/L0QlcLtwDKMOw5vV+meV4E5wM8VDr2ItRfjthWxri9OOAKYJZcYcbKUG+Hu56MUt6Ys71qgV4lOCTgUb28WKdUitwgsfiBwMfDhQTK/msZYDVi8XYZxnVqMLrztjeazFfA78c1KYCqwBFiqueTqrjVMFZkfoYBZq/tlZgnXKb53acIF4EaMm1MPbbBSi1GSz18yBPiwGTVZgsO44wW+APRiXE6aYqIIMF1jB/A/AkqaY0EizLAaY36EbD8PeBjj1hfRFPH2JuAAhb6aACzCuBn1kJRZwt6qCKeJyEZyZbmEcfPwtqJ5hBpjieqCmr73PeCHyj6rGv8u4AZFqCFDZH6I3D4f1fMXKj7fgnGfUHwv4u3NsoSCCG8O3r4hl0EsfpN2qTyKqFMVSS7HuLkCUNb8DhLAInAG3p4egZ8OXAnsIu64TFkkgwmthUHAt2mn50clbQnYENiBJL0Hb9/UCj9Nkj4FXI23z4kIy4rzN4vwyqOsO4JyVAR2J0lfo6f7UZI0T093jSS9C3gOOI8krWne0xRd9pXaXFF6/XGS9A7VDrnmPCE3APgQrk6WhleSNQSC6gQeU7a2QotQ0e8E4psDXC2fL42j6AqLUAEW4O0FdWIM5JztfAdwi2qMVZFbhkh1A94ejHFtQFmuCd6uocEH9XYx8P2oHh9IpHgKOBhvnxFRtSs87Q9cLpIqt0BzqEah0uLtORg3BVgl8DO12HsMstgVudOtePtVjGsXWdYwLrKAjGQqGLdEcX4oAbOkELgx8KYyvD6M20/g19LArVKcQogsAYvxdinGdUoxrmHcIyq7GUZt/gXeGmWbFbyt5ZqqukWAi2rygX6oKvBbKOML5fDe2om1xiCAjlYmOw1vzxaQMK+ngM0iVXmwqHcL3n4tbHwuIsETgbOH8dmS/GsvMXFNO7Cb2H56i3d+KMH0FLw9LyqlNwCeF0+1DWMJ1wGH422l0AR+1RA3V+X7TwCnA30CP0sFUKt8fiTuUABmk6Sv4W0WHbz9D0m6hfSGweaR0yZuA6xHkt6TU1V3pkJH5zCr3gacC5yqlZ4uAWOTSOebjCtEh3eBnfH2MVnC4coDhrIC9PcuYFk+qrzyoxi81sQJ79XVPH51hPeExVmZx9szgJO1+6URFE47atFyePsWcDTwhv6vMkmgCwJ7ogTTomqQL45gM4Ow8iO8XRyT4ELgJyMkwVnAg1G1NRu4UdXZZJBgFViIt8s09w5FnxVyxeFIMNMsiQ8jZD8U+GC4RsXrQKI6vCoy3F3suvYEukUw+ZAQhUZMCeMeAj4XFWaDWfGFeHu8OKOWr2eBWUrrVF3lhmBRBPJxuU1eNf9dwGFyh/wE7vxige9QDlLCuHtHAB7gcoFvD2V7PtL2K/rD6coEq4P8WDUysU+qDqioCLpTTPwGQ58DGO2uh6z0VLz9iaSvPiVg64nR80Mkb3ngSrydK3GlL1SFjcVQ9jmoMIuBH0RlbF7+1QE8q3bVc03FUJfqgT2lGM1oYTG0UIlPfzHUz19TJY+lCnHtujds1kV4Oz/CVtcICg2Sck839HSXZQn3k6RvA7trEUoy+WfUsekHb9xhJOkUvH1JltBDkj6tAuVDUUU5FvCB7ZdFfYKPkqRHk6SP0dNdoae7RJLervR8c6XqeYFfhrcnKFL0xeAbw0UsFmRfLODtOcB8rWiXVNo5ePtsXZM37gTVADdi3KYqpfN4e7cUo7GEyFoEfgHeLq8nY5n536zMdWnUHHkLOAS4VRpEG3Ae3i6Iaog1ukeFAZud2WGEmiziEZL0LWBdYH+8fSHq1S0AzhO4GcB2JOltdQGzp/sFkvRJYE9ZQnWEITKn3zypDj7bwSpJeo1qkRKwPUk6E29/ow3rVUN2U+CPeDtvmI7WIJNpviELN+3yn6DyxsVTUWY3B2/vbTgokd2/uzrBM0ZAjLWI8M5WuMpFFepGwAPAxzR2O/F5otCY7Y8QQ/YNRyqL5+plZjZAUItCM/Rt4EC8vSOSxQPhhAbpV+Qqwy1CBfgO3v5YltYnXlkdzWcToFsV4Cpx00XA8dFiIYV4DLJ4szze/4MVjNtBKmw4wPAW8A2Bbxf4T0tF3lDgu/D212pevDFAyIpD3RKBnyLw04BujDsg6kU+L3J+UeB7gWPlopUGMWeYVtloe4PNZ/7+CxyFt7dFeuD26gpNA/4ht3g0CpGxJYQmRsjtF8nsg/VsIJ1he83gELy9Pvr7luoabRa5QVG63wS0xzPwbXh7NvBtNTRj8LOAO6PQ93FgZ93dp4n/Wp2lN8XU4QDVSQLfpnwDhbTP6/Mq4DqMO1Lgp+Ltn4BDgdMFPo+35Yk4UNl8zD3fYBXZ+xcw7t86/d2r90UN32n8/pcw7lndc1R9jP6eQvje1zCuhHEVvco6L0Cd7AJPjeHw1Ojb483NhX6Wv4bsZEfo1Z0s8TJI15sDr4kDiNLYdrx9OQKUAz6Dtw9FLre/ZO/A+qF/GCSxWkMuMyHt8YEG6B9obYHvFfgTm8CvA1wmzW49srM9RbxdgbcvY1xB4CvAw+pAbR11oG4FTAS+QxFg4A0aZQdmvG6Ri54BuGiAnV8X+Jk0hNV6hfZWPjr8sLV2eUOR4t+BfSLBoxydKrkUb+fJXaqTe0hq4IUICcingL9KKAngr1eREjTD0Fjp0SL0ATtJaao0te1eAgzePhmNsXXDv8e4862zgP4qMkww7Oo6qghnyzU6o9jfN4AAGxTpXFMH6nnF96eiMYo6STLuE+TjEy4aCbESKTQ1sjNAsyO1OU582gUwnBss13XG/qtNi7IJ8CudJgtjtAT8+BcgJsLsPRyVhexAI1FVN9DYRb3yQ+h3KLd4p14mr0nC7zEHDB4uw7MC4ZjsaMYLesA5eHtSq3a8+Sq0HHhWQofy+gmS9F9kJ8dqo1yAAnA+3n67IblJ0pY+PzTRj8wES1hAduZ/NI/MXIq3xzSEuv/7R2aGLqAWqYosDLMIOeAKvD16Mh6amtjH5jJ3qKqef4AkLZGd3xmI8ALpXaKd78LbVQ1HYCfgmrgFaBRag2x+P0m6kuxMcakpE8war5mA2REdg5kw8JNzNVaRbXo/IaoaV+vzmQNUmhM+vYl/drgxWSpJMlsuBadTCdAP8fbUKPx9AHZ+MEtotIi57+WT4wD/A7XitcaIEHz/AAAAAElFTkSuQmCC",e,t,!0);return r.debug=!0,i.addPrimitive(r),i.properties.push(new BuilderProperty("URL or base 64 image:","primitives.0.url",BuilderProperty.TYPE_URL)),i.finalise(),i}function figure_RightTriangle(e,t){var i=new Polygon;i.addPoint(new Point(e,t)),i.addPoint(new Point(e+FigureDefaults.segmentShortSize,t+FigureDefaults.segmentSize)),i.addPoint(new Point(e,t+FigureDefaults.segmentSize));var r=new Figure("RightTriangle");r.style.fillStyle=FigureDefaults.fillStyle,r.style.strokeStyle=FigureDefaults.strokeStyle,r.properties.push(new BuilderProperty("Text","primitives.1.str",BuilderProperty.TYPE_TEXT)),r.properties.push(new BuilderProperty("Text Size ","primitives.1.size",BuilderProperty.TYPE_TEXT_FONT_SIZE)),r.properties.push(new BuilderProperty("Font ","primitives.1.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY)),r.properties.push(new BuilderProperty("Alignment ","primitives.1.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT)),r.properties.push(new BuilderProperty("Text Underlined","primitives.1.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED)),r.properties.push(new BuilderProperty("Text Color","primitives.1.style.fillStyle",BuilderProperty.TYPE_COLOR)),r.properties.push(new BuilderProperty(STRING_BACKGROUND_COLOR,"style.fillStyle",BuilderProperty.TYPE_COLOR)),r.properties.push(new BuilderProperty(STRING_BORDER_COLOR,"style.strokeStyle",BuilderProperty.TYPE_COLOR)),r.properties.push(new BuilderProperty(STRING_BORDER_WIDTH,"style.lineWidth",BuilderProperty.TYPE_LINE_WIDTH)),r.properties.push(new BuilderProperty(STRING_BORDER_STYLE,"style.lineStyle",BuilderProperty.TYPE_LINE_STYLE));var n=new Text(STRING_TEXT,e+FigureDefaults.segmentShortSize/3,t+.7*FigureDefaults.segmentSize,FigureDefaults.textFont,FigureDefaults.textSize);return n.style.fillStyle=FigureDefaults.textColor,r.addPrimitive(i),r.addPrimitive(n),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e,t),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e+FigureDefaults.segmentShortSize,t+FigureDefaults.segmentSize),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e,t+FigureDefaults.segmentSize),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(r.id,new Point(e+FigureDefaults.segmentShortSize/2,t+FigureDefaults.segmentSize/2),ConnectionPoint.TYPE_FIGURE),r.finalise(),r}function figure_Pentagon(e,t){for(var i=new Polygon,r=FigureDefaults.radiusSize,n=0;n<5;n++)i.addPoint(new Point(e-r*Math.sin(2*Math.PI*n/5),t-r*Math.cos(2*Math.PI*n/5)));var o=new Figure("Pentagon");o.style.fillStyle=FigureDefaults.fillStyle,o.style.strokeStyle=FigureDefaults.strokeStyle,o.properties.push(new BuilderProperty("Text","primitives.1.str",BuilderProperty.TYPE_TEXT)),o.properties.push(new BuilderProperty("Text Size ","primitives.1.size",BuilderProperty.TYPE_TEXT_FONT_SIZE)),o.properties.push(new BuilderProperty("Font ","primitives.1.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY)),o.properties.push(new BuilderProperty("Alignment ","primitives.1.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT)),o.properties.push(new BuilderProperty("Text Underlined","primitives.1.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED)),o.properties.push(new BuilderProperty("Text Color","primitives.1.style.fillStyle",BuilderProperty.TYPE_COLOR)),o.properties.push(new BuilderProperty(STRING_BACKGROUND_COLOR,"style.fillStyle",BuilderProperty.TYPE_COLOR)),o.properties.push(new BuilderProperty(STRING_BORDER_COLOR,"style.strokeStyle",BuilderProperty.TYPE_COLOR)),o.properties.push(new BuilderProperty(STRING_BORDER_WIDTH,"style.lineWidth",BuilderProperty.TYPE_LINE_WIDTH)),o.properties.push(new BuilderProperty(STRING_BORDER_STYLE,"style.lineStyle",BuilderProperty.TYPE_LINE_STYLE)),o.addPrimitive(i);var l=new Text(STRING_TEXT,e,t-FigureDefaults.radiusSize/11,FigureDefaults.textFont,FigureDefaults.textSize);l.style.fillStyle=FigureDefaults.textColor,o.addPrimitive(l);for(n=0;n<5;n++)CONNECTOR_MANAGER.connectionPointCreate(o.id,new Point(e-r*Math.sin(2*Math.PI*n/5),t-r*Math.cos(2*Math.PI*n/5)),ConnectionPoint.TYPE_FIGURE);return CONNECTOR_MANAGER.connectionPointCreate(o.id,new Point(e,t),ConnectionPoint.TYPE_FIGURE),o.finalise(),o}function figure_Hexagon(e,t){var i=new Polygon,r=FigureDefaults.segmentShortSize/4*3+2;i.addPoint(new Point(e,t+r)),i.addPoint(new Point(e+r,t+r/2)),i.addPoint(new Point(e+r,t-r/2)),i.addPoint(new Point(e,t-r)),i.addPoint(new Point(e-r,t-r/2)),i.addPoint(new Point(e-r,t+r/2));var n=new Figure("Hexagon");n.style.fillStyle=FigureDefaults.fillStyle,n.style.strokeStyle=FigureDefaults.strokeStyle,n.properties.push(new BuilderProperty("Text","primitives.1.str",BuilderProperty.TYPE_TEXT)),n.properties.push(new BuilderProperty("Text Size ","primitives.1.size",BuilderProperty.TYPE_TEXT_FONT_SIZE)),n.properties.push(new BuilderProperty("Font ","primitives.1.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY)),n.properties.push(new BuilderProperty("Alignment ","primitives.1.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT)),n.properties.push(new BuilderProperty("Text Underlined","primitives.1.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED)),n.properties.push(new BuilderProperty("Text Color","primitives.1.style.fillStyle",BuilderProperty.TYPE_COLOR)),n.properties.push(new BuilderProperty(STRING_BACKGROUND_COLOR,"style.fillStyle",BuilderProperty.TYPE_COLOR)),n.properties.push(new BuilderProperty(STRING_BORDER_COLOR,"style.strokeStyle",BuilderProperty.TYPE_COLOR)),n.properties.push(new BuilderProperty(STRING_BORDER_WIDTH,"style.lineWidth",BuilderProperty.TYPE_LINE_WIDTH)),n.properties.push(new BuilderProperty(STRING_BORDER_STYLE,"style.lineStyle",BuilderProperty.TYPE_LINE_STYLE)),n.addPrimitive(i);var o=new Text(STRING_TEXT,e,t,FigureDefaults.textFont,FigureDefaults.textSize);return o.style.fillStyle=FigureDefaults.textColor,n.addPrimitive(o),CONNECTOR_MANAGER.connectionPointCreate(n.id,new Point(e,t+r),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(n.id,new Point(e+r,t+r/2),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(n.id,new Point(e+r,t-r/2),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(n.id,new Point(e,t-r),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(n.id,new Point(e-r,t-r/2),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(n.id,new Point(e-r,t+r/2),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(n.id,new Point(e,t),ConnectionPoint.TYPE_FIGURE),n.finalise(),n}function figure_Octogon(e,t){var i=new Polygon,r=FigureDefaults.segmentShortSize/3*2,n=r/Math.sqrt(2);i.addPoint(new Point(e,t)),i.addPoint(new Point(e+r,t)),i.addPoint(new Point(e+r+n,t+n)),i.addPoint(new Point(e+r+n,t+n+r)),i.addPoint(new Point(e+r,t+n+r+n)),i.addPoint(new Point(e,t+n+r+n)),i.addPoint(new Point(e-n,t+n+r)),i.addPoint(new Point(e-n,t+n));var o=new Figure("Octogon");o.style.fillStyle=FigureDefaults.fillStyle,o.style.strokeStyle=FigureDefaults.strokeStyle,o.properties.push(new BuilderProperty("Text","primitives.1.str",BuilderProperty.TYPE_TEXT)),o.properties.push(new BuilderProperty("Text Size ","primitives.1.size",BuilderProperty.TYPE_TEXT_FONT_SIZE)),o.properties.push(new BuilderProperty("Font ","primitives.1.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY)),o.properties.push(new BuilderProperty("Alignment ","primitives.1.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT)),o.properties.push(new BuilderProperty("Text Underlined","primitives.1.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED)),o.properties.push(new BuilderProperty("Text Color","primitives.1.style.fillStyle",BuilderProperty.TYPE_COLOR)),o.properties.push(new BuilderProperty(STRING_BACKGROUND_COLOR,"style.fillStyle",BuilderProperty.TYPE_COLOR)),o.properties.push(new BuilderProperty(STRING_BORDER_COLOR,"style.strokeStyle",BuilderProperty.TYPE_COLOR)),o.properties.push(new BuilderProperty(STRING_BORDER_WIDTH,"style.lineWidth",BuilderProperty.TYPE_LINE_WIDTH)),o.properties.push(new BuilderProperty(STRING_BORDER_STYLE,"style.lineStyle",BuilderProperty.TYPE_LINE_STYLE)),o.addPrimitive(i);var l=new Text(STRING_TEXT,e+r/2,t+(r+n+n)/2,FigureDefaults.textFont,FigureDefaults.textSize);return l.style.fillStyle=FigureDefaults.textColor,o.addPrimitive(l),CONNECTOR_MANAGER.connectionPointCreate(o.id,new Point(e,t),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(o.id,new Point(e+r,t),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(o.id,new Point(e+r+n,t+n),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(o.id,new Point(e+r+n,t+n+r),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(o.id,new Point(e+r,t+n+r+n),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(o.id,new Point(e,t+n+r+n),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(o.id,new Point(e-n,t+n+r),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(o.id,new Point(e-n,t+n),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(o.id,new Point(e+r/2,t+(r+n+n)/2),ConnectionPoint.TYPE_FIGURE),o.finalise(),o}function figure_Text(e,t){var i=new Figure("Text");i.style.fillStyle=FigureDefaults.fillStyle,i.properties.push(new BuilderProperty("Text","primitives.0.str",BuilderProperty.TYPE_TEXT)),i.properties.push(new BuilderProperty("Text Size ","primitives.0.size",BuilderProperty.TYPE_TEXT_FONT_SIZE)),i.properties.push(new BuilderProperty("Font ","primitives.0.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY)),i.properties.push(new BuilderProperty("Alignment ","primitives.0.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT)),i.properties.push(new BuilderProperty("Text Underlined","primitives.0.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED)),i.properties.push(new BuilderProperty("Text Color","primitives.0.style.fillStyle",BuilderProperty.TYPE_COLOR));var r=new Text(STRING_TEXT,e,t+FigureDefaults.radiusSize/2,FigureDefaults.textFont,FigureDefaults.textSize);return r.style.fillStyle=FigureDefaults.textColor,i.addPrimitive(r),i.finalise(),i}function figure_RoundedRectangle(e,t){var i=new Figure("RoundedRectangle");i.style.fillStyle=FigureDefaults.fillStyle,i.style.strokeStyle=FigureDefaults.strokeStyle,i.style.lineWidth=2,i.style.lineStyle=Style.LINE_STYLE_CONTINOUS,i.properties.push(new BuilderProperty("Text","primitives.1.str",BuilderProperty.TYPE_TEXT)),i.properties.push(new BuilderProperty("Text Size ","primitives.1.size",BuilderProperty.TYPE_TEXT_FONT_SIZE)),i.properties.push(new BuilderProperty("Font ","primitives.1.font",BuilderProperty.TYPE_TEXT_FONT_FAMILY)),i.properties.push(new BuilderProperty("Alignment ","primitives.1.align",BuilderProperty.TYPE_TEXT_FONT_ALIGNMENT)),i.properties.push(new BuilderProperty("Text Underlined","primitives.1.underlined",BuilderProperty.TYPE_TEXT_UNDERLINED)),i.properties.push(new BuilderProperty("Text Color","primitives.1.style.fillStyle",BuilderProperty.TYPE_COLOR)),i.properties.push(new BuilderProperty(STRING_BACKGROUND_COLOR,"style.fillStyle",BuilderProperty.TYPE_COLOR)),i.properties.push(new BuilderProperty(STRING_BORDER_COLOR,"style.strokeStyle",BuilderProperty.TYPE_COLOR)),i.properties.push(new BuilderProperty(STRING_BORDER_WIDTH,"style.lineWidth",BuilderProperty.TYPE_LINE_WIDTH)),i.properties.push(new BuilderProperty(STRING_BORDER_STYLE,"style.lineStyle",BuilderProperty.TYPE_LINE_STYLE));var r=new Path,n=new Line(new Point(e+1,t+4),new Point(e+FigureDefaults.segmentSize-1,t+4)),o=new QuadCurve(new Point(e+FigureDefaults.segmentSize-1,t+4),new Point(e+FigureDefaults.segmentSize-1+FigureDefaults.corner*(FigureDefaults.cornerRoundness/10),t+FigureDefaults.corner/FigureDefaults.cornerRoundness+4),new Point(e+FigureDefaults.segmentSize-1+FigureDefaults.corner,t+FigureDefaults.corner+4)),l=new Line(new Point(e+FigureDefaults.segmentSize-1+FigureDefaults.corner,t+FigureDefaults.corner+4),new Point(e+FigureDefaults.segmentSize-1+FigureDefaults.corner,t+FigureDefaults.corner+FigureDefaults.segmentShortSize-4)),u=new QuadCurve(new Point(e+FigureDefaults.segmentSize-1+FigureDefaults.corner,t+FigureDefaults.corner+FigureDefaults.segmentShortSize-4),new Point(e+FigureDefaults.segmentSize-1+FigureDefaults.corner*(FigureDefaults.cornerRoundness/10),t+FigureDefaults.corner+FigureDefaults.segmentShortSize-4+FigureDefaults.corner*(FigureDefaults.cornerRoundness/10)),new Point(e+FigureDefaults.segmentSize-1,t+FigureDefaults.corner+FigureDefaults.segmentShortSize-4+FigureDefaults.corner)),s=new Line(new Point(e+FigureDefaults.segmentSize-1,t+FigureDefaults.corner+FigureDefaults.segmentShortSize-4+FigureDefaults.corner),new Point(e+1,t+FigureDefaults.corner+FigureDefaults.segmentShortSize-4+FigureDefaults.corner)),P=new QuadCurve(new Point(e+1,t+FigureDefaults.corner+FigureDefaults.segmentShortSize-4+FigureDefaults.corner),new Point(e+1-FigureDefaults.corner*(FigureDefaults.cornerRoundness/10),t+FigureDefaults.corner+FigureDefaults.segmentShortSize-4+FigureDefaults.corner*(FigureDefaults.cornerRoundness/10)),new Point(e+1-FigureDefaults.corner,t+FigureDefaults.corner+FigureDefaults.segmentShortSize-4)),p=new Line(new Point(e+1-FigureDefaults.corner,t+FigureDefaults.corner+FigureDefaults.segmentShortSize-4),new Point(e+1-FigureDefaults.corner,t+FigureDefaults.corner+4)),E=new QuadCurve(new Point(e+1-FigureDefaults.corner,t+FigureDefaults.corner+4),new Point(e+1-FigureDefaults.corner*(FigureDefaults.cornerRoundness/10),t+4),new Point(e+1,t+4));r.addPrimitive(n),r.addPrimitive(o),r.addPrimitive(l),r.addPrimitive(u),r.addPrimitive(s),r.addPrimitive(P),r.addPrimitive(p),r.addPrimitive(E),i.addPrimitive(r);var T=new Text(STRING_TEXT,e+FigureDefaults.segmentSize/2,t+FigureDefaults.segmentShortSize/2+FigureDefaults.corner,FigureDefaults.textFont,FigureDefaults.textSize);T.style.fillStyle=FigureDefaults.textColor,i.addPrimitive(T);var a=FigureDefaults.segmentSize-1+FigureDefaults.corner,d=FigureDefaults.corner+FigureDefaults.segmentShortSize-4+FigureDefaults.corner;return CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+a/2-10,t+4),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+a/2,t+4),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+a/2+10,t+4),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+a,t+d/2-10),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+a,t+d/2),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+a,t+d/2+10),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+a/2-10,t+d),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+a/2,t+d),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e+a/2+10,t+d),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e,t+d/2-10),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e,t+d/2),ConnectionPoint.TYPE_FIGURE),CONNECTOR_MANAGER.connectionPointCreate(i.id,new Point(e,t+d/2+10),ConnectionPoint.TYPE_FIGURE),i.finalise(),i}

// minimap.js
"use strict";function Minimap(i,t){var e,s,a,n;this.selected=!1,this.bigCanvas=i,this.minimapContainer=t,this.selection=document.createElement("div"),this.selection.id="selection",this.smallCanvas=document.createElement("canvas"),this.smallCanvas.style.width="100%",this.smallCanvas.style.height="100%",this.minimapContainer.style.height=Minimap.prefferedHeight+"px",this.minimapContainer.style.width=Minimap.prefferedWidth+"px",this.minimapContainer.appendChild(this.smallCanvas),this.minimapContainer.appendChild(this.selection),this.bigCanvas.parentNode.onscroll=(e=this,function(i){e.updateMinimapPosition()}),this.minimapContainer.onmousemove=(s=this,function(i){return s.onScrollMinimap(i),!1}),this.selection.onmousedown=(a=this,function(i){i.preventDefault(),a.selected=!0}),this.smallCanvas.onmousedown=(n=this,function(i){n.selected=!0,n.onScrollMinimap(i)}),this.ratio=0,this.initMinimap()}Minimap.prefferedWidth=230,Minimap.prefferedHeight=104,Minimap.prototype={constructor:Minimap,updateMinimap:function(){var i=this.bigCanvas,t=this.smallCanvas.getContext("2d");t.beginPath(),t.clearRect(0,0,this.smallCanvas.width,this.smallCanvas.height),t.closePath(),t.stroke(),t.save(),t.scale(this.ratio/100,this.ratio/100),t.drawImage(i,0,0),t.restore()},initMinimap:function(){var i=100*Minimap.prefferedWidth/$(this.bigCanvas).width(),t=100*Minimap.prefferedHeight/$(this.bigCanvas).height();this.ratio=i<t?i:t;var e=$(this.bigCanvas).width()*this.ratio/100,s=$(this.bigCanvas).height()*this.ratio/100;this.minimapContainer.style.width=e+"px",this.minimapContainer.style.height=s+"px",this.smallCanvas.width=$(this.minimapContainer).width(),this.smallCanvas.height=$(this.minimapContainer).height();var a=this.ratio*($(this.bigCanvas.parentNode).width()-scrollBarWidth)/100,n=this.ratio*($(this.bigCanvas.parentNode).height()-scrollBarWidth)/100;a>$(this.minimapContainer).width()&&(a=$(this.minimapContainer).width()),n>$(this.minimapContainer).height()&&(n=$(this.minimapContainer).height()),this.selection.style.width=a+"px",this.selection.style.height=n-2+"px"},updateMapPosition:function(){var i=parseInt(this.selection.style.left.replace("px","")),t=parseInt(this.selection.style.top.replace("px",""));this.bigCanvas.parentNode.scrollLeft=i/this.ratio*100,this.bigCanvas.parentNode.scrollTop=t/this.ratio*100},updateMinimapPosition:function(){var i=parseInt(this.bigCanvas.parentNode.scrollLeft),t=parseInt(this.bigCanvas.parentNode.scrollTop);i=i*this.ratio/100,t=t*this.ratio/100,this.selection.style.left=i+"px",this.selection.style.top=t+"px"},onScrollMinimap:function(i){if(1==this.selected){var t=this.getInternalXY(i),e=this.minimapContainer.style.width.replace("px",""),s=this.minimapContainer.style.height.replace("px",""),a=this.selection.style.width.replace("px",""),n=this.selection.style.height.replace("px","");t[0]-a/2<0&&(t[0]=a/2),t[1]-n/2<0&&(t[1]=n/2),t[0]+a/2>e&&(t[0]=e-a/2),t[1]+n/2>s&&(t[1]=s-n/2),void 0!=t[0]&&(this.selection.style.left=t[0]-a/2+"px",this.selection.style.top=t[1]-n/2+"px"),this.updateMapPosition()}else this.selected=!1},getBounds:function(){var i=0,t=0,e=this.minimapContainer;do{i+=e.offsetLeft,t+=e.offsetTop}while(e=e.offsetParent);return[i,t,i+parseInt(this.minimapContainer.style.width.replace("px","")),t+parseInt(this.minimapContainer.style.height.replace("px",""))]},getInternalXY:function(i){var t=[],e=this.getBounds();return i.pageX>=e[0]&&i.pageX<=e[2]&&i.pageY>=e[1]&&i.pageY<=e[3]&&(t=[i.pageX-e[0],i.pageY-e[1]]),t}};

// colorPicker.js
!function(e){var o;e.fn.colorPicker=function(){return this.length>0&&buildSelector(),this.each(function(e){buildPicker(this)})};var t=!1;buildPicker=function(o){control=e("<div class='color_picker'>&nbsp;</div>"),""==e(o).val()?control.css("background-image","url(/assets/images/noColor.png)"):control.css("background-color",e(o).val()),control.bind("click",toggleSelector),e(o).after(control),e(o).bind("change",function(){selectedValue=toHex(e(o).val()),e(o).next(".color_picker").css("background-color",selectedValue)}),e(o).hide()},buildSelector=function(){selector=e("<div id='color_selector'></div>"),e.each(e.fn.colorPicker.defaultColors,function(o){swatch=e("<div class='color_swatch'>&nbsp;</div>"),"n"==this[0]&&"/"==this[1]&&"a"==this[2]||"n/a"==this?(swatch.css("background-image","url(assets/images/noColor.png)"),swatch.css("background-position","center"),swatch.css("background-repeat","repeat-x")):swatch.css("background-color","#"+this),swatch.bind("click",function(o){changeColor(e(this).css("background-color"))}),swatch.bind("mouseover",function(o){e(this).css("border-color","#598FEF"),"repeat-x"==e(this).css("background-repeat")?e("input#color_value").val("n/a"):e("input#color_value").val(toHex(e(this).css("background-color")))}),swatch.bind("mouseout",function(o){e(this).css("border-color","#000")}),swatch.appendTo(selector)}),hex_field=e("<label for='color_value'>Hex</label><input type='text' size='8' id='color_value'/>"),hex_field.bind("keydown",function(o){13==o.keyCode&&changeColor(e(this).val()),27==o.keyCode&&toggleSelector()}),e("<div id='color_custom'></div>").append(hex_field).appendTo(selector),e("body").append(selector),selector.hide()},checkMouse=function(t){var c="div#color_selector",r=e(t.target).parents(c).length;t.target==e(c)[0]||t.target==o||r>0||hideSelector()},hideSelector=function(){var o=e("div#color_selector");e(document).unbind("mousedown",checkMouse),o.hide(),t=!1},showSelector=function(){var c=e("div#color_selector"),r=c.css("width");r=parseInt(r.replace("px","")),e(o).offset().left+r>document.body.scrollWidth?c.css({top:e(o).offset().top+e(o).outerHeight(),left:e(o).offset().left+e(o).outerWidth()-r}):c.css({top:e(o).offset().top+e(o).outerHeight(),left:e(o).offset().left}),hexColor=e(o).prev("input").val(),e("input#color_value").val(hexColor),c.show(),e(document).bind("mousedown",checkMouse),t=!0},toggleSelector=function(e){o=this,t?hideSelector():showSelector()},changeColor=function(t){(selectedValue=toHex(t))?(e(o).css("background-color",selectedValue),e(o).prev("input").val(selectedValue).change(),e(o).css("background-image","none")):(e(o).css("background-image","url(assets/images/noColor.png)"),e(o).prev("input").val("").change()),hideSelector()},toHex=function(e){if(e.match(/[0-9a-fA-F]{3}$/)||e.match(/[0-9a-fA-F]{6}$/))e="#"==e.charAt(0)?e:"#"+e;else if(e.match(/^rgb\(([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5]),[ ]{0,1}([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5]),[ ]{0,1}([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5])\)$/)){var o=[parseInt(RegExp.$1),parseInt(RegExp.$2),parseInt(RegExp.$3)],t=function(e){if(e.length<2)for(var o=0,t=2-e.length;o<t;o++)e="0"+e;return e};if(3==o.length)e="#"+t(o[0].toString(16))+t(o[1].toString(16))+t(o[2].toString(16))}else e=!1;return e},e.fn.colorPicker.addColors=function(o){e.fn.colorPicker.defaultColors=e.fn.colorPicker.defaultColors.concat(o)},e.fn.colorPicker.defaultColors=["000000","993300","333300","000080","333399","333333","800000","FF6600","808000","008000","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","999999","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFFF","FFFFFF","n/a"]}(jQuery);

// History.js
"use strict";function History(){}History.OBJECT_FIGURE=0,History.OBJECT_CONNECTOR=1,History.OBJECT_CONNECTION_POINT=2,History.OBJECT_STATIC=3,History.OBJECT_GROUP=4,History.OBJECT_GLUE=5,History.COMMANDS=[],History.CURRENT_POINTER=-1,History.addUndo=function(t){doUndo&&(History.COMMANDS.splice(History.CURRENT_POINTER+1,History.COMMANDS.length),History.COMMANDS.push(t),History.CURRENT_POINTER++,document.getElementById("buttonUndo").classList.add("menubar_button_undo_enabled"),document.getElementById("buttonUndo").classList.remove("menubar_button_undo_disabled"))},History.undo=function(){History.CURRENT_POINTER>=0?(Log.info("undo()->Type of action: "+History.COMMANDS[History.CURRENT_POINTER].oType),"FigureCreateCommand"==History.COMMANDS[History.CURRENT_POINTER].oType?(document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_disabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_enabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_disabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_enabled")):"GroupDeleteCommand"==History.COMMANDS[History.CURRENT_POINTER].oType&&(document.getElementById("buttonFront").classList.add("menubar_button_front_disabled"),document.getElementById("buttonFront").classList.remove("menubar_button_front_enabled"),document.getElementById("buttonBack").classList.add("menubar_button_back_disabled"),document.getElementById("buttonBack").classList.remove("menubar_button_back_enabled"),document.getElementById("buttonCopy").classList.add("menubar_button_copy_enabled"),document.getElementById("buttonCopy").classList.remove("menubar_button_copy_disabled"),document.getElementById("buttonDelete").classList.add("menubar_button_trash_enabled"),document.getElementById("buttonDelete").classList.remove("menubar_button_trash_disabled")),History.COMMANDS[History.CURRENT_POINTER].undo(),History.CURRENT_POINTER--,History.CURRENT_POINTER<0&&(document.getElementById("buttonUndo").classList.add("menubar_button_undo_disabled"),document.getElementById("buttonUndo").classList.remove("menubar_button_undo_enabled"))):(document.getElementById("buttonUndo").classList.add("menubar_button_undo_disabled"),document.getElementById("buttonUndo").classList.remove("menubar_button_undo_enabled"))},History.redo=function(){History.CURRENT_POINTER+1<History.COMMANDS.length&&(Log.info("redo()->Type of action: "+History.COMMANDS[History.CURRENT_POINTER+1].oType),History.COMMANDS[History.CURRENT_POINTER+1].execute(),History.CURRENT_POINTER++)},History.pack=function(){},History.clear=function(){History.COMMANDS=[],History.CURRENT_POINTER=-1};

// FigureCreateCommand.js
"use strict";function FigureCreateCommand(t,e,i){this.oType="FigureCreateCommand",this.mergeable=!1,this.factoryFunction=t,this.x=e,this.y=i,this.firstExecute=!0,this.figureId=null}FigureCreateCommand.prototype={execute:function(){if(!this.firstExecute)throw"Not implemented";var t=this.factoryFunction(this.x,this.y);t.transform(Matrix.translationMatrix(this.x-t.rotationCoords[0].x,this.y-t.rotationCoords[0].y)),t.style.lineWidth=defaultLineWidth,this.figureId=t.id,STACK.figureAdd(t);var e=STACK.containerGetByXY(this.x,this.y);if(-1!==e){var i=STACK.containerGetById(e);Util.areBoundsInBounds(t.getBounds(),i.getBounds())&&CONTAINER_MANAGER.addFigure(e,this.figureId)}selectedFigureId=t.id,setUpEditPanel(t),state=STATE_FIGURE_SELECTED,this.firstExecute=!1},undo:function(){state==STATE_TEXT_EDITING&&(currentTextEditor.destroy(),currentTextEditor=null);var t=CONTAINER_MANAGER.getContainerForFigure(this.figureId);-1!==t&&CONTAINER_MANAGER.removeFigure(t,this.figureId),STACK.figureRemoveById(this.figureId),state=STATE_NONE,setUpEditPanel(canvasProps)}};

// FigureCloneCommand.js
"use strict";function FigureCloneCommand(e){this.oType="FigureCloneCommand",this.firstExecute=!0,this.figureId=null,this.parentFigureId=e}FigureCloneCommand.prototype={execute:function(){if(!this.firstExecute)throw"Not implemented";var e=STACK.figureGetById(this.parentFigureId).clone();e.transform(Matrix.translationMatrix(10,10)),STACK.figureAdd(e),this.figureId=e.id,selectedFigureId=this.figureId,setUpEditPanel(e),state=STATE_FIGURE_SELECTED,this.firstExecute=!1},undo:function(){STACK.figureRemoveById(this.figureId),state=STATE_NONE}};

// FigureTranslateCommand.js
"use strict";function FigureTranslateCommand(t,e){this.oType="FigureTranslateCommand",this.mergeable=!0,this.figureId=t,this.matrix=e,this.reverseMatrix=[[1,0,0],[0,1,0],[0,0,1]],this.reverseMatrix[0][2]=-this.matrix[0][2],this.reverseMatrix[1][2]=-this.matrix[1][2]}FigureTranslateCommand.prototype={execute:function(){STACK.figureGetById(this.figureId).transform(this.matrix)},undo:function(){STACK.figureGetById(this.figureId).transform(this.reverseMatrix)}};

// FigureRotateCommand.js
"use strict";function FigureRotateCommand(t,e,i){this.oType="FigureRotateCommand",this.mergeable=!0,this.figureId=t,this.matrix=e,this.reverseMatrix=i}FigureRotateCommand.prototype={execute:function(){STACK.figureGetById(this.figureId).transform(this.matrix)},undo:function(){STACK.figureGetById(this.figureId).transform(this.reverseMatrix)}};

// FigureScaleCommand.js
"use strict";function FigureScaleCommand(e,i,t){this.oType="FigureScaleCommand",this.mergeable=!0,this.figureId=e,this.matrix=i,this.reverseMatrix=t}FigureScaleCommand.prototype={execute:function(){STACK.figureGetById(this.figureId).transform(this.matrix)},undo:function(){STACK.figureGetById(this.figureId).transform(this.reverseMatrix)}};

// FigureZOrderCommand.js
"use strict";function FigureZOrderCommand(i,o){this.figureId=i,this.oType="FigureZOrderCommand",this.oldPosition=STACK.idToIndex[i],this.newPosition=o}FigureZOrderCommand.prototype={execute:function(){this.oldPosition+1==this.newPosition||this.oldPosition-1==this.newPosition?STACK.swapToPosition(this.figureId,this.newPosition):STACK.setPosition(this.figureId,this.newPosition)},undo:function(){this.newPosition+1==this.oldPosition||this.newPosition-1==this.oldPosition?STACK.swapToPosition(this.figureId,this.oldPosition):STACK.setPosition(this.figureId,this.oldPosition)}};

// FigureDeleteCommand.js
"use strict";function FigureDeleteCommand(e){this.oType="FigureDeleteCommand",this.mergeable=!1,this.figureId=e,this.deletedFigure=null,this.deletedGlues=null,this.deletedCPs=null,this.firstExecute=!0}FigureDeleteCommand.prototype={execute:function(){if(!this.firstExecute)throw"Not implemented";this.deletedFigure=STACK.figureGetById(this.figureId),this.deletedCPs=CONNECTOR_MANAGER.connectionPointGetAllByParent(this.figureId),this.deletedGlues=[];for(var e=this.deletedCPs.length,t=0;t<e;t++){var i=CONNECTOR_MANAGER.glueGetByFirstConnectionPointId(this.deletedCPs[t].id);i.length&&this.deletedGlues.push(i[0])}STACK.figureRemoveById(this.figureId),selectedFigureId=-1,setUpEditPanel(canvasProps),state=STATE_NONE,this.firstExecute=!1},undo:function(){if(!this.deletedFigure)throw"No soted deleted figure";for(var e=this.deletedCPs.length,t=0;t<e;t++)CONNECTOR_MANAGER.connectionPointAdd(this.deletedCPs[t]);e=this.deletedGlues.length;for(var i=0;i<e;i++)CONNECTOR_MANAGER.glueAdd(this.deletedGlues[i]);STACK.figureAdd(this.deletedFigure)}};

// GroupRotateCommand.js
"use strict";function GroupRotateCommand(t,o,r){this.oType="GroupRotateCommand",this.mergeable=!0,this.groupId=t,this.matrix=o,this.reverseMatrix=r}GroupRotateCommand.prototype={execute:function(){STACK.groupGetById(this.groupId).transform(this.matrix)},undo:function(){STACK.groupGetById(this.groupId).transform(this.reverseMatrix)}};

// GroupScaleCommand.js
"use strict";function GroupScaleCommand(t,r,e){this.oType="GroupScaleCommand",this.mergeable=!0,this.groupId=t,this.matrix=r,this.reverseMatrix=e}GroupScaleCommand.prototype={execute:function(){STACK.groupGetById(this.groupId).transform(this.matrix)},undo:function(){STACK.groupGetById(this.groupId).transform(this.reverseMatrix)}};

// GroupCreateCommand.js
"use strict";function GroupCreateCommand(t){this.groupId=t,this.figuresIds=STACK.figureGetIdsByGroupId(t),this.firstExecute=!0,this.oType="GroupCreateCommand"}GroupCreateCommand.prototype={execute:function(){if(this.firstExecute)STACK.groupGetById(this.groupId).permanent=!0,this.firstExecute=!1;else{var t=new Group;t.id=this.groupId,t.permanent=!0;for(var e=0;e<this.figuresIds.length;e++){STACK.figureGetById(this.figuresIds[e]).groupId=t.id}var r=t.getBounds();t.rotationCoords.push(new Point(r[0]+(r[2]-r[0])/2,r[1]+(r[3]-r[1])/2)),t.rotationCoords.push(new Point(r[0]+(r[2]-r[0])/2,r[1])),STACK.groups.push(t)}state=STATE_GROUP_SELECTED,selectedGroupId=this.groupId},undo:function(){STACK.groupDestroy(this.groupId),selectedGroupId=-1,state=STATE_NONE}};

// GroupCloneCommand.js
"use strict";function GroupCloneCommand(t){this.oType="GroupCloneCommand",this.firstExecute=!0,this.groupId=null,this.parentGroupId=t,this.parentFiguresId=[]}GroupCloneCommand.prototype={execute:function(){if(!this.firstExecute)throw"Not implemented";for(var t=null,e=[],r=STACK.figureGetByGroupId(this.parentGroupId),i=0;i<r.length;i++)(t=STACK.figureGetById(r[i].id).clone()).transform(Matrix.translationMatrix(10,10)),STACK.figureAdd(t),e.push(t.id),this.parentFiguresId.push(t.id);STACK.groupGetById(this.parentGroupId).permanent||STACK.groupDestroy(this.parentGroupId),this.groupId=STACK.groupCreate(e),selectedGroupId=this.groupId,setUpEditPanel(null),state=STATE_GROUP_SELECTED,this.firstExecute=!1},undo:function(){for(var t=this.parentFiguresId,e=0;e<t.length;e++)STACK.figureRemoveById(t[e]);state=STATE_NONE}};

// GroupDestroyCommand.js
"use strict";function GroupDestroyCommand(o){this.groupId=o,this.figuresIds=STACK.figureGetIdsByGroupId(o),this.firstExecute=!0,this.oType="GroupDestroyCommand"}GroupDestroyCommand.prototype={execute:function(){STACK.groupDestroy(this.groupId),selectedGroupId=-1,state=STATE_NONE},undo:function(){var o=new Group;o.id=this.groupId,o.permanent=!0;for(var t=0;t<this.figuresIds.length;t++){STACK.figureGetById(this.figuresIds[t]).groupId=o.id}var r=o.getBounds();o.rotationCoords.push(new Point(r[0]+(r[2]-r[0])/2,r[1]+(r[3]-r[1])/2)),o.rotationCoords.push(new Point(r[0]+(r[2]-r[0])/2,r[1])),STACK.groups.push(o),state=STATE_GROUP_SELECTED,selectedGroupId=this.groupId}};

// GroupDeleteCommand.js
"use strict";function GroupDeleteCommand(e){this.oType="GroupDeleteCommand",this.mergeable=!1,this.groupId=e,this.deletedGroup=null,this.deletedFiguresCommands=[],this.firstExecute=!0}GroupDeleteCommand.prototype={execute:function(){if(!this.firstExecute)throw"Not implemented";this.deletedGroup=STACK.groupGetById(this.groupId);for(var e=STACK.figureGetIdsByGroupId(this.groupId),t=0;t<e.length;t++){var s=new FigureDeleteCommand(e[t]);s.execute(),this.deletedFiguresCommands.push(s)}STACK.groupDestroy(this.groupId),selectedGroupId=-1,state=STATE_NONE,setUpEditPanel(canvasProps),this.firstExecute=!1},undo:function(){if(!this.deletedGroup)throw"No soted deleted figure";for(var e=0;e<this.deletedFiguresCommands.length;e++)this.deletedFiguresCommands[e].undo();STACK.groups.push(this.deletedGroup),selectedGroupId=this.groupId,state=STATE_GROUP_SELECTED}};

// GroupTranslateCommand.js
"use strict";function GroupTranslateCommand(t,r){this.oType="GroupTranslateCommand",this.mergeable=!0,this.groupId=t,this.matrix=r,this.reverseMatrix=[[1,0,0],[0,1,0],[0,0,1]],this.reverseMatrix[0][2]=-this.matrix[0][2],this.reverseMatrix[1][2]=-this.matrix[1][2]}GroupTranslateCommand.prototype={execute:function(){STACK.groupGetById(this.groupId).transform(this.matrix)},undo:function(){STACK.groupGetById(this.groupId).transform(this.reverseMatrix)}};

// ContainerCreateCommand.js
"use strict";function ContainerCreateCommand(t,e){this.x=t,this.y=e,this.firstExecute=!0,this.mergeable=!1,this.id=null}ContainerCreateCommand.prototype={execute:function(){if(!this.firstExecute)throw"ContainerCreateCommand:execute(). Redo not implemented";var t=new Point(this.x-50,this.y-50),e=new Point(this.x+50,this.y+50),i=new Container(null,t,e);i.style.lineWidth=defaultLineWidth,STACK.containerAdd(i),state=STATE_CONTAINER_SELECTED,selectedContainerId=i.id,this.id=i.id,setUpEditPanel(i)},undo:function(){}};

// ContainerDeleteCommand.js
"use strict";function ContainerDeleteCommand(e){this.oType="ContainerDeleteCommand",this.mergeable=!1,this.containerId=e,this.firstExecute=!0}ContainerDeleteCommand.prototype={execute:function(){if(!this.firstExecute)throw"Not implemented";for(var e=CONTAINER_MANAGER.getAllFigures(this.containerId),t=0;t<e;t++)CONTAINER_MANAGER.removeFigure(this.containerId,e[t]);STACK.containerRemoveById(this.containerId),selectedContainerId=-1,setUpEditPanel(canvasProps),state=STATE_NONE,redraw=!0,this.firstExecute=!1},undo:function(){throw"Not implemented"}};

// ContainerTranslateCommand.js
"use strict";function ContainerTranslateCommand(t,i){this.oType="ContainerTranslateCommand",this.mergeable=!0,this.containerId=t,this.matrix=i,this.reverseMatrix=[[1,0,0],[0,1,0],[0,0,1]],this.reverseMatrix[0][2]=-this.matrix[0][2],this.reverseMatrix[1][2]=-this.matrix[1][2],this.containedFigures=[]}ContainerTranslateCommand.prototype={execute:function(){STACK.containerGetById(this.containerId).transform(this.matrix),this.containedFigures=CONTAINER_MANAGER.getAllFigures(this.containerId);for(var t=0;t<this.containedFigures.length;t++){STACK.figureGetById(this.containedFigures[t]).transform(this.matrix)}},undo:function(){STACK.containerGetById(this.containerId).transform(this.reverseMatrix);for(var t=0;t<this.containedFigures.length;t++){STACK.figureGetById(this.containedFigures[t]).transform(this.reverseMatrix)}}};

// ContainerScaleCommand.js
"use strict";function ContainerScaleCommand(t,e,n){this.oType="ContainerScaleCommand",this.mergeable=!0,this.containerId=t,this.matrix=e,this.reverseMatrix=n}ContainerScaleCommand.prototype={execute:function(){STACK.containerGetById(this.containerId).transform(this.matrix)},undo:function(){STACK.containerGetById(this.containerId).transform(this.reverseMatrix)}};

// ConnectorCreateCommand.js
"use strict";function ConnectorCreateCommand(e){this.oType="ConnectorCreateCommand",this.mergeable=!1,this.firstExecute=!0,this.connectorId=e}ConnectorCreateCommand.prototype={execute:function(){throw"Should not be implemented"},undo:function(){CONNECTOR_MANAGER.connectorRemoveById(this.connectorId,!0),state==STATE_TEXT_EDITING&&(currentTextEditor.destroy(),currentTextEditor=null),state=STATE_NONE,selectedConnectorId=-1}};

// ConnectorDeleteCommand.js
"use strict";function ConnectorDeleteCommand(n){this.oType="ConnectorDeleteCommand",this.mergeable=!1,this.connectorId=n,this.firstExecute=!0,this.connector=null,this.connectionpoints=null,this.glues=null}ConnectorDeleteCommand.prototype={execute:function(){if(!this.firstExecute)throw"Not implemented";this.connector=CONNECTOR_MANAGER.connectorGetById(this.connectorId),this.connectionpoints=CONNECTOR_MANAGER.connectionPointGetAllByParentIdAndType(this.connectorId,ConnectionPoint.TYPE_CONNECTOR),this.glues=CONNECTOR_MANAGER.glueGetBySecondConnectionPointId(this.connectorId),CONNECTOR_MANAGER.connectorRemoveById(this.connectorId,!0),selectedConnectorId=-1,setUpEditPanel(canvasProps),state=STATE_NONE,redraw=!0,this.firstExecute=!1},undo:function(){this.connector&&(CONNECTOR_MANAGER.connectors.push(this.connector),CONNECTOR_MANAGER.connectionPoints=CONNECTOR_MANAGER.connectionPoints.concat(this.connectionpoints),CONNECTOR_MANAGER.glues=CONNECTOR_MANAGER.glues.concat(this.glues),redraw=!0)}};

// ConnectorAlterCommand.js
"use strict";function ConnectorAlterCommand(n){this.oType="ConnectorAlterCommand",this.mergeable=!1,this.firstExecute=!0,this.connectorId=n;var t=CONNECTOR_MANAGER.connectorGetById(this.connectorId);this.turningPoints=Point.cloneArray(t.turningPoints),this.userChanges=t.cloneUserChanges(),this.glues=Glue.cloneArray(CONNECTOR_MANAGER.glues),this.connectionPoints=ConnectionPoint.cloneArray(CONNECTOR_MANAGER.connectionPoints)}ConnectorAlterCommand.prototype={execute:function(){throw"Not implemented"},undo:function(){var n=CONNECTOR_MANAGER.connectorGetById(this.connectorId);n.turningPoints=this.turningPoints,n.userChanges=this.userChanges,CONNECTOR_MANAGER.glues=this.glues,CONNECTOR_MANAGER.connectionPoints=this.connectionPoints,draw()}};

// ShapeChangePropertyCommand.js
"use strict";function ShapeChangePropertyCommand(t,e,i,r){this.figureId=t,this.property=e,this.newValue=i,this.previousValue=void 0!==r?r:this._getValue(t,e),this.firstExecute=!0,this.textPrimitiveId=this._getTextPrimitiveId(),this.isTextPrimitiveProperty=-1!==this.textPrimitiveId,this.oType="ShapeChangePropertyCommand"}ShapeChangePropertyCommand.prototype={execute:function(){if(!this.firstExecute)throw"Redo not implemented.";this._setValue(this.figureId,this.property,this.newValue),this.firstExecute=!1,this.isTextPrimitiveProperty&&state==STATE_TEXT_EDITING&&currentTextEditor.setProperty(this.property,this.newValue)},undo:function(){this._setValue(this.figureId,this.property,this.previousValue);var t=this.__getShape(this.figureId);setUpEditPanel(t),this.isTextPrimitiveProperty&&state==STATE_TEXT_EDITING&&(currentTextEditor.refersTo(t,this.textPrimitiveId)||(currentTextEditor.destroy(),setUpTextEditorPopup(t,this.textPrimitiveId),currentTextEditor.setProperty(this.property,this.previousValue)))},__getShape:function(t){var e=STACK.figureGetById(t);return null==e&&(e=CONNECTOR_MANAGER.connectorGetById(t)),null==e&&(e=STACK.containerGetById(t)),e},_getValue:function(t,e){for(var i=this.__getShape(this.figureId),r=e.split("."),s=0;s<r.length-1;s++)i=i[r[s]];return void 0===i[r[r.length-1]]?i["get"+r[r.length-1]]:i[r[r.length-1]]},_setValue:function(t,e,i){for(var r=this.__getShape(this.figureId),s=e.split("."),h=0;h<s.length-1;h++)r=r[s[h]];void 0===r[s[s.length-1]]?r["set"+s[s.length-1]](i):r[s[s.length-1]]=i},_getTextPrimitiveId:function(){var t=-1;if(/(primitives\.\d+|middleText)\.(str|size|font|align|underlined|style\.fillStyle)/g.test(this.property)){var e=this.property.split(".")[1];t=parseInt(e,10)}return t}};

// CanvasChangeColorCommand.js
"use strict";function CanvasChangeColorCommand(o){this.previousColor=canvasProps.fillColor,this.color=o,this.oType="CanvasChangeColorCommand"}CanvasChangeColorCommand.prototype={constructor:CanvasChangeColorCommand,execute:function(){canvasProps.setFillColor(this.color)},undo:function(){canvasProps.setFillColor(this.previousColor),setUpEditPanel(canvasProps)}};

// CanvasChangeSizeCommand.js
"use strict";function CanvasChangeSizeCommand(s,t){this.previousWidth=canvasProps.width,this.previousHeight=canvasProps.height,this.width=s,this.height=t,this.oType="CanvasChangeSizeCommand"}CanvasChangeSizeCommand.prototype={constructor:CanvasChangeSizeCommand,execute:function(){canvasProps.setWidth(this.width),canvasProps.setHeight(this.height),setUpEditPanel(canvasProps)},undo:function(){canvasProps.setWidth(this.previousWidth),canvasProps.setHeight(this.previousHeight),setUpEditPanel(canvasProps)}};

// InsertedImageFigureCreateCommand.js
"use strict";function InsertedImageFigureCreateCommand(e,t,i){this.oType="InsertedImageFigureCreateCommand",this.mergeable=!1,this.imgFileName=e,this.x=t,this.y=i,this.firstExecute=!0,this.figureId=null}InsertedImageFigureCreateCommand.prototype={execute:function(){if(!this.firstExecute)throw"Not implemented";var e=appURL+"/editor/data/import/"+this.imgFileName,t=ImageFrame.figure_InsertedImage(e,this.x,this.y);t.transform(Matrix.translationMatrix(this.x-t.rotationCoords[0].x,this.y-t.rotationCoords[0].y)),t.style.lineWidth=defaultLineWidth,this.figureId=t.id,STACK.figureAdd(t);var i=STACK.containerGetByXY(this.x,this.y);if(-1!==i){var r=STACK.containerGetById(i);Util.areBoundsInBounds(t.getBounds(),r.getBounds())&&CONTAINER_MANAGER.addFigure(i,this.figureId)}selectedFigureId=t.id,setUpEditPanel(t),state=STATE_FIGURE_SELECTED,this.firstExecute=!1},undo:function(){state==STATE_TEXT_EDITING&&(currentTextEditor.destroy(),currentTextEditor=null);var e=CONTAINER_MANAGER.getContainerForFigure(this.figureId);-1!==e&&CONTAINER_MANAGER.removeFigure(e,this.figureId),STACK.figureRemoveById(this.figureId),state=STATE_NONE,setUpEditPanel(canvasProps)}};